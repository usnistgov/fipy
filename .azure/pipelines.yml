# Conda package
# Create and test a Python package on multiple Python versions.
# Add steps that analyze code, save the dist with the build record, publish to a PyPI-compatible index, and more:
# https://docs.microsoft.com/en-us/azure/devops/pipelines/ecosystems/anaconda

strategy:
  matrix:
    linux-py27:
      image: ubuntu-latest
      python.version: '2.7'
      conda.packages: '"traitsui<7.0.0" "gmsh<4.0"'
      useBash: true
    linux-py39:
      image: ubuntu-latest
      python.version: '3.9'
      conda.packages: 'gmsh'
      useBash: true
    macos-py27:
      image: macos-latest
      python.version: '2.7'
      conda.packages: '"traitsui<7.0.0" "gmsh<4.0"'
      useBash: true
    macos-py39:
      image: macos-latest
      python.version: '3.9'
      conda.packages: 'gmsh'
      useBash: true
    windows-py39:
      image: windows-latest
      python.version: '3.9'
      conda.packages: 'gmsh'
      useBash: false

pool:
  vmImage: $(image)

variables:
  system.debug: true
  system.log: true
  useBash: or(startsWith($(image), 'ubuntu'), startsWith($(image), 'macos'))

steps:
- template: templates/install.yml
  parameters:
    python.version: $(python.version)
    conda.packages: $(conda.packages)

- bash: |
    source activate myEnvironment
    python setup.py egg_info
    python setup.py test --deprecation-errors
  displayName: test
