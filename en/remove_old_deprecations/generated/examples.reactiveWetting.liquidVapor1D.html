
<!DOCTYPE html>


<!--[if IEMobile 7]><html class="iem7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if lte IE 6]><html class="lt-ie9 lt-ie8 lt-ie7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (IE 7)&(!IEMobile)]><html class="lt-ie9 lt-ie8 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if IE 8]><html class="lt-ie9 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)]><!--><html class="no-js"  lang="en" dir="ltr" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# book: http://ogp.me/ns/book# profile: http://ogp.me/ns/profile# video: http://ogp.me/ns/video# product: http://ogp.me/ns/product# content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"><!--<![endif]-->

  <head>
<meta charset="utf-8" />
<link rel="shortcut icon" href="https://www.nist.gov/sites/all/themes/nist_style/favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/x-mathjax-config">MathJax.Hub.Config({
  extensions: ['tex2jax.js'],
  jax: ['input/TeX','output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$$','$$'], ['\\(','\\)'] ],
    processEscapes: true,
    processClass: 'tex2jax',
    ignoreClass: 'html'
  },
  showProcessingMessages: false,
  messageStyle: 'none'
});
</script>
<meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">

      <!--[if lt IE 9]>
    <script src="https://www.nist.gov/sites/all/themes/zen/js/html5-respond.js"></script>
    <![endif]-->
    <!--[if (gte IE 6)&(lte IE 8)]>
  <script type="text/javascript" src="https://www.nist.gov/sites/all/themes/nist_style/js/selectivizr-min.js"></script>
  <![endif]--><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>examples.reactiveWetting.liquidVapor1D &#8212; FiPy 3.99+5.gde29bb8c4 documentation</title>
    <link rel="stylesheet" href="../_static/ntd2d.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/ntd2d.css?v=de7af573" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/widetable.css?v=32b6a719" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=fa630c1c"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script>window.MathJax = {"loader": {"load": ["[tex]/textmacros"]}, "tex": {"packages": {"[+]": ["textmacros"]}}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://pages.nist.gov/fipy/en/latest/generated/examples.reactiveWetting.liquidVapor1D.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="FiPy 3.99+5.gde29bb8c4 documentation" href="../contents.html" />
    <link rel="up" title="examples.reactiveWetting" href="examples.reactiveWetting.html" />
    <link rel="next" title="examples.reactiveWetting.liquidVapor2D" href="examples.reactiveWetting.liquidVapor2D.html" />
    <link rel="prev" title="examples.reactiveWetting" href="examples.reactiveWetting.html" />
  
 


  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-3.6.2.min.js" type="text/javascript" defer="defer"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


  </head>
<!--  <body role="document">-->
  <body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-414011 node-type-software hide-breadcrumb section-services-resources page-panels is-panel" role="document">
      <div id="page" class="mini-header">



    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="examples.reactiveWetting.liquidVapor2D.html" title="examples.reactiveWetting.liquidVapor2D"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="examples.reactiveWetting.html" title="examples.reactiveWetting"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html"><img src="../_static/fipy.png" alt="FiPy logo"
                 style="vertical-align: middle; margin-top: -1px"/>
        FiPy</a> &gt;</li>

          <li class="nav-item nav-item-1"><a href="../API.html" ><code class="xref py py-mod docutils literal notranslate"><span class="pre">fipy</span></code> Package Documentation</a> &gt;</li>
          <li class="nav-item nav-item-2"><a href="examples.html" >examples</a> &gt;</li>
          <li class="nav-item nav-item-3"><a href="examples.reactiveWetting.html" accesskey="U">examples.reactiveWetting</a> &gt;</li> 
      </ul>
    </div>

  <div id="main" class="clearfix" role="main" tabindex="-1">
    <div class="main__inner">
      <div class="page-info">
        <a id="main-content"></a>
      </div>

      <div class="document">
        <div class="documentwrapper">

      <div id="content" class="column">
      <div id="block-nist-www-content" class="nist-block">
        <section class="nist-page__content usa-section clearfix">

         

        <div class="grid-container margin-top-4">
        <div class="grid-row grid-gap-6">

  <div class="nist-page__region nist-page__region--content tablet-lg:grid-col-8">
              <div class="body" role="main">
		
  <section id="module-examples.reactiveWetting.liquidVapor1D">
<span id="examples-reactivewetting-liquidvapor1d"></span><h1>examples.reactiveWetting.liquidVapor1D<a class="headerlink" href="#module-examples.reactiveWetting.liquidVapor1D" title="Permalink to this heading">¶</a></h1>
<p>Solve a single-component, liquid-vapor, van der Waals system.</p>
<p>This example solves a single-component, liquid-vapor, van der Waals system as
described by Wheeler <em>et al.</em> <span id="id1">[<a class="reference internal" href="../references.html#id31" title="Daniel Wheeler, James A. Warren, and William J. Boettinger. Modeling the early stages of reactive wetting. Physical Review E, 82(5):051601, Nov 2010. doi:10.1103/PhysRevE.82.051601.">5</a>]</span>. The free energy for this
system takes the form,</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-freeenergy">
<span class="eqno">(1)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-freeenergy" title="Permalink to this equation">¶</a></span>\[f = - \frac{e \rho^2}{m^2} + \frac{R T}{m} \left( \ln \frac{\rho}{m - \bar{v} \rho} \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho\)</span> is the density. This free energy supports a two phase
equilibrium with densities given by <span class="math notranslate nohighlight">\(\rho^l\)</span> and <span class="math notranslate nohighlight">\(\rho^v\)</span> in the
liquid and vapor phases, respectively. The densities are determined by solving
the following system of equations,</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-pressureequilibrium">
<span class="eqno">(2)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-pressureequilibrium" title="Permalink to this equation">¶</a></span>\[P \left( \rho^l \right) = P \left( \rho^v \right)\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-chemicalpotentialequilibrium">
<span class="eqno">(3)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-chemicalpotentialequilibrium" title="Permalink to this equation">¶</a></span>\[\mu \left( \rho^l \right) = \mu \left( \rho^v \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu\)</span> is the chemical potential,</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-chemicalpotential">
<span class="eqno">(4)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-chemicalpotential" title="Permalink to this equation">¶</a></span>\[\mu = \frac{\partial f}{\partial \rho}\]</div>
<p>and <span class="math notranslate nohighlight">\(P\)</span> is the pressure,</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-pressure">
<span class="eqno">(5)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-pressure" title="Permalink to this equation">¶</a></span>\[P = \rho \mu - f\]</div>
<p>One choice of thermodynamic parameters that yields a relatively physical two phase system is</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">molarWeight</span> <span class="o">=</span> <span class="mf">0.118</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ee</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.455971</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gasConstant</span> <span class="o">=</span> <span class="mf">8.314</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">650.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vbar</span> <span class="o">=</span> <span class="mf">1.3e-05</span>
</pre></div>
</div>
<p>with equilibrium density values of</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">liquidDensity</span> <span class="o">=</span> <span class="mf">7354.3402662299995</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vaporDensity</span> <span class="o">=</span> <span class="mf">82.855803327810008</span>
</pre></div>
</div>
<p>The equilibrium densities are verified by substitution into Eqs.
<a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-pressureequilibrium">(2)</a> and
<a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-chemicalpotentialequilibrium">(3)</a>. Firstly,
Eqs. <a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-freeenergy">(1)</a>,
<a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-chemicalpotential">(4)</a> and
<a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-pressure">(5)</a> are defined as python functions,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="n">CellVariable</span><span class="p">,</span> <span class="n">Grid1D</span><span class="p">,</span> <span class="n">TransientTerm</span><span class="p">,</span> <span class="n">VanLeerConvectionTerm</span><span class="p">,</span> <span class="n">DiffusionTerm</span><span class="p">,</span> <span class="n">ImplicitSourceTerm</span><span class="p">,</span> <span class="n">ConvectionTerm</span><span class="p">,</span> <span class="n">CentralDifferenceConvectionTerm</span><span class="p">,</span> <span class="n">Viewer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy.tools</span> <span class="kn">import</span> <span class="n">numerix</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">rho</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">ee</span> <span class="o">*</span> <span class="n">rho</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">molarWeight</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gasConstant</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">/</span> <span class="n">molarWeight</span> <span class="o">*</span> \
<span class="gp">... </span>           <span class="n">numerix</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rho</span> <span class="o">/</span> <span class="p">(</span><span class="n">molarWeight</span> <span class="o">-</span> <span class="n">vbar</span> <span class="o">*</span> <span class="n">rho</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">mu</span><span class="p">(</span><span class="n">rho</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ee</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">/</span> <span class="n">molarWeight</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gasConstant</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">/</span> <span class="n">molarWeight</span> <span class="o">*</span> \
<span class="gp">... </span>           <span class="p">(</span><span class="n">numerix</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rho</span> <span class="o">/</span> <span class="p">(</span><span class="n">molarWeight</span> <span class="o">-</span> <span class="n">vbar</span> <span class="o">*</span> <span class="n">rho</span><span class="p">))</span> <span class="o">+</span> <span class="n">molarWeight</span> <span class="o">/</span> <span class="p">(</span><span class="n">molarWeight</span> <span class="o">-</span> <span class="n">vbar</span> <span class="o">*</span> <span class="n">rho</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="n">rho</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">mu</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
</pre></div>
</div>
<p>The equilibrium densities values are verified with</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">numerix</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">mu</span><span class="p">(</span><span class="n">liquidDensity</span><span class="p">),</span> <span class="n">mu</span><span class="p">(</span><span class="n">vaporDensity</span><span class="p">)))</span>
<span class="go">True</span>
</pre></div>
</div>
<p>and</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">numerix</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">P</span><span class="p">(</span><span class="n">liquidDensity</span><span class="p">),</span> <span class="n">P</span><span class="p">(</span><span class="n">vaporDensity</span><span class="p">)))</span>
<span class="go">True</span>
</pre></div>
</div>
<p>In order to derive governing equations, the free energy functional is defined.</p>
<div class="math notranslate nohighlight">
\[F = \int \left[ f + \frac{\epsilon T}{2} \left( \partial_j \rho \right)^2 \right] dV\]</div>
<p>Using standard dissipation laws, we write the governing equations for mass and
momentum conservation,</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-mass">
<span class="eqno">(6)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-mass" title="Permalink to this equation">¶</a></span>\[\frac{\partial \rho}{\partial t} + \partial_j \left(\rho u_j \right) = 0\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-momentum">
<span class="eqno">(7)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-momentum" title="Permalink to this equation">¶</a></span>\[\frac{\partial \left( \rho u_i\right) }{\partial t} + \partial_j\left( \rho
u_iu_j \right) = \partial_j\left( \nu \left[ \partial_j u_i + \partial_i u_j
\right] \right) - \rho \partial_i \mu^{NC}\]</div>
<p>where the non-classical potential, <span class="math notranslate nohighlight">\(\mu^{NC}\)</span>, is given by,</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-nonclassicalpotential">
<span class="eqno">(8)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-nonclassicalpotential" title="Permalink to this equation">¶</a></span>\[ \mu^{NC} = \frac{\delta F}{\delta \rho} = \mu - \epsilon T \partial_j^2 \rho\]</div>
<p>As usual, to proceed, we define a mesh</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Lx</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nx</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="n">Lx</span> <span class="o">/</span> <span class="n">nx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Grid1D</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">)</span>
</pre></div>
</div>
<p>and the independent variables.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">density</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">hasOld</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\rho$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">velocity</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">hasOld</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$u$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">densityPrevious</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">velocityPrevious</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>The system of equations is solved in a fully coupled manner using a block
matrix. Defining <span class="math notranslate nohighlight">\(\mu^{NC}\)</span> as an independent variable makes it easier to
script the equations without using higher order terms.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">potentialNC</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mu^</span><span class="si">{NC}</span><span class="s1">$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-16</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">freeEnergy</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">density</span><span class="p">)</span> <span class="o">+</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">density</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">mag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">cellVolumeAverage</span>
</pre></div>
</div>
<p>In order to solve the equations numerically, an interpolation method is used to
prevent the velocity and density fields decoupling. The following velocity
correction equation (expressed in discretized form) prevents decoupling from
occurring,</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-correction">
<span class="eqno">(9)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-correction" title="Permalink to this equation">¶</a></span>\[u_{i,f}^c = \frac{A_f d_f}{\overline{d}_f} \left( \overline{ \rho \partial_i
\mu^{NC} }_f - \overline{\rho}_f \partial_{i,f} \mu^{NC} \right)\]</div>
<p>where <span class="math notranslate nohighlight">\(A_f\)</span> is the face area, <span class="math notranslate nohighlight">\(d_f\)</span> is the distance between the
adjacent cell centers and <span class="math notranslate nohighlight">\(\overline{a}_f\)</span> is the momentum conservation
equation’s matrix diagonal. The overbar refers to an averaged value between the
two adjacent cells to the face. The notation <span class="math notranslate nohighlight">\(\partial_{i,f}\)</span> refers to a
derivative evaluated directly at the face (not averaged). The variable
<span class="math notranslate nohighlight">\(u_i^c\)</span> is used to modify the velocity used in
Eq. <a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-mass">(6)</a> such that,</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-masscorrected">
<span class="eqno">(10)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-masscorrected" title="Permalink to this equation">¶</a></span>\[\frac{\partial \rho}{\partial t} + \partial_j \left(\rho \left[u_j + u_i^c
\right] \right) = 0\]</div>
<p>Equation <a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-masscorrected">(10)</a> becomes</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">matrixDiagonal</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$a_f$&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1e+20</span><span class="p">,</span> <span class="n">hasOld</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">correctionCoeff</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">_faceAreas</span> <span class="o">*</span> <span class="n">mesh</span><span class="o">.</span><span class="n">_cellDistances</span> <span class="o">/</span> <span class="n">matrixDiagonal</span><span class="o">.</span><span class="n">faceValue</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">massEqn</span> <span class="o">=</span> <span class="n">TransientTerm</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">density</span><span class="p">)</span> \
<span class="gp">... </span>          <span class="o">+</span> <span class="n">VanLeerConvectionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">velocity</span><span class="o">.</span><span class="n">faceValue</span> <span class="o">+</span> <span class="n">correctionCoeff</span> \
<span class="gp">... </span>                                        <span class="o">*</span> <span class="p">(</span><span class="n">density</span> <span class="o">*</span> <span class="n">potentialNC</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span><span class="o">.</span><span class="n">faceValue</span><span class="p">,</span> \
<span class="gp">... </span>                                  <span class="n">var</span><span class="o">=</span><span class="n">density</span><span class="p">)</span> \
<span class="gp">... </span>          <span class="o">-</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">correctionCoeff</span> <span class="o">*</span> <span class="n">density</span><span class="o">.</span><span class="n">faceValue</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">potentialNC</span><span class="p">)</span>
</pre></div>
</div>
<p>where the first term on the LHS of
Eq. <a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-correction">(9)</a> is calculated in an
explicit manner in the <code class="docutils literal notranslate"><span class="pre">VanLeerConvectionTerm</span></code> and the second term is
calculated implicitly as a <code class="docutils literal notranslate"><span class="pre">DiffusionTerm</span></code> with <span class="math notranslate nohighlight">\(\mu^{NC}\)</span> as the
independent variable.</p>
<p>In order to write Eq. <a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-momentum">(7)</a> as a
<a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> expression, the last term is rewritten such that,</p>
<div class="math notranslate nohighlight">
\[\rho \partial_i \mu^{NC} = \partial_i \left( \rho \mu^{NC} \right) - \mu^{NC} \partial_i \rho\]</div>
<p>which results in</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">viscosity</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ConvectionTerm</span> <span class="o">=</span> <span class="n">CentralDifferenceConvectionTerm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">momentumEqn</span> <span class="o">=</span> <span class="n">TransientTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">density</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">velocity</span><span class="p">)</span> \
<span class="gp">... </span>              <span class="o">+</span> <span class="n">ConvectionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">density</span><span class="o">.</span><span class="n">faceValue</span> <span class="o">*</span> <span class="n">velocity</span><span class="o">.</span><span class="n">faceValue</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">velocity</span><span class="p">)</span> \
<span class="gp">... </span>              <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">viscosity</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">velocity</span><span class="p">)</span> \
<span class="gp">... </span>              <span class="o">-</span> <span class="n">ConvectionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">density</span><span class="o">.</span><span class="n">faceValue</span> <span class="o">*</span> <span class="p">[[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">var</span><span class="o">=</span><span class="n">potentialNC</span><span class="p">)</span> \
<span class="gp">... </span>              <span class="o">+</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">density</span><span class="o">.</span><span class="n">grad</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">var</span><span class="o">=</span><span class="n">potentialNC</span><span class="p">)</span>
</pre></div>
</div>
<p>The only required boundary condition eliminates flow in or out of the domain.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">velocity</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">exteriorFaces</span><span class="p">)</span>
</pre></div>
</div>
<p>As previously stated, the <span class="math notranslate nohighlight">\(\mu^{NC}\)</span> variable will be solved implicitly. To
do this the Eq. <a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-nonclassicalpotential">(8)</a> is
linearized in <span class="math notranslate nohighlight">\(\rho\)</span> such that</p>
<div class="math notranslate nohighlight" id="equation-eq-reactivewetting-liquidvapor1d-chemicalpotentialequation">
<span class="eqno">(11)<a class="headerlink" href="#equation-eq-reactivewetting-liquidvapor1d-chemicalpotentialequation" title="Permalink to this equation">¶</a></span>\[\mu^{NC} = \mu^* + \left( \frac{\partial \mu}{\partial \rho} \right)^* \left( \rho - \rho^* \right) - \epsilon T \partial_j^2 \rho\]</div>
<p>The <span class="math notranslate nohighlight">\(^*\)</span> superscript denotes the current held value. In <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>,
<span class="math notranslate nohighlight">\(\frac{\partial \mu}{\partial \rho}\)</span> is written as,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">potentialDerivative</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ee</span> <span class="o">/</span> <span class="n">molarWeight</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gasConstant</span> <span class="o">*</span> <span class="n">temperature</span> <span class="o">*</span> <span class="n">molarWeight</span> <span class="o">/</span> <span class="n">density</span> <span class="o">/</span> <span class="p">(</span><span class="n">molarWeight</span> <span class="o">-</span> <span class="n">vbar</span> <span class="o">*</span> <span class="n">density</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>and <span class="math notranslate nohighlight">\(\mu^*\)</span> is simply,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">potential</span> <span class="o">=</span> <span class="n">mu</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
</pre></div>
</div>
<p>Eq. <a class="reference internal" href="#equation-eq-reactivewetting-liquidvapor1d-chemicalpotentialequation">(11)</a> can be
scripted as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">potentialNCEqn</span> <span class="o">=</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">potentialNC</span><span class="p">)</span> \
<span class="gp">... </span>                 <span class="o">==</span> <span class="n">potential</span> \
<span class="gp">... </span>                 <span class="o">+</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">potentialDerivative</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">density</span><span class="p">)</span> \
<span class="gp">... </span>                 <span class="o">-</span> <span class="n">potentialDerivative</span> <span class="o">*</span> <span class="n">density</span> \
<span class="gp">... </span>                 <span class="o">-</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">density</span><span class="p">)</span>
</pre></div>
</div>
<p>Due to a quirk in <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>, the gradient of <span class="math notranslate nohighlight">\(\mu^{NC}\)</span> needs to be
constrained on the boundary.  This is because <code class="docutils literal notranslate"><span class="pre">ConvectionTerm</span></code>’s will
automatically assume a zero flux, which is not what we need in this case.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">potentialNC</span><span class="o">.</span><span class="n">faceGrad</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">where</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">exteriorFaces</span><span class="p">)</span>
</pre></div>
</div>
<p>All three equations are defined and an are combined together with</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coupledEqn</span> <span class="o">=</span> <span class="n">massEqn</span> <span class="o">&amp;</span> <span class="n">momentumEqn</span> <span class="o">&amp;</span> <span class="n">potentialNCEqn</span>
</pre></div>
</div>
<p>The system will be solved as a phase separation problem with an initial density
close to the average density, but with some small amplitude noise. Under these
circumstances, the final condition should be two separate phases of roughly equal
volume. The initial condition for the density is defined by</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">numerix</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2011</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">density</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">liquidDensity</span> <span class="o">+</span> <span class="n">vaporDensity</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> \
<span class="gp">... </span>   <span class="p">(</span><span class="mi">1</span>  <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numerix</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">numberOfCells</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Viewers are also defined.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">viewers</span> <span class="o">=</span> <span class="n">Viewer</span><span class="p">(</span><span class="n">density</span><span class="p">),</span> <span class="n">Viewer</span><span class="p">(</span><span class="n">velocity</span><span class="p">),</span> <span class="n">Viewer</span><span class="p">(</span><span class="n">potentialNC</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">viewer</span> <span class="ow">in</span> <span class="n">viewers</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">... </span>    <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Arrange viewers, then press &lt;return&gt; to proceed...&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">viewer</span> <span class="ow">in</span> <span class="n">viewers</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>The following section defines the required control parameters. The <cite>cfl</cite>
parameter limits the size of the time step so that
<cite>dt = cfl * dx / max(velocity)</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cfl</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1e-1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-14</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timestep</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">relaxation</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">totalSteps</span> <span class="o">=</span> <span class="mf">1e10</span>
<span class="gp">... </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">totalSteps</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>In the following time stepping scheme a time step is recalculated if the residual
increases between sweeps or the required tolerance is not attained within 20
sweeps. The major quirk in this scheme is the requirement of updating the
<code class="docutils literal notranslate"><span class="pre">matrixDiagonal</span></code> using the entire coupled matrix. This could be achieved more
elegantly by calling <code class="docutils literal notranslate"><span class="pre">cacheMatrix()</span></code> only on the necessary part of the
equation. This currently doesn’t work properly in <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>.</p>
<p>Beginning with <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> 4, solver <a class="reference internal" href="../SOLVERS.html#convergence"><span class="std std-ref">Convergence</span></a>
tolerance is normalized by the magnitude of the right-hand-side (RHS)
vector.  For this particular problem, the initial residual is much smaller
than the RHS and so the solver gets “stuck”.  Changing the normalization to
use the initial residual at the beginning of each sweep allows the solution
to progress.  Another option would be to scale the tolerance appropriately,
but the value is so small (<span class="math notranslate nohighlight">\(\sim 10^{-22}\)</span>) that this results in
underflow issues for some solvers.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">solver</span> <span class="o">=</span> <span class="n">coupledEqn</span><span class="o">.</span><span class="n">getDefaultSolver</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;initial&quot;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> intrinsically wants to use <cite>“preconditioned”</cite>
normalization, which prevents the solver from getting “stuck” because
the preconditioner effectively scales the RHS to be similar in magnitude
to the residual.  Unfortunately, this normalization is not available for
the other solver suites, so we don’t use it as the default.</p>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="n">timestep</span> <span class="o">&lt;</span> <span class="n">totalSteps</span><span class="p">:</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">sweep</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">... </span>    <span class="n">dt</span> <span class="o">*=</span> <span class="mf">1.1</span>
<span class="gp">... </span>    <span class="n">residual</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="gp">... </span>    <span class="n">initialResidual</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">density</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">velocity</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">matrixDiagonal</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="n">residual</span> <span class="o">&gt;</span> <span class="n">tolerance</span><span class="p">:</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="n">densityPrevious</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">density</span>
<span class="gp">... </span>        <span class="n">velocityPrevious</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">velocity</span>
<span class="gp">... </span>        <span class="n">previousResidual</span> <span class="o">=</span> <span class="n">residual</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="n">dt</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">velocity</span><span class="p">))</span> <span class="o">*</span> <span class="n">cfl</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="n">coupledEqn</span><span class="o">.</span><span class="n">cacheMatrix</span><span class="p">()</span>
<span class="gp">... </span>        <span class="n">residual</span> <span class="o">=</span> <span class="n">coupledEqn</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">initialResidual</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">initialResidual</span> <span class="o">=</span> <span class="n">residual</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="n">residual</span> <span class="o">=</span> <span class="n">residual</span> <span class="o">/</span> <span class="n">initialResidual</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">residual</span> <span class="o">&gt;</span> <span class="n">previousResidual</span> <span class="o">*</span> <span class="mf">1.1</span> <span class="ow">or</span> <span class="n">sweep</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">density</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">old</span>
<span class="gp">... </span>            <span class="n">velocity</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">velocity</span><span class="o">.</span><span class="n">old</span>
<span class="gp">... </span>            <span class="n">matrixDiagonal</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">matrixDiagonal</span><span class="o">.</span><span class="n">old</span>
<span class="gp">... </span>            <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">/</span> <span class="mf">10.</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Recalculate the time step&#39;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">timestep</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="gp">... </span>            <span class="k">break</span>
<span class="gp">... </span>        <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">matrixDiagonal</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">coupledEqn</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">takeDiagonal</span><span class="p">()[</span><span class="n">mesh</span><span class="o">.</span><span class="n">numberOfCells</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mesh</span><span class="o">.</span><span class="n">numberOfCells</span><span class="p">]</span>
<span class="gp">... </span>            <span class="n">density</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">relaxation</span> <span class="o">*</span> <span class="n">density</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">relaxation</span><span class="p">)</span> <span class="o">*</span> <span class="n">densityPrevious</span>
<span class="gp">... </span>            <span class="n">velocity</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">relaxation</span> <span class="o">*</span> <span class="n">velocity</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">relaxation</span><span class="p">)</span> <span class="o">*</span> <span class="n">velocityPrevious</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="n">sweep</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span> <span class="ow">and</span> <span class="n">timestep</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;timestep: </span><span class="si">%e</span><span class="s1"> / </span><span class="si">%e</span><span class="s1">, dt: </span><span class="si">%1.5e</span><span class="s1">, free energy: </span><span class="si">%1.5e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">timestep</span><span class="p">,</span> <span class="n">totalSteps</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">freeEnergy</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">for</span> <span class="n">viewer</span> <span class="ow">in</span> <span class="n">viewers</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">timestep</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;finished&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">freeEnergy</span> <span class="o">&lt;</span> <span class="mf">1.5e9</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</section>


                <div class='last-updated'>
                Last updated on Sep 08, 2025.
                Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.1.2.
                </div>
              </div>
  </div>  
  <aside class="nist-page__region nist-page__region--sidebar-second tablet-lg:grid-col-4">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

<strong>FiPy: A Finite Volume PDE Solver Using Python</strong><br />
Version 3.99+5.gde29bb8c4

<div class="sphinxsidebarsection">
  <h4>Previous topic</h4>
  <p class="topless"><a href="examples.reactiveWetting.html"
                        title="previous chapter">examples.reactiveWetting</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="examples.reactiveWetting.liquidVapor2D.html"
                        title="next chapter">examples.reactiveWetting.liquidVapor2D</a></p>
</div>
  <div class="sphinxsidebarsection">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/generated/examples.reactiveWetting.liquidVapor1D.rst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  </div>
<div class="sphinxsidebarsection">
<div id="searchbox" style="display: none" role="search">
  <div data-layout-content-preview-placeholder-label="&quot;Sphinx
  Search&quot; field" class="nist-block nist-block--search">
  <h2 id="searchlabel">Quick search</h2>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
  </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
</div>
<div class="sphinxsidebarsection" id="contact-wrapper">
  
        <div data-layout-content-preview-placeholder-label="&quot;Related
        organization tree&quot; views block" class="nist-block nist-block--org">
          
          <h2 class="nist-block__title">Organizations</h2>
              
              <div class="views-element-container"><div
              class="js-view-dom-id-70b0923f677edbe3dda361030ef8dc373cd0ca94065c39cfd81338de767f1019">

            <div class="nist-related-orgs"><div class="term-tree-list"><ul
            class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters" hreflang="en">NIST
            Headquarters</a><ul class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs"
            hreflang="en">Laboratory Programs</a><ul class="term"><li
            class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs/material-measurement-laboratory"
            hreflang="en">Material Measurement Laboratory</a>
			<ul
			class="term"><li
			class="selected"><a href="https://www.nist.gov/mml/msed"
			hreflang="en">Materials Science and Engineering
			Division</a></li><li
			class="selected"><a href="https://www.nist.gov/mml/ctcms"
			hreflang="en">Center for Theoretical and
			              Computational Materials Science</a></li></ul>
                          </li></ul></li></ul></li></ul></div></div>
          <div class="nist-related-orgs"></div>
          <div class="nist-related-orgs"></div>



        </div>
        </div>

          </div>


          <div data-layout-content-preview-placeholder-label="&quot;NIST
          Staff&quot; field" class="nist-block nist-block--contact">

          <h2 class="nist-block__title">NIST Staff</h2>

                  <div class="nist-field nist-field--label-hidden
                  nist-field--link-list entity-reference nist-field__items
                  nist-field--no-margin">
                            <div class="nist-field__item
                            nist-field--no-margin"><a
                            href="https://www.nist.gov/people/jonathan-e-guyer"
                            hreflang="en">Jonathan E. Guyer</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/daniel-wheeler"
                                hreflang="en">Daniel Wheeler</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/james-warren"
                                hreflang="en">James A. Warren</a></div>
                  </div>


          </div>

          <div data-layout-content-preview-placeholder-label="&quot;Contact&quot; field"
          class="nist-block nist-block--contact nist-block--mail">

          <h2 class="nist-block__title">
          <a class="" href="../docs/source/CONTACT.html" style="">Contact</a>
          </h2>

          </div>

</div>
        </div>
      </div>
      <div class="clearer"></div>
  </aside>
        </div>
      </div>

      <div class="panel-region--postface">
      <div class="inner region-inner inside">
        
<div class="pane pane--nist-node-date-pane" >

    </div>
      </div>
    </div>

        </section>
        </div>
      </div>

      </div>  
    </div>          

    </div>

  </div>

</div>


  


  <!-- Taken from https://www.filamentgroup.com/lab/html-includes/#another-demo%3A-including-another-html-file -->
  <iframe src="../_static/ntd2d_menu.html" onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()"></iframe>
    </div>
  </body>
</html>