
<!DOCTYPE html>


<!--[if IEMobile 7]><html class="iem7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if lte IE 6]><html class="lt-ie9 lt-ie8 lt-ie7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (IE 7)&(!IEMobile)]><html class="lt-ie9 lt-ie8 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if IE 8]><html class="lt-ie9 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)]><!--><html class="no-js"  lang="en" dir="ltr" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# book: http://ogp.me/ns/book# profile: http://ogp.me/ns/profile# video: http://ogp.me/ns/video# product: http://ogp.me/ns/product# content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"><!--<![endif]-->

  <head>
<meta charset="utf-8" />
<link rel="shortcut icon" href="https://www.nist.gov/sites/all/themes/nist_style/favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/x-mathjax-config">MathJax.Hub.Config({
  extensions: ['tex2jax.js'],
  jax: ['input/TeX','output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$$','$$'], ['\\(','\\)'] ],
    processEscapes: true,
    processClass: 'tex2jax',
    ignoreClass: 'html'
  },
  showProcessingMessages: false,
  messageStyle: 'none'
});
</script>
<meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">

      <!--[if lt IE 9]>
    <script src="https://www.nist.gov/sites/all/themes/zen/js/html5-respond.js"></script>
    <![endif]-->
    <!--[if (gte IE 6)&(lte IE 8)]>
  <script type="text/javascript" src="https://www.nist.gov/sites/all/themes/nist_style/js/selectivizr-min.js"></script>
  <![endif]--><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Using FiPy &#8212; FiPy 3.4.3+141.g9c8f5a4b documentation</title>
    <link rel="stylesheet" href="../_static/ntd2d.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/ntd2d.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="FiPy 3.4.3+141.g9c8f5a4b documentation" href="contents.html" />
    <link rel="up" title="Introduction" href="introduction.html" />
    <link rel="next" title="Frequently Asked Questions" href="FAQ.html" />
    <link rel="prev" title="Viewers" href="VIEWERS.html" />
  
 


  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-3.6.2.min.js" type="text/javascript" defer="defer"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>

  </head>
<!--  <body role="document">-->
  <body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-414011 node-type-software hide-breadcrumb section-services-resources page-panels is-panel" role="document">
      <div id="page" class="mini-header">



    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="FAQ.html" title="Frequently Asked Questions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="VIEWERS.html" title="Viewers"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html"><img src="../_static/fipy.png" alt="FiPy logo"
                 style="vertical-align: middle; margin-top: -1px"/>
        FiPy</a> &gt;</li>

          <li class="nav-item nav-item-1"><a href="introduction.html" accesskey="U">Introduction</a> &gt;</li> 
      </ul>
    </div>

  <div id="main" class="clearfix" role="main" tabindex="-1">
    <div class="main__inner">
      <div class="page-info">
        <a id="main-content"></a>
      </div>

      <div class="document">
        <div class="documentwrapper">

      <div id="content" class="column">
      <div id="block-nist-www-content" class="nist-block">
        <section class="nist-page__content usa-section clearfix">

         

        <div class="grid-container margin-top-4">
        <div class="grid-row grid-gap-6">

  <div class="nist-page__region nist-page__region--content tablet-lg:grid-col-8">
              <div class="body" role="main">
		
  <section id="using-fipy">
<span id="usage"></span><h1>Using FiPy<a class="headerlink" href="#using-fipy" title="Permalink to this heading">¶</a></h1>
<p>This document explains how to use <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> in a practical sense.
To see the problems that <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> is capable of solving, you can
run any of the scripts in the <a class="reference internal" href="../examples/README.html#part-examples"><span class="std std-ref">examples</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We strongly recommend you proceed through the <a class="reference internal" href="../examples/README.html#part-examples"><span class="std std-ref">examples</span></a>, but at the very least work through
<a class="reference internal" href="../examples/diffusion/generated/examples.diffusion.mesh1D.html#module-examples.diffusion.mesh1D" title="examples.diffusion.mesh1D"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.mesh1D</span></code></a> to understand the notation and
basic concepts of <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>.</p>
</div>
<p>We exclusively use either the UNIX command line or <a class="reference internal" href="glossary.html#term-IPython"><span class="xref std std-term">IPython</span></a> to
interact with <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>. The commands in the <a class="reference internal" href="../examples/README.html#part-examples"><span class="std std-ref">examples</span></a> are written with the assumption that they will be
executed from the command line. For instance, from within the main
<a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> directory, you can type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python examples/diffusion/mesh1D.py
</pre></div>
</div>
<p>A viewer should appear and you should be prompted through a series of
examples.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>From within <a class="reference internal" href="glossary.html#term-IPython"><span class="xref std std-term">IPython</span></a>, you would type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">run</span> <span class="n">examples</span><span class="o">/</span><span class="n">diffusion</span><span class="o">/</span><span class="n">mesh1D</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<p>In order to customize the examples, or to develop your own scripts, some
knowledge of Python syntax is required.  We recommend you familiarize
yourself with the excellent <a class="reference external" href="http://docs.python.org/tut/tut.html">Python tutorial</a> <span id="id1">[<a class="reference internal" href="references.html#id24" title="Guido van Rossum. Python Tutorial. URL: http://docs.python.org/tut/.">10</a>]</span>
or with <a class="reference external" href="http://diveintopython.org">Dive Into Python</a> <span id="id2">[<a class="reference internal" href="references.html#id26" title="Mark Pilgrim. Dive Into Python. Apress, 2004. ISBN 1590593561. URL: http://diveintopython.org.">11</a>]</span>. Deeper insight into
Python can be obtained from the <span id="id3">[<a class="reference internal" href="references.html#id25" title="Guido van Rossum. Python Reference Manual. URL: http://docs.python.org/ref/.">12</a>]</span>.</p>
<p>As you gain experience, you may want to browse through the
<a class="reference internal" href="#flagsandenvironmentvariables"><span class="std std-ref">Command-line Flags and Environment Variables</span></a> that affect <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>.</p>
<section id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this heading">¶</a></h2>
<p>Diagnostic information about a <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> run can be obtained using the
<a class="reference external" href="https://docs.python.org/3/library/logging.html#module-logging" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> module.  For example, at the beginning of your script, you
can add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">logging</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;fipy&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">console</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">console</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console</span><span class="p">)</span>
</pre></div>
</div>
<p>in order to see informational messages in the terminal.  To have more
verbose debugging information save to a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;fipy.log&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logfile</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logfile</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
<p>To restrict logging to, e.g., information about the <a class="reference internal" href="glossary.html#term-PETSc"><span class="xref std std-term">PETSc</span></a> solvers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">petsc</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="s1">&#39;fipy.solvers.petsc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logfile</span><span class="o">.</span><span class="n">addFilter</span><span class="p">(</span><span class="n">petsc</span><span class="p">)</span>
</pre></div>
</div>
<p>More complex configurations can be specified by setting the
<span class="target" id="index-0"></span><a class="reference internal" href="#envvar-FIPY_LOG_CONFIG"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">FIPY_LOG_CONFIG</span></code></a> environment variable.  In this case, it is not
necessary to add any logging instructions to your own script.  Example
configuration files can be found in
<code class="file docutils literal notranslate"><em><span class="pre">FiPySource</span></em><span class="pre">/fipy/tools/logging/</span></code>.</p>
<p>If <a class="reference internal" href="#solving-in-parallel">Solving in Parallel</a>, the <code class="xref py py-mod docutils literal notranslate"><span class="pre">mpilogging</span></code> package (which can be
installed via <a class="reference internal" href="glossary.html#term-PyPI"><span class="xref std std-term">PyPI</span></a>) enables reporting which MPI rank each log entry
comes from.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mpilogging</span> <span class="kn">import</span> <span class="n">MPIScatteredFileHandler</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mpilog</span> <span class="o">=</span> <span class="n">MPIScatteredFileHandler</span><span class="p">(</span><span class="n">filepattern</span><span class="o">=</span><span class="s2">&quot;fipy.</span><span class="si">%(mpirank)d</span><span class="s2">_of_</span><span class="si">%(mpisize)d</span><span class="s2">.log&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mpilog</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">mpilog</span><span class="p">)</span>
</pre></div>
</div>
<p>will generate a unique log file for each MPI rank.</p>
</section>
<section id="testing-fipy">
<h2>Testing FiPy<a class="headerlink" href="#testing-fipy" title="Permalink to this heading">¶</a></h2>
<p>For a general installation, <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> can be tested by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -c &quot;import fipy; fipy.test()&quot;
</pre></div>
</div>
<p>This command runs all the test cases in <a class="reference internal" href="API.html#part-modules"><span class="std std-ref">FiPy’s modules</span></a>, but doesn’t include any of the tests in <a class="reference internal" href="../examples/README.html#part-examples"><span class="std std-ref">FiPy’s
examples</span></a>. To run the test cases in both <a class="reference internal" href="API.html#part-modules"><span class="std std-ref">modules</span></a> and <a class="reference internal" href="../examples/README.html#part-examples"><span class="std std-ref">examples</span></a>, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python setup.py test
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may need to first run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python setup.py egg_info
</pre></div>
</div>
<p>for this to work properly.</p>
</div>
<p>in an unpacked <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> archive. The test suite can be run with a
number of different configurations depending on which solver suite is
available and other factors. See <a class="reference internal" href="#flagsandenvironmentvariables"><span class="std std-ref">Command-line Flags and Environment Variables</span></a>
for more details.</p>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> will skip tests that depend on <a class="reference internal" href="../INSTALLATION.html#optionalpackages"><span class="std std-ref">Optional Packages</span></a> that
have not been installed. For example, if <a class="reference internal" href="glossary.html#term-Mayavi"><span class="xref std std-term">Mayavi</span></a> and <a class="reference internal" href="glossary.html#term-Gmsh"><span class="xref std std-term">Gmsh</span></a>
are not installed, <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> will warn something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
Skipped 131 doctest examples because `gmsh` cannot be found on the $PATH
Skipped 42 doctest examples because the `tvtk` package cannot be imported
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</pre></div>
</div>
<p>Although the test suite may show warnings, there should be no other errors.
Any errors should be investigated or reported on the <a class="reference external" href="https://github.com/usnistgov/fipy/issues/new">issue tracker</a>.
Users can see if there are any known problems for the latest <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>
distribution by checking <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>’s <a class="reference internal" href="ADMINISTRATA.html#continuousintegration"><span class="std std-ref">Continuous Integration</span></a> dashboard.</p>
<p>Below are a number of common <a class="reference internal" href="#command-line-flags">Command-line Flags</a> for testing various
<a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> configurations.</p>
<section id="parallel-tests">
<h3>Parallel Tests<a class="headerlink" href="#parallel-tests" title="Permalink to this heading">¶</a></h3>
<p>If <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> is configured for <a class="reference internal" href="#parallel"><span class="std std-ref">Solving in Parallel</span></a>, you can run the tests
on multiple processor cores with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np {# of processors} python setup.py test --trilinos
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np {# of processors} python -c &quot;import fipy; fipy.test(&#39;--trilinos&#39;)&quot;
</pre></div>
</div>
</section>
</section>
<section id="command-line-flags-and-environment-variables">
<span id="flagsandenvironmentvariables"></span><h2>Command-line Flags and Environment Variables<a class="headerlink" href="#command-line-flags-and-environment-variables" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> chooses a default run time configuration based on the
available packages on the system. The <a class="reference internal" href="#command-line-flags">Command-line Flags</a> and
<a class="reference internal" href="#environment-variables">Environment Variables</a> sections below describe how to override
<a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>’s default behavior.</p>
<section id="command-line-flags">
<h3>Command-line Flags<a class="headerlink" href="#command-line-flags" title="Permalink to this heading">¶</a></h3>
<p>You can add any of the following case-insensitive flags after the name of a
script you call from the command line, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python myFiPyScript --someflag
</pre></div>
</div>
<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-inline">
<span class="sig-name descname"><span class="pre">--inline</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-inline" title="Permalink to this definition">¶</a></dt>
<dd><p>Causes many mathematical operations to be performed in C, rather than
Python, for improved performance. Requires the <code class="xref py py-mod docutils literal notranslate"><span class="pre">weave</span></code>
package.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-cache">
<span class="sig-name descname"><span class="pre">--cache</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Causes lazily evaluated <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>
<a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.variable.Variable" title="fipy.variables.variable.Variable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variable</span></code></a> objects to retain their
value.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-no-cache">
<span class="sig-name descname"><span class="pre">--no-cache</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-no-cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Causes lazily evaluated <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>
<a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.variable.Variable" title="fipy.variables.variable.Variable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variable</span></code></a> objects to always recalculate
their value.</p>
</dd></dl>

<p>The following flags take precedence over the <span class="target" id="index-1"></span><a class="reference internal" href="#envvar-FIPY_SOLVERS"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">FIPY_SOLVERS</span></code></a>
environment variable:</p>
<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-pysparse">
<span class="sig-name descname"><span class="pre">--pysparse</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-pysparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the <a class="reference internal" href="SOLVERS.html#pysparse"><span class="std std-ref">Pysparse</span></a> solvers.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-trilinos">
<span class="sig-name descname"><span class="pre">--trilinos</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-trilinos" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> solvers, but uses
<a class="reference internal" href="SOLVERS.html#pysparse"><span class="std std-ref">Pysparse</span></a> to construct the matrices.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-no-pysparse">
<span class="sig-name descname"><span class="pre">--no-pysparse</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-no-pysparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> solvers without any use of
<a class="reference internal" href="SOLVERS.html#pysparse"><span class="std std-ref">Pysparse</span></a>.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-scipy">
<span class="sig-name descname"><span class="pre">--scipy</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-scipy" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the <a class="reference internal" href="SOLVERS.html#scipy"><span class="std std-ref">SciPy</span></a> solvers.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-pyamg">
<span class="sig-name descname"><span class="pre">--pyamg</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-pyamg" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the <a class="reference internal" href="SOLVERS.html#pyamg"><span class="std std-ref">PyAMG</span></a> preconditioners in conjunction
with the <a class="reference internal" href="SOLVERS.html#scipy"><span class="std std-ref">SciPy</span></a> solvers.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-pyamgx">
<span class="sig-name descname"><span class="pre">--pyamgx</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-pyamgx" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the <a class="reference internal" href="SOLVERS.html#pyamgx"><span class="std std-ref">pyamgx</span></a> solvers.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-lsmlib">
<span class="sig-name descname"><span class="pre">--lsmlib</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-lsmlib" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the <a class="reference internal" href="../INSTALLATION.html#lsmlibdoc"><span class="std std-ref">LSMLIB</span></a> level set solver.</p>
</dd></dl>

<dl class="std cmdoption">
<dt class="sig sig-object std" id="cmdoption-skfmm">
<span class="sig-name descname"><span class="pre">--skfmm</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-skfmm" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the <a class="reference internal" href="../INSTALLATION.html#scikitfmm"><span class="std std-ref">Scikit-fmm</span></a> level set solver.</p>
</dd></dl>

</section>
<section id="environment-variables">
<h3>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this heading">¶</a></h3>
<p>You can set any of the following environment variables in the manner
appropriate for your shell. If you are not running in a shell (<em>e.g.</em>,
you are invoking <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> scripts from within <a class="reference internal" href="glossary.html#term-IPython"><span class="xref std std-term">IPython</span></a> or IDLE),
you can set these variables via the <a class="reference external" href="https://docs.python.org/3/library/os.html#os.environ" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">os.environ</span></code></a> dictionary,
but you must do so before importing anything from the <a class="reference internal" href="../fipy/generated/fipy.html#module-fipy" title="fipy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fipy</span></code></a>
package.</p>
<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-FIPY_DISPLAY_MATRIX">
<span class="sig-name descname"><span class="pre">FIPY_DISPLAY_MATRIX</span></span><a class="headerlink" href="#envvar-FIPY_DISPLAY_MATRIX" title="Permalink to this definition">¶</a></dt>
<dd><p>If present, causes the graphical display of the solution matrix of each
equation at each call of <a class="reference internal" href="../fipy/generated/fipy.terms.html#fipy.terms.term.Term.solve" title="fipy.terms.term.Term.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">solve()</span></code></a> or <a class="reference internal" href="../fipy/generated/fipy.terms.html#fipy.terms.term.Term.sweep" title="fipy.terms.term.Term.sweep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sweep()</span></code></a>.
Setting the value to “<code class="docutils literal notranslate"><span class="pre">terms</span></code>” causes the display of the matrix for each
<a class="reference internal" href="../fipy/generated/fipy.terms.html#fipy.terms.term.Term" title="fipy.terms.term.Term"><code class="xref py py-class docutils literal notranslate"><span class="pre">Term</span></code></a> that composes the equation. Requires the <a class="reference internal" href="glossary.html#term-Matplotlib"><span class="xref std std-term">Matplotlib</span></a>
package. Setting the value to “<code class="docutils literal notranslate"><span class="pre">print</span></code>” causes the matrix to be
printed to the console.</p>
</dd></dl>

<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-FIPY_INLINE">
<span class="sig-name descname"><span class="pre">FIPY_INLINE</span></span><a class="headerlink" href="#envvar-FIPY_INLINE" title="Permalink to this definition">¶</a></dt>
<dd><p>If present, causes many mathematical operations to be performed in C,
rather than Python. Requires the <code class="xref py py-mod docutils literal notranslate"><span class="pre">weave</span></code> package.</p>
</dd></dl>

<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-FIPY_INLINE_COMMENT">
<span class="sig-name descname"><span class="pre">FIPY_INLINE_COMMENT</span></span><a class="headerlink" href="#envvar-FIPY_INLINE_COMMENT" title="Permalink to this definition">¶</a></dt>
<dd><p>If present, causes the addition of a comment showing the Python context
that produced a particular piece of <code class="xref py py-mod docutils literal notranslate"><span class="pre">weave</span></code> C code. Useful
for debugging.</p>
</dd></dl>

<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-FIPY_LOG_CONFIG">
<span class="sig-name descname"><span class="pre">FIPY_LOG_CONFIG</span></span><a class="headerlink" href="#envvar-FIPY_LOG_CONFIG" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies a <a class="reference internal" href="glossary.html#term-JSON"><span class="xref std std-term">JSON</span></a>-formatted logging configuration file, suitable
for passing to <a class="reference external" href="https://docs.python.org/3/library/logging.config.html#logging.config.dictConfig" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">logging.config.dictConfig()</span></code></a>.  Example configuration
files can be found in <code class="file docutils literal notranslate"><em><span class="pre">FiPySource</span></em><span class="pre">/fipy/tools/logging/</span></code>.</p>
</dd></dl>

<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-FIPY_SOLVERS">
<span class="sig-name descname"><span class="pre">FIPY_SOLVERS</span></span><a class="headerlink" href="#envvar-FIPY_SOLVERS" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the specified suite of linear solvers.  Valid
(case-insensitive) choices are “<code class="docutils literal notranslate"><span class="pre">petsc</span></code>”, “<code class="docutils literal notranslate"><span class="pre">scipy</span></code>”, “<code class="docutils literal notranslate"><span class="pre">pysparse</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">trilinos</span></code>”, “<code class="docutils literal notranslate"><span class="pre">no-pysparse</span></code>”, and “<code class="docutils literal notranslate"><span class="pre">pyamg</span></code>”.</p>
</dd></dl>

<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-FIPY_VERBOSE_SOLVER">
<span class="sig-name descname"><span class="pre">FIPY_VERBOSE_SOLVER</span></span><a class="headerlink" href="#envvar-FIPY_VERBOSE_SOLVER" title="Permalink to this definition">¶</a></dt>
<dd><p>If present, causes the
<a class="reference internal" href="../fipy/generated/fipy.solvers.pyAMG.html#fipy.solvers.pyAMG.linearGeneralSolver.LinearGeneralSolver" title="fipy.solvers.pyAMG.linearGeneralSolver.LinearGeneralSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LinearGeneralSolver</span></code></a> to
print a variety of diagnostic information.  All other solvers should use
<a class="reference internal" href="#logging">Logging</a> and <span class="target" id="index-2"></span><a class="reference internal" href="#envvar-FIPY_LOG_CONFIG"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">FIPY_LOG_CONFIG</span></code></a>.</p>
</dd></dl>

<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-FIPY_VIEWER">
<span class="sig-name descname"><span class="pre">FIPY_VIEWER</span></span><a class="headerlink" href="#envvar-FIPY_VIEWER" title="Permalink to this definition">¶</a></dt>
<dd><p>Forces the use of the specified viewer. Valid values are any
<code class="samp docutils literal notranslate"><em><span class="pre">&lt;viewer&gt;</span></em></code> from the
<code class="samp docutils literal notranslate"><span class="pre">fipy.viewers.</span><em><span class="pre">&lt;viewer&gt;</span></em><span class="pre">Viewer</span></code>
modules. The special value of <code class="docutils literal notranslate"><span class="pre">dummy</span></code> will allow the script
to run without displaying anything.</p>
</dd></dl>

<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-FIPY_INCLUDE_NUMERIX_ALL">
<span class="sig-name descname"><span class="pre">FIPY_INCLUDE_NUMERIX_ALL</span></span><a class="headerlink" href="#envvar-FIPY_INCLUDE_NUMERIX_ALL" title="Permalink to this definition">¶</a></dt>
<dd><p>If present, causes the inclusion of all functions and variables of the
<a class="reference internal" href="../fipy/generated/fipy.tools.html#module-fipy.tools.numerix" title="fipy.tools.numerix"><code class="xref py py-mod docutils literal notranslate"><span class="pre">numerix</span></code></a> module in the <a class="reference internal" href="../fipy/generated/fipy.html#module-fipy" title="fipy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fipy</span></code></a> namespace.</p>
</dd></dl>

<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-FIPY_CACHE">
<span class="sig-name descname"><span class="pre">FIPY_CACHE</span></span><a class="headerlink" href="#envvar-FIPY_CACHE" title="Permalink to this definition">¶</a></dt>
<dd><p>If present, causes lazily evaluated <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>
<a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.variable.Variable" title="fipy.variables.variable.Variable"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variable</span></code></a> objects to
retain their value.</p>
</dd></dl>

<dl class="std envvar">
<dt class="sig sig-object std" id="envvar-PETSC_OPTIONS">
<span class="sig-name descname"><span class="pre">PETSC_OPTIONS</span></span><a class="headerlink" href="#envvar-PETSC_OPTIONS" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://docs.petsc.org/en/latest/manual/other/#sec-options">PETSc configuration options</a>.  Set to “<cite>-help</cite>” and run a script with
<a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> solvers in order to see what options are possible.  Ignored
if solver is not <a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a>.</p>
</dd></dl>

</section>
</section>
<section id="solving-in-parallel">
<span id="parallel"></span><h2>Solving in Parallel<a class="headerlink" href="#solving-in-parallel" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> can use <a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> or <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> to solve equations in
parallel. Most mesh classes in <a class="reference internal" href="../fipy/generated/fipy.meshes.html#module-fipy.meshes" title="fipy.meshes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fipy.meshes</span></code></a> can solve in
parallel. This includes all “<code class="docutils literal notranslate"><span class="pre">...Grid...</span></code>” and “<code class="docutils literal notranslate"><span class="pre">...Gmsh...</span></code>”
class meshes. Currently, the only remaining serial-only meshes are
<a class="reference internal" href="../fipy/generated/fipy.meshes.html#fipy.meshes.tri2D.Tri2D" title="fipy.meshes.tri2D.Tri2D"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tri2D</span></code></a> and
<a class="reference internal" href="../fipy/generated/fipy.meshes.html#fipy.meshes.skewedGrid2D.SkewedGrid2D" title="fipy.meshes.skewedGrid2D.SkewedGrid2D"><code class="xref py py-class docutils literal notranslate"><span class="pre">SkewedGrid2D</span></code></a>.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> requires <a class="reference internal" href="glossary.html#term-mpi4py"><span class="xref std std-term">mpi4py</span></a> to work in parallel.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You are strongly advised to force the use of only one <a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a>
thread with <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export OMP_NUM_THREADS=1
</pre></div>
</div>
<p>See <a class="reference internal" href="#threads-vs-ranks"><span class="std std-ref">OpenMP Threads vs. MPI Ranks</span></a> for more information.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://github.com/trilinos/Trilinos/issues/3203">Trilinos 12.12 has support for Python 3</a>, but
<a class="reference external" href="https://anaconda.org/conda-forge/pytrilinos">PyTrilinos on conda-forge</a> presently only provides 12.10, which is
limited to Python 2.x. <a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> is available for both <a class="reference internal" href="glossary.html#term-Python-3"><span class="xref std std-term">Python
3</span></a> and <a class="reference internal" href="glossary.html#term-Python"><span class="xref std std-term">Python</span></a> 2.7.</p>
</div>
<p>It should not generally be necessary to change anything in your script.
Simply invoke:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np {# of processors} python myScript.py --petsc
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np {# of processors} python myScript.py --trilinos
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python myScript.py
</pre></div>
</div>
<p>The following plot shows the scaling behavior for multiple
processors.  We compare solution time vs number of <a class="reference external" href="https://slurm.schedmd.com">Slurm</a> tasks (available
cores) for a <a class="reference external" href="https://pages.nist.gov/pfhub/benchmarks/benchmark7.ipynb">Method of Manufactured Solutions Allen-Cahn problem</a>.</p>
<p>(<a class="reference download internal" download="" href="../_downloads/ef5c841d832aa9e27f5f4b6c42e77874/scaling.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<p>“Speedup” relative to <a class="reference internal" href="SOLVERS.html#pysparse"><span class="std std-ref">Pysparse</span></a> (bigger numbers are better) versus
number of tasks (processes) on a log-log plot.  The number of threads per
<a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> rank is indicated by the line style (see legend).
<a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> threads <span class="math notranslate nohighlight">\(\times\)</span> <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> ranks = <a class="reference external" href="https://slurm.schedmd.com">Slurm</a> tasks.</p>
<p>A few things can be observed in this plot:</p>
<ul class="simple">
<li><p>Both <a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> and <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> exhibit power law scaling, but the
power is only about 0.7.  At least one source of this poor scaling is
that our “<code class="docutils literal notranslate"><span class="pre">...Grid...</span></code>” meshes parallelize by dividing the mesh into
slabs, which leads to more communication overhead than more compact
partitions.  The “<code class="docutils literal notranslate"><span class="pre">...Gmsh...</span></code>” meshes partition more efficiently, but
carry more overhead in other ways.  We’ll be making efforts to improve
the partitioning of the “<code class="docutils literal notranslate"><span class="pre">...Grid...</span></code>” meshes in a future release.</p></li>
<li><p><a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> and <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> have fairly comparable performance, but
lag <a class="reference internal" href="SOLVERS.html#pysparse"><span class="std std-ref">Pysparse</span></a> by a considerable margin.  The <a class="reference internal" href="SOLVERS.html#scipy"><span class="std std-ref">SciPy</span></a> solvers
are even worse.  Some of this discrepancy may be because the different
packages are not all doing the same thing.  Different solver packages
have different default solvers and preconditioners.  Moreover, the
meaning of the solution tolerance depends on the normalization the solver
uses and it is not always obvious which of several possibilities a
particular package employs.  We will endeavor to normalize the
normalizations in a future release.</p></li>
<li><p><a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> with one thread is faster than with two threads until the
number of tasks reaches about 10 and is faster than with four threads
until the number of tasks reaches more than 20.  <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> with one
thread is faster than with two threads until the number of tasks is more
than 30.  We don’t fully understand the reasons for this, but there may be
a <em>modest</em> benefit, <em>when using a large number of cpus</em>, to allow two to
four <a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> threads per <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> rank.  See
<a class="reference internal" href="#threads-vs-ranks"><span class="std std-ref">OpenMP Threads vs. MPI Ranks</span></a> for caveats and more information.</p></li>
</ul>
<p>These results are likely both problem and architecture dependent.  You
should develop an understanding of the scaling behavior of your own codes
before doing “production” runs.</p>
<p>The easiest way to confirm that <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> is properly configured to
solve in parallel is to run one of the examples, e.g.,:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np 2 examples/diffusion/mesh1D.py
</pre></div>
</div>
<p>You should see two viewers open with half the simulation running in one of
them and half in the other. If this does not look right (e.g., you get two
viewers, both showing the entire simulation), or if you just want to be
sure, you can run a diagnostic script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np 3 python examples/parallel.py
</pre></div>
</div>
<p>which should print out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">mpi4py</span>            <span class="n">PyTrilinos</span>           <span class="n">petsc4py</span>                   <span class="n">FiPy</span>
<span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="mi">5</span> <span class="n">cells</span> <span class="n">on</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">3</span>
<span class="n">processor</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="mi">7</span> <span class="n">cells</span> <span class="n">on</span> <span class="n">processor</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">3</span>
<span class="n">processor</span> <span class="mi">2</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">2</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">2</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="mi">6</span> <span class="n">cells</span> <span class="n">on</span> <span class="n">processor</span> <span class="mi">2</span> <span class="n">of</span> <span class="mi">3</span>
</pre></div>
</div>
<p>If there is a problem with your parallel environment, it should be clear
that there is either a problem importing one of the required packages or
that there is some problem with the <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> environment. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="n">mpi4py</span>            <span class="n">PyTrilinos</span>           <span class="n">petsc4py</span>                   <span class="n">FiPy</span>
<span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="mi">10</span> <span class="n">cells</span> <span class="n">on</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">my</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">69815</span><span class="p">]</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">There</span> <span class="n">were</span> <span class="mi">4</span> <span class="n">Windows</span> <span class="n">created</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">freed</span><span class="o">.</span>
<span class="n">processor</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">1</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="mi">10</span> <span class="n">cells</span> <span class="n">on</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">my</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">69814</span><span class="p">]</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">There</span> <span class="n">were</span> <span class="mi">4</span> <span class="n">Windows</span> <span class="n">created</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">freed</span><span class="o">.</span>
<span class="n">processor</span> <span class="mi">2</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">processor</span> <span class="mi">2</span> <span class="n">of</span> <span class="mi">3</span> <span class="p">::</span> <span class="mi">10</span> <span class="n">cells</span> <span class="n">on</span> <span class="n">processor</span> <span class="mi">0</span> <span class="n">of</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">my</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">69813</span><span class="p">]</span> <span class="n">WARNING</span><span class="p">:</span> <span class="n">There</span> <span class="n">were</span> <span class="mi">4</span> <span class="n">Windows</span> <span class="n">created</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">freed</span><span class="o">.</span>
</pre></div>
</div>
<p>indicates <a class="reference internal" href="glossary.html#term-mpi4py"><span class="xref std std-term">mpi4py</span></a> is properly communicating with <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> and is running
in parallel, but that <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> is not, and is running three separate
serial environments. As a result, <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> is limited to three separate
serial operations, too. In this instance, the problem is that although
<a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> was compiled with <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> enabled, it was compiled against a
different <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> library than is currently available (and which <a class="reference internal" href="glossary.html#term-mpi4py"><span class="xref std std-term">mpi4py</span></a>
was compiled against).  The solution, in this instance, is to solve with
<a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> or to rebuild <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> against the active <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a>
libraries.</p>
<p>When solving in parallel, <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> essentially breaks the problem
up into separate sub-domains and solves them (somewhat) independently.
<a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> generally “does the right thing”, but if you find that
you need to do something with the entire solution, you can use
<code class="docutils literal notranslate"><span class="pre">var.</span></code><a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.cellVariable.CellVariable.globalValue" title="fipy.variables.cellVariable.CellVariable.globalValue"><code class="xref py py-attr docutils literal notranslate"><span class="pre">globalValue</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One option for debugging in parallel is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -np {# of processors} xterm -hold -e &quot;python -m ipdb myScript.py&quot;
</pre></div>
</div>
</div>
<section id="openmp-threads-vs-mpi-ranks">
<span id="threads-vs-ranks"></span><h3>OpenMP Threads vs. MPI Ranks<a class="headerlink" href="#openmp-threads-vs-mpi-ranks" title="Permalink to this heading">¶</a></h3>
<p>By default, <a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> and <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> spawn as many <a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> threads
as there are cores
available.  This may very well be an intentional optimization, where
they are designed to have one <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> rank per node of a cluster, so each
of the child threads would help with computation but would not compete for
I/O resources during ghost cell exchanges and file I/O. However, Python’s
<a class="reference external" href="https://docs.python.org/2.7/c-api/init.html#thread-state-and-the-global-interpreter-lock">Global Interpreter Lock</a> (GIL) binds all of the child threads to the same
core as their parent!  So instead of improving performance, each core
suffers a heavy overhead from managing those idling threads.</p>
<p>The solution to this is to force these solvers to use only one <a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> thread:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export OMP_NUM_THREADS=1
</pre></div>
</div>
<p>Because this environment variable affects all processes launched in the
current session, you may prefer to restrict its use to <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> runs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ OMP_NUM_THREADS=1 mpirun -np {# of processors} python myScript.py --trilinos
</pre></div>
</div>
<p>The difference can be extreme.  We have observed the <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> test
suite to run in <a class="reference external" href="https://circleci.com/gh/guyer/fipy/461">just over two minutes</a> when <code class="docutils literal notranslate"><span class="pre">OMP_NUM_THREADS=1</span></code>,
compared to <a class="reference external" href="https://circleci.com/gh/guyer/fipy/423">over an hour and 23 minutes</a> when <a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> threads are
unrestricted. We don’t know why, but <a class="reference external" href="https://travis-ci.org/usnistgov/fipy/builds/509556033">other platforms</a> do not suffer the
same degree of degradation.</p>
<p>Conceivably, allowing these parallel solvers unfettered access to
<a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> threads with no <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> communication at all could perform
as well or better than purely <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a>
parallelization.  The plot below demonstrates this is not the case.  We
compare solution time vs number of <a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> threads for fixed number of
slots for a <a class="reference external" href="https://pages.nist.gov/pfhub/benchmarks/benchmark7.ipynb">Method of Manufactured Solutions Allen-Cahn problem</a>.
<a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> threading always slows down FiPy performance.</p>
<p>(<a class="reference download internal" download="" href="../_downloads/8f3c282f3a1583bbdd14c53e3795ef50/cpus_vs_threads.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
<p>“Speedup” relative to one thread (bigger numbers are better) versus number
of threads for 32 <a class="reference external" href="https://slurm.schedmd.com">Slurm</a> tasks on a log-log plot.  <a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> threads
<span class="math notranslate nohighlight">\(\times\)</span> <a class="reference internal" href="glossary.html#term-MPI"><span class="xref std std-term">MPI</span></a> ranks = <a class="reference external" href="https://slurm.schedmd.com">Slurm</a> tasks.</p>
<p>See <a class="reference external" href="https://www.mail-archive.com/fipy&#64;nist.gov/msg03393.html">https://www.mail-archive.com/fipy&#64;nist.gov/msg03393.html</a> for further
analysis.</p>
<p>It may be possible to configure these packages to use only one <a class="reference internal" href="glossary.html#term-OpenMP"><span class="xref std std-term">OpenMP</span></a> thread,
but this is not the configuration of the version available from <a class="reference external" href="https://conda-forge.github.io/">conda-forge</a>
and building Trilinos, at least, is <a class="reference external" href="https://commons.wikimedia.org/wiki/File:Hieronymus_Bosch_-_Triptych_of_Garden_of_Earthly_Delights_(detail)_-_WGA2526.jpg#/media/File:Hieronymus_Bosch_-_Triptych_of_Garden_of_Earthly_Delights_(detail)_-_WGA2526.jpg">NotFun™</a>.</p>
</section>
</section>
<section id="meshing-with-gmsh">
<span id="meshingwithgmsh"></span><h2>Meshing with Gmsh<a class="headerlink" href="#meshing-with-gmsh" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> works with arbitrary polygonal meshes generated by
<a class="reference internal" href="glossary.html#term-Gmsh"><span class="xref std std-term">Gmsh</span></a>.  <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> provides two wrappers classes
(<code class="xref py py-class docutils literal notranslate"><span class="pre">Gmsh2D</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">Gmsh3D</span></code>) enabling <a class="reference internal" href="glossary.html#term-Gmsh"><span class="xref std std-term">Gmsh</span></a> to be
used directly from python. The classes can be instantiated with a set
of <a class="reference internal" href="glossary.html#term-Gmsh"><span class="xref std std-term">Gmsh</span></a> style commands (see
<a class="reference internal" href="../examples/diffusion/generated/examples.diffusion.circle.html#module-examples.diffusion.circle" title="examples.diffusion.circle"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.circle</span></code></a>). The classes can also be
instantiated with the path to either a <a class="reference internal" href="glossary.html#term-Gmsh"><span class="xref std std-term">Gmsh</span></a> geometry file
(<code class="docutils literal notranslate"><span class="pre">.geo</span></code>) or a <a class="reference internal" href="glossary.html#term-Gmsh"><span class="xref std std-term">Gmsh</span></a> mesh file (<code class="docutils literal notranslate"><span class="pre">.msh</span></code>) (see
<a class="reference internal" href="../examples/diffusion/generated/examples.diffusion.anisotropy.html#module-examples.diffusion.anisotropy" title="examples.diffusion.anisotropy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.anisotropy</span></code></a>).</p>
<p>As well as meshing arbitrary geometries, <a class="reference internal" href="glossary.html#term-Gmsh"><span class="xref std std-term">Gmsh</span></a> partitions
meshes for parallel simulations. Mesh partitioning automatically
occurs whenever a parallel communicator is passed to the mesh on
instantiation. This is the default setting for all meshes that work in
parallel including <code class="xref py py-class docutils literal notranslate"><span class="pre">Gmsh2D</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">Gmsh3D</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> solution accuracy can be compromised with highly
non-orthogonal or non-conjunctional meshes.</p>
</div>
</section>
<section id="coupled-and-vector-equations">
<span id="coupledequations"></span><h2>Coupled and Vector Equations<a class="headerlink" href="#coupled-and-vector-equations" title="Permalink to this heading">¶</a></h2>
<p>Equations can now be coupled together so that the contributions from
all the equations appear in a single system matrix. This results in
tighter coupling for equations with spatial and temporal derivatives
in more than one variable. In <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> equations are coupled
together using the <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> operator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eqn0</span> <span class="o">=</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eqn1</span> <span class="o">=</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coupledEqn</span> <span class="o">=</span> <span class="n">eqn0</span> <span class="o">&amp;</span> <span class="n">eqn1</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">coupledEqn</span></code> will use a combined system matrix that includes
four quadrants for each of the different variable and equation
combinations. In previous versions of <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> there has been no
need to specify which variable a given term acts on when generating
equations. The variable is simply specified when calling <code class="docutils literal notranslate"><span class="pre">solve</span></code> or
<code class="docutils literal notranslate"><span class="pre">sweep</span></code> and this functionality has been maintained in the case of
single equations. However, for coupled equations the variable that a
given term operates on now needs to be specified when the equation is
generated. The syntax for generating coupled equations has the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eqn0</span> <span class="o">=</span> <span class="n">Term00</span><span class="p">(</span><span class="n">coeff</span><span class="o">=...</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">var0</span><span class="p">)</span> <span class="o">+</span> <span class="n">Term01</span><span class="p">(</span><span class="n">coeff</span><span class="o">...</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">var1</span><span class="p">)</span> <span class="o">==</span> <span class="n">source0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eqn1</span> <span class="o">=</span> <span class="n">Term10</span><span class="p">(</span><span class="n">coeff</span><span class="o">=...</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">var0</span><span class="p">)</span> <span class="o">+</span> <span class="n">Term11</span><span class="p">(</span><span class="n">coeff</span><span class="o">...</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">var1</span><span class="p">)</span> <span class="o">==</span> <span class="n">source1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coupledEqn</span> <span class="o">=</span> <span class="n">eqn0</span> <span class="o">&amp;</span> <span class="n">eqn1</span>
</pre></div>
</div>
<p>and there is now no need to pass any variables when solving:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coupledEqn</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">dt</span><span class="o">=...</span><span class="p">,</span> <span class="n">solver</span><span class="o">=...</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case the matrix system will have the form</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left(
\begin{array}{c|c}
\text{\ttfamily Term00} &amp; \text{\ttfamily Term01} \\ \hline
\text{\ttfamily Term10} &amp; \text{\ttfamily Term11}
\end{array} \right)
\left(
\begin{array}{c}
\text{\ttfamily var0}  \\ \hline
\text{\ttfamily var1}
\end{array} \right)
=
\left(
\begin{array}{c}
\text{\ttfamily source0}  \\ \hline
\text{\ttfamily source1}
\end{array} \right)\end{split}\]</div>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> tries to make sensible decisions regarding each term’s
location in the matrix and the ordering of the variable column
array. For example, if <code class="docutils literal notranslate"><span class="pre">Term01</span></code> is a transient term then <code class="docutils literal notranslate"><span class="pre">Term01</span></code>
would appear in the upper left diagonal and the ordering of the
variable column array would be reversed.</p>
<p>The use of coupled equations is described in detail in
<a class="reference internal" href="../examples/diffusion/generated/examples.diffusion.coupled.html#module-examples.diffusion.coupled" title="examples.diffusion.coupled"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.coupled</span></code></a>. Other examples that demonstrate the
use of coupled equations are <a class="reference internal" href="../examples/phase/generated/examples.phase.binaryCoupled.html#module-examples.phase.binaryCoupled" title="examples.phase.binaryCoupled"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.binaryCoupled</span></code></a>,
<a class="reference internal" href="../examples/phase/generated/examples.phase.polyxtalCoupled.html#module-examples.phase.polyxtalCoupled" title="examples.phase.polyxtalCoupled"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.polyxtalCoupled</span></code></a> and
<a class="reference internal" href="../examples/cahnHilliard/generated/examples.cahnHilliard.mesh2DCoupled.html#module-examples.cahnHilliard.mesh2DCoupled" title="examples.cahnHilliard.mesh2DCoupled"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.cahnHilliard.mesh2DCoupled</span></code></a>. As well as coupling
equations, true vector equations can now be written in <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Coupled equations are not compatible with
<a class="reference internal" href="numerical/discret.html#discret-higherorderdiffusion"><span class="std std-ref">Higher Order Diffusion</span></a> terms.  This is not a practical
limitation, as any higher order terms can be decomposed into multiple
2nd-order equations.  For example, the pair of <a class="reference external" href="https://pages.nist.gov/pfhub/benchmarks/benchmark2.ipynb">coupled Cahn-Hilliard &amp;
Allen-Cahn</a> 4th- and 2nd-order equations</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial C}{\partial t}
&amp;= \nabla\cdot\left[
    M\nabla\left(
        \frac{\partial f(c, \phi)}{\partial C}
        - \kappa_C\nabla^2 C
    \right)
\right]
\\
\frac{\partial \phi}{\partial t}
&amp;= -L\left(
    \frac{\partial f(c, \phi)}{\partial \phi}
    - \kappa_\phi\nabla^2 \phi
\right)\end{split}\]</div>
<p>can be decomposed to three 2nd-order equations</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial C}{\partial t}
&amp;= \nabla\cdot\left(
    M\nabla\mu
\right)
\\
\mu
&amp;= \frac{\partial f(c, \phi)}{\partial C}
   - \kappa_C\nabla^2 C
\\
\frac{\partial \phi}{\partial t}
&amp;= -L\left(
    \frac{\partial f(c, \phi)}{\partial \phi}
    - \kappa_\phi\nabla^2 \phi
\right)\end{split}\]</div>
</div>
</section>
<section id="boundary-conditions">
<span id="boundaryconditions"></span><h2>Boundary Conditions<a class="headerlink" href="#boundary-conditions" title="Permalink to this heading">¶</a></h2>
<section id="default-boundary-conditions">
<h3>Default boundary conditions<a class="headerlink" href="#default-boundary-conditions" title="Permalink to this heading">¶</a></h3>
<p>If no constraints are applied, solutions are conservative, i.e., all
boundaries are zero flux.  For the equation</p>
<div class="math notranslate nohighlight">
\[\frac{\partial\phi}{\partial t}
&amp;= \nabla\cdot\left(\vec{a}\phi\right) + \nabla\cdot\left(b\nabla\phi\right)\]</div>
<p>the condition on the boundary <span class="math notranslate nohighlight">\(S\)</span> is</p>
<div class="math notranslate nohighlight">
\[\hat{n}\cdot\left(\vec{a}\phi + b\nabla\phi\right) = 0\qquad\text{on $S$.}\]</div>
</section>
<section id="applying-fixed-value-dirichlet-boundary-conditions">
<h3>Applying fixed value (Dirichlet) boundary conditions<a class="headerlink" href="#applying-fixed-value-dirichlet-boundary-conditions" title="Permalink to this heading">¶</a></h3>
<p>To apply a fixed value boundary condition use the
<a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.cellVariable.CellVariable.constrain" title="fipy.variables.cellVariable.CellVariable.constrain"><code class="xref py py-meth docutils literal notranslate"><span class="pre">constrain()</span></code></a> method. For example, to fix <cite>var</cite> to
have a value of <cite>2</cite> along the upper surface of a domain, use</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">facesTop</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The old equivalent
<a class="reference internal" href="../fipy/generated/fipy.boundaryConditions.html#fipy.boundaryConditions.fixedValue.FixedValue" title="fipy.boundaryConditions.fixedValue.FixedValue"><code class="xref py py-class docutils literal notranslate"><span class="pre">FixedValue</span></code></a> boundary
condition is now deprecated.</p>
</div>
</section>
<section id="applying-fixed-gradient-boundary-conditions-neumann">
<h3>Applying fixed gradient boundary conditions (Neumann)<a class="headerlink" href="#applying-fixed-gradient-boundary-conditions-neumann" title="Permalink to this heading">¶</a></h3>
<p>To apply a fixed Gradient boundary condition use the
<a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.cellVariable.CellVariable.faceGrad" title="fipy.variables.cellVariable.CellVariable.faceGrad"><code class="xref py py-attr docutils literal notranslate"><span class="pre">faceGrad</span></code></a>.<a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.variable.Variable.constrain" title="fipy.variables.variable.Variable.constrain"><code class="xref py py-meth docutils literal notranslate"><span class="pre">constrain()</span></code></a> method. For
example, to fix <cite>var</cite> to have a gradient of <cite>(0,2)</cite> along the upper
surface of a 2D domain, use</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="o">.</span><span class="n">faceGrad</span><span class="o">.</span><span class="n">constrain</span><span class="p">(((</span><span class="mi">0</span><span class="p">,),(</span><span class="mi">2</span><span class="p">,)),</span> <span class="n">where</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">facesTop</span><span class="p">)</span>
</pre></div>
</div>
<p>If the gradient normal to the boundary (<em>e.g.</em>,
<span class="math notranslate nohighlight">\(\hat{n}\cdot\nabla\phi\)</span>) is to be set to a scalar value of <cite>2</cite>, use</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="o">.</span><span class="n">faceGrad</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faceNormals</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">exteriorFaces</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="applying-fixed-flux-boundary-conditions">
<h3>Applying fixed flux boundary conditions<a class="headerlink" href="#applying-fixed-flux-boundary-conditions" title="Permalink to this heading">¶</a></h3>
<p>Generally these can be implemented with a judicious use of
<a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.cellVariable.CellVariable.faceGrad" title="fipy.variables.cellVariable.CellVariable.faceGrad"><code class="xref py py-attr docutils literal notranslate"><span class="pre">faceGrad</span></code></a>.<a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.variable.Variable.constrain" title="fipy.variables.variable.Variable.constrain"><code class="xref py py-meth docutils literal notranslate"><span class="pre">constrain()</span></code></a>.  Failing that, an
exterior flux term can be added to the equation. Firstly, set the
terms’ coefficients to be zero on the exterior faces,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diffCoeff</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">exteriorFaces</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">convCoeff</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">exteriorFaces</span><span class="p">)</span>
</pre></div>
</div>
<p>then create an equation with an extra term to account for the exterior flux,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="p">(</span><span class="n">TransientTerm</span><span class="p">()</span> <span class="o">+</span> <span class="n">ConvectionTerm</span><span class="p">(</span><span class="n">convCoeff</span><span class="p">)</span>
<span class="gp">... </span>       <span class="o">==</span> <span class="n">DiffusionCoeff</span><span class="p">(</span><span class="n">diffCoeff</span><span class="p">)</span>
<span class="gp">... </span>       <span class="o">+</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">exteriorFaces</span> <span class="o">*</span> <span class="n">exteriorFlux</span><span class="p">)</span><span class="o">.</span><span class="n">divergence</span><span class="p">)</span>
</pre></div>
</div>
<p>where <cite>exteriorFlux</cite> is a rank 1
<a class="reference internal" href="../fipy/generated/fipy.variables.html#fipy.variables.faceVariable.FaceVariable" title="fipy.variables.faceVariable.FaceVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The old equivalent <a class="reference internal" href="../fipy/generated/fipy.boundaryConditions.html#fipy.boundaryConditions.fixedFlux.FixedFlux" title="fipy.boundaryConditions.fixedFlux.FixedFlux"><code class="xref py py-class docutils literal notranslate"><span class="pre">FixedFlux</span></code></a>
boundary condition is now deprecated.</p>
</div>
</section>
<section id="applying-outlet-or-inlet-boundary-conditions">
<h3>Applying outlet or inlet boundary conditions<a class="headerlink" href="#applying-outlet-or-inlet-boundary-conditions" title="Permalink to this heading">¶</a></h3>
<p>Convection terms default to a no flux boundary condition unless the
exterior faces are associated with a constraint, in which case either
an inlet or an outlet boundary condition is applied depending on the
flow direction.</p>
</section>
<section id="applying-spatially-varying-boundary-conditions">
<h3>Applying spatially varying boundary conditions<a class="headerlink" href="#applying-spatially-varying-boundary-conditions" title="Permalink to this heading">¶</a></h3>
<p>The use of spatial varying boundary conditions is best demonstrated with an
example. Given a 2D equation in the domain <span class="math notranslate nohighlight">\(0 &lt; x &lt; 1\)</span> and <span class="math notranslate nohighlight">\(0 &lt; y &lt; 1\)</span> with
boundary conditions,</p>
<div class="math notranslate nohighlight">
\[\begin{split}\phi = \left\{
          \begin{aligned}
              xy &amp;\quad \text{on $x&gt;1/2$ and $y&gt;1/2$} \\
              \vec{n} \cdot \vec{F} = 0 &amp;\quad \text{elsewhere}
          \end{aligned}
      \right.\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\vec{F}\)</span> represents the flux. The boundary conditions in <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> can
be written with the following code,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faceCenters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span>  <span class="p">((</span><span class="n">X</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">Y</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="o">.</span><span class="n">faceGrad</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">exteriorFaces</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="n">X</span> <span class="o">*</span> <span class="n">Y</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">exteriorFaces</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
<p>then</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Further demonstrations of spatially varying boundary condition can be found
in <a class="reference internal" href="../examples/diffusion/generated/examples.diffusion.mesh20x20.html#module-examples.diffusion.mesh20x20" title="examples.diffusion.mesh20x20"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.mesh20x20</span></code></a>
and <a class="reference internal" href="../examples/diffusion/generated/examples.diffusion.circle.html#module-examples.diffusion.circle" title="examples.diffusion.circle"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.circle</span></code></a></p>
</section>
<section id="applying-robin-boundary-conditions">
<h3>Applying Robin boundary conditions<a class="headerlink" href="#applying-robin-boundary-conditions" title="Permalink to this heading">¶</a></h3>
<p>The Robin condition applied on the portion of the boundary <span class="math notranslate nohighlight">\(S_R\)</span></p>
<div class="math notranslate nohighlight">
\[\hat{n}\cdot\left(\vec{a}\phi + b\nabla\phi\right) = g\qquad\text{on $S_R$}\]</div>
<p>can often be substituted for the flux in an equation</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial\phi}{\partial t}
&amp;= \nabla\cdot\left(\vec{a}\phi\right) + \nabla\cdot\left(b\nabla\phi\right)
\\
\int_V\frac{\partial\phi}{\partial t}\,dV
&amp;= \int_S \hat{n} \cdot \left(\vec{a}\phi + b\nabla\phi\right) \, dS
\\
\int_V\frac{\partial\phi}{\partial t}\,dV
&amp;= \int_{S \notin S_R} \hat{n} \cdot \left(\vec{a}\phi + b\nabla\phi\right) \, dS
+ \int_{S \in S_R} g \, dS\end{split}\]</div>
<p>At faces identified by <code class="docutils literal notranslate"><span class="pre">mask</span></code>,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">FaceVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">value</span><span class="o">=...</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">FaceVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">value</span><span class="o">=...</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">FaceVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">value</span><span class="o">=...</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="p">(</span><span class="n">TransientTerm</span><span class="p">()</span> <span class="o">==</span> <span class="n">PowerLawConvectionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
<span class="gp">... </span>       <span class="o">+</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="gp">... </span>       <span class="o">+</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faceNormals</span><span class="p">)</span><span class="o">.</span><span class="n">divergence</span><span class="p">)</span>
</pre></div>
</div>
<p>When the Robin condition does not exactly map onto the boundary flux, we
can attempt to apply it term by term.  The Robin condition relates the
gradient at a boundary face to the value on that face, however
<a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> naturally calculates variable values at cell centers
and gradients at intervening faces. Using a first order upwind
approximation, the boundary value of the variable at face <span class="math notranslate nohighlight">\(f\)</span> can be written in terms of
the value at the neighboring cell <span class="math notranslate nohighlight">\(P\)</span> and the normal gradient at the boundary:</p>
<div class="math notranslate nohighlight" id="equation-upwind1">
<span class="eqno">(1)<a class="headerlink" href="#equation-upwind1" title="Permalink to this equation">¶</a></span>\[\begin{split}\phi_f &amp;\approx \phi_P - \left(\vec{d}_{fP}\cdot\nabla\phi\right)_f
\\
&amp;\approx \phi_P - \left(\hat{n}\cdot\nabla\phi\right)_f\left(\vec{d}_{fP}\cdot\hat{n}\right)_f\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\vec{d}_{fP}\)</span> is the distance vector from the face center to
the adjoining cell center.  The approximation
<span class="math notranslate nohighlight">\(\left(\vec{d}_{fP}\cdot\nabla\phi\right)_f \approx
\left(\hat{n}\cdot\nabla\phi\right)_f\left(\vec{d}_{fP}\cdot\hat{n}\right)_f\)</span>
is most valid when the mesh is orthogonal.</p>
<p>Substituting this expression into the Robin condition:</p>
<div class="math notranslate nohighlight" id="equation-robin-facegrad">
<span class="eqno">(2)<a class="headerlink" href="#equation-robin-facegrad" title="Permalink to this equation">¶</a></span>\[\begin{split}\hat{n}\cdot\left(\vec{a} \phi + b \nabla\phi\right)_f &amp;= g \\
\hat{n}\cdot\left[\vec{a} \phi_P
- \vec{a} \left(\hat{n}\cdot\nabla\phi\right)_f\left(\vec{d}_{fP}\cdot\hat{n}\right)_f
+ b \nabla\phi\right]_f &amp;\approx g \\
\left(\hat{n}\cdot\nabla\phi\right)_f
&amp;\approx \frac{g_f - \left(\hat{n}\cdot\vec{a}\right)_f \phi_P}
              {-\left(\vec{d}_{fP}\cdot\vec{a}\right)_f + b_f}\end{split}\]</div>
<p>we obtain an expression for the gradient at the boundary face in terms of
its neighboring cell.  We can, in turn, substitute this back into
<a class="reference internal" href="#equation-upwind1">(1)</a></p>
<div class="math notranslate nohighlight" id="equation-upwind2">
<span class="eqno">(3)<a class="headerlink" href="#equation-upwind2" title="Permalink to this equation">¶</a></span>\[\begin{split}\phi_f &amp;\approx \phi_P
- \frac{g_f - \left(\hat{n}\cdot\vec{a}\right)_f \phi_P}
       {-\left(\vec{d}_{fP}\cdot\vec{a}\right)_f + b_f}
\left(\vec{d}_{fP}\cdot\hat{n}\right)_f \\
&amp;\approx \frac{-g_f \left(\hat{n}\cdot\vec{d}_{fP}\right)_f + b_f\phi_P}
              {- \left(\vec{d}_{fP}\cdot\vec{a}\right)_f + b_f}\end{split}\]</div>
<p>to obtain the value on the boundary face in terms of the neighboring cell.</p>
<p>Substituting <a class="reference internal" href="#equation-robin-facegrad">(2)</a> into the discretization of the
<a class="reference internal" href="../fipy/generated/fipy.terms.html#fipy.terms.diffusionTerm.DiffusionTerm" title="fipy.terms.diffusionTerm.DiffusionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiffusionTerm</span></code></a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\int_V \nabla\cdot\left(\Gamma\nabla\phi\right) dV
&amp;= \int_S \Gamma \hat{n}\cdot\nabla\phi\, S \\
&amp;\approx \sum_f \Gamma_f \left(\hat{n}\cdot\nabla\phi\right)_f A_f \\
&amp;= \sum_{f \notin S_R} \Gamma_f \left(\hat{n}\cdot\nabla\phi\right)_f A_f
+ \sum_{f \in S_R} \Gamma_f \left(\hat{n}\cdot\nabla\phi\right)_f A_f \\
&amp;\approx \sum_{f \notin S_R} \Gamma_f \left(\hat{n}\cdot\nabla\phi\right)_f A_f
+ \sum_{f \in S_R} \Gamma_f \frac{g_f - \left(\hat{n}\cdot\vec{a}\right)_f \phi_P}
                    {-\left(\vec{d}_{fP}\cdot\vec{a}\right)_f + b_f} A_f\end{split}\]</div>
<p>An equation of the form</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="n">TransientTerm</span><span class="p">()</span> <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">Gamma0</span><span class="p">)</span>
</pre></div>
</div>
<p>can be constrained to have a Robin condition at faces identified by
<code class="docutils literal notranslate"><span class="pre">mask</span></code> by making the following modifications</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Gamma</span> <span class="o">=</span> <span class="n">FaceVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">Gamma0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Gamma</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dPf</span> <span class="o">=</span> <span class="n">FaceVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">value</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">_faceToCellDistanceRatio</span> <span class="o">*</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cellDistanceVectors</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faceNormals</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">FaceVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">value</span><span class="o">=...</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">FaceVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">value</span><span class="o">=...</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">FaceVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">value</span><span class="o">=...</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">RobinCoeff</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask</span> <span class="o">*</span> <span class="n">Gamma0</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="n">dPf</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="p">(</span><span class="n">TransientTerm</span><span class="p">()</span> <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">Gamma</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">RobinCoeff</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">divergence</span>
<span class="gp">... </span>       <span class="o">-</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="p">(</span><span class="n">RobinCoeff</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="o">.</span><span class="n">divergence</span><span class="p">)</span>
</pre></div>
</div>
<p>Similarly, for a <code class="xref py py-class docutils literal notranslate"><span class="pre">ConvectionTerm</span></code>, we can
substitute <a class="reference internal" href="#equation-upwind2">(3)</a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\int_V \nabla\cdot\left(\vec{u}\phi\right) dV
&amp;= \int_S \hat{n}\cdot\vec{u} \phi\,dS \\
&amp;\approx \sum_f \left(\hat{n}\cdot\vec{u}\right)_f \phi_f A_f \\
&amp;= \sum_{f \notin S_R} \left(\hat{n}\cdot\vec{u}\right)_f \phi_f A_f
+ \sum_{f \in S_R} \left(\hat{n}\cdot\vec{u}\right)_f
     \frac{-g_f \left(\hat{n}\cdot\vec{d}_{fP}\right)_f + b_f\phi_P}
          {- \left(\vec{d}_{fP}\cdot\vec{a}\right)_f + b_f} A_f\end{split}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An expression like the heat flux convection boundary condition
<span class="math notranslate nohighlight">\(-k\nabla T\cdot\hat{n} = h(T - T_\infty)\)</span> can be put in the form of the
Robin condition used above by letting <span class="math notranslate nohighlight">\(\vec{a} \equiv h \hat{n}\)</span>,
<span class="math notranslate nohighlight">\(b \equiv k\)</span>, and <span class="math notranslate nohighlight">\(g \equiv h T_\infty\)</span>.</p>
</div>
</section>
<section id="applying-internal-boundary-conditions">
<h3>Applying internal “boundary” conditions<a class="headerlink" href="#applying-internal-boundary-conditions" title="Permalink to this heading">¶</a></h3>
<p>Applying internal boundary conditions can be achieved through the use
of implicit and explicit sources.</p>
<section id="internal-fixed-value">
<h4>Internal fixed value<a class="headerlink" href="#internal-fixed-value" title="Permalink to this heading">¶</a></h4>
<p>An equation of the form</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="n">TransientTerm</span><span class="p">()</span> <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">()</span>
</pre></div>
</div>
<p>can be constrained to have a fixed internal <code class="docutils literal notranslate"><span class="pre">value</span></code> at a position
given by <code class="docutils literal notranslate"><span class="pre">mask</span></code> with the following alterations</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="p">(</span><span class="n">TransientTerm</span><span class="p">()</span> <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">()</span>
<span class="gp">... </span>                          <span class="o">-</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">mask</span> <span class="o">*</span> <span class="n">largeValue</span><span class="p">)</span>
<span class="gp">... </span>                          <span class="o">+</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">largeValue</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">largeValue</span></code> must be chosen to be large enough to
completely dominate the matrix diagonal and the RHS vector in cells
that are masked. The <code class="docutils literal notranslate"><span class="pre">mask</span></code> variable would typically be a
<code class="docutils literal notranslate"><span class="pre">CellVariable</span></code> Boolean constructed using the cell center values.</p>
</section>
<section id="internal-fixed-gradient">
<h4>Internal fixed gradient<a class="headerlink" href="#internal-fixed-gradient" title="Permalink to this heading">¶</a></h4>
<p>An equation of the form</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="n">TransientTerm</span><span class="p">()</span> <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">Gamma0</span><span class="p">)</span>
</pre></div>
</div>
<p>can be constrained to have a fixed internal <code class="docutils literal notranslate"><span class="pre">gradient</span></code> magnitude
at a position given by <code class="docutils literal notranslate"><span class="pre">mask</span></code> with the following alterations</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Gamma</span> <span class="o">=</span> <span class="n">FaceVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">Gamma0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Gamma</span><span class="p">[</span><span class="n">mask</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="p">(</span><span class="n">TransientTerm</span><span class="p">()</span> <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">Gamma</span><span class="p">)</span>
<span class="gp">... </span>       <span class="o">+</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">largeValue</span> <span class="o">*</span> <span class="n">mask</span><span class="p">)</span>
<span class="gp">... </span>       <span class="o">-</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">mask</span> <span class="o">*</span> <span class="n">largeValue</span> <span class="o">*</span> <span class="n">gradient</span>
<span class="gp">... </span>                            <span class="o">*</span> <span class="n">mesh</span><span class="o">.</span><span class="n">faceNormals</span><span class="p">)</span><span class="o">.</span><span class="n">divergence</span><span class="p">)</span>
</pre></div>
</div>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">largeValue</span></code> must be chosen to be large enough to
completely dominate the matrix diagonal and the RHS vector in cells
that are masked. The <code class="docutils literal notranslate"><span class="pre">mask</span></code> variable would typically be a
<code class="docutils literal notranslate"><span class="pre">FaceVariable</span></code> Boolean constructed using the face center values.</p>
</section>
<section id="internal-robin-condition">
<h4>Internal Robin condition<a class="headerlink" href="#internal-robin-condition" title="Permalink to this heading">¶</a></h4>
<p>Nothing different needs to be done when
<a class="reference internal" href="#applying-robin-boundary-conditions">applying Robin boundary conditions</a> at internal faces.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While we believe the derivations for
<a class="reference internal" href="#applying-robin-boundary-conditions">applying Robin boundary conditions</a> are “correct”, they often do not
seem to produce the intuitive result. At this point, we think this has
to do with the pathology of “internal” boundary conditions, but remain
open to other explanations. <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> was designed with diffuse
interface treatments (phase field and level set) in mind and, as such,
internal “boundaries” do not come up in our own work and have not
received much attention.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The constraints mechanism is not designed to constrain internal values
for variables that are being solved by equations. In particular, one must
be careful to distinguish between constraining internal cell values
during the solve step and simply applying arbitrary constraints to a
<code class="docutils literal notranslate"><span class="pre">CellVariable</span></code>. Applying a constraint,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
<p>simply fixes the returned value of <code class="docutils literal notranslate"><span class="pre">var</span></code> at <code class="docutils literal notranslate"><span class="pre">mask</span></code> to be
<code class="docutils literal notranslate"><span class="pre">value</span></code>. It does not have any effect on the implicit value of <code class="docutils literal notranslate"><span class="pre">var</span></code> at the
<code class="docutils literal notranslate"><span class="pre">mask</span></code> location during the linear solve so it is not a substitute
for the source term machinations described above. Future releases of
<a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> may implicitly deal with this discrepancy, but the current
release does not.</p>
<p>A simple example can be used to demonstrate this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">Grid1D</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">var</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
<p>We wish to solve <span class="math notranslate nohighlight">\(\nabla^2 \phi = 0\)</span> subject to
<span class="math notranslate nohighlight">\(\phi\rvert_\text{right} = 1\)</span> and <span class="math notranslate nohighlight">\(\phi\rvert_{x &lt; 1} = 0.25\)</span>.
We apply a constraint to the faces for the right side boundary condition
(which works).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">facesRight</span><span class="p">)</span>
</pre></div>
</div>
<p>We create the equation with the source term constraint described above</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">largeValue</span> <span class="o">=</span> <span class="mf">1e+10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="n">DiffusionTerm</span><span class="p">()</span> <span class="o">-</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">largeValue</span> <span class="o">*</span> <span class="n">mask</span><span class="p">)</span> <span class="o">+</span> <span class="n">largeValue</span> <span class="o">*</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">value</span>
</pre></div>
</div>
<p>and the expected value is obtained.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">var</span>
<span class="go">[ 0.25  0.75]</span>
</pre></div>
</div>
<p>However, if a constraint is used without the source term constraint an
unexpected solution is obtained</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">var</span><span class="o">.</span><span class="n">constrain</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span> <span class="o">=</span> <span class="n">DiffusionTerm</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eqn</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">var</span>
<span class="go">[ 0.25  1.  ]</span>
</pre></div>
</div>
<p>although the left cell has the expected value as it is constrained.</p>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> has simply solved <span class="math notranslate nohighlight">\(\nabla^2 \phi = 0\)</span> with
<span class="math notranslate nohighlight">\(\phi\rvert_\text{right} = 1\)</span> and (by default)
<span class="math notranslate nohighlight">\(\hat{n}\cdot\nabla\phi\rvert_\text{left} = 0\)</span>, giving <span class="math notranslate nohighlight">\(\phi
= 1\)</span> everywhere, and then subsequently replaced the cells <span class="math notranslate nohighlight">\(x &lt; 1\)</span>
with <span class="math notranslate nohighlight">\(\phi = 0.25\)</span>.</p>
</div>
</section>
</section>
</section>
<section id="running-under-python-2">
<span id="runningunderpython2"></span><h2>Running under Python 2<a class="headerlink" href="#running-under-python-2" title="Permalink to this heading">¶</a></h2>
<p>Thanks to the <a class="reference external" href="http://python-future.org">future</a> package and to the contributions of <a class="reference external" href="https://github.com/pya">pya</a> and
<a class="reference external" href="https://github.com/pya">woodscn</a>, <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> runs under both <a class="reference internal" href="glossary.html#term-Python-3"><span class="xref std std-term">Python 3</span></a> and <a class="reference internal" href="glossary.html#term-Python"><span class="xref std std-term">Python</span></a>
2.7, without conversion or modification.</p>
<p>Because <a class="reference internal" href="glossary.html#term-Python"><span class="xref std std-term">Python</span></a> itself will <a class="reference external" href="https://www.python.org/dev/peps/pep-0373/#update">drop support for Python 2.7 on January
1, 2020</a> and many of the prerequisites for <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> have <a class="reference external" href="https://python3statement.org">pledged to
drop support for Python 2.7 no later than 2020</a>, we have prioritized adding
support for better <a class="reference internal" href="glossary.html#term-Python-3"><span class="xref std std-term">Python 3</span></a> solvers, starting with
<a class="reference internal" href="glossary.html#term-petsc4py"><span class="xref std std-term">petsc4py</span></a>.</p>
<p>Because the faster <a class="reference internal" href="glossary.html#term-Pysparse"><span class="xref std std-term">PySparse</span></a> and <a class="reference internal" href="glossary.html#term-Trilinos"><span class="xref std std-term">Trilinos</span></a> solvers are not
available under <a class="reference internal" href="glossary.html#term-Python-3"><span class="xref std std-term">Python 3</span></a>, we will maintain <a class="reference internal" href="glossary.html#term-Python"><span class="xref std std-term">Python</span></a> 2.x
support as long as practical. Be aware that the <a class="reference external" href="https://conda-forge.github.io/">conda-forge</a> packages that
<a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> depends upon are not well-maintained on <a class="reference internal" href="glossary.html#term-Python"><span class="xref std std-term">Python</span></a> 2.x
and our support for that configuration is rapidly becoming impractical,
despite the present performance benefits. Hopefully, we will learn
how to optimize our use of <a class="reference internal" href="SOLVERS.html#petsc"><span class="std std-ref">PETSc</span></a> and/or <a class="reference internal" href="SOLVERS.html#trilinos"><span class="std std-ref">Trilinos</span></a> 12.12 will
become available on <a class="reference external" href="https://conda-forge.github.io/">conda-forge</a>.</p>
</section>
<section id="manual">
<h2>Manual<a class="headerlink" href="#manual" title="Permalink to this heading">¶</a></h2>
<p>You can view the manual online at &lt;<a class="reference external" href="http://www.ctcms.nist.gov/fipy">http://www.ctcms.nist.gov/fipy</a>&gt; or you
can <a class="reference external" href="http://www.ctcms.nist.gov/fipy/download/">download the latest manual</a> from
&lt;<a class="reference external" href="http://www.ctcms.nist.gov/fipy/download/">http://www.ctcms.nist.gov/fipy/download/</a>&gt;. Alternatively,
it may be possible to build a fresh copy by issuing the following
command in the base directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python setup.py build_docs --pdf --html
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This mechanism is intended primarily for the developers. At a minimum,
you will need at least version 1.7.0 of <a class="reference external" href="http://www.sphinx-doc.org/">Sphinx</a>, plus all of its prerequisites. Python
2.7 probably won’t work.</p>
<p>We install via conda:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda install --channel conda-forge sphinx
</pre></div>
</div>
<p>Bibliographic citations require the <cite>sphinxcontrib-bibtex</cite> package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m pip install sphinxcontrib-bibtex
</pre></div>
</div>
<p>Some documentation uses <cite>numpydoc</cite> styling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m pip install numpydoc
</pre></div>
</div>
<p>Some embeded figures require <cite>matplotlib</cite>, <cite>pandas</cite>, and <cite>imagemagick</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda install --channel conda-forge matplotlib pandas imagemagick
</pre></div>
</div>
<p>The PDF file requires <a class="reference external" href="https://ctan.org/pkg/siunits">SIunits.sty</a> available, e.g., from
<a class="reference external" href="https://packages.debian.org/stretch/texlive-science">texlive-science</a>.</p>
<p>Spelling is checked automatically in the course of
<a class="reference internal" href="ADMINISTRATA.html#continuousintegration"><span class="std std-ref">Continuous Integration</span></a>. If you wish to check manually, you will
need <cite>pyspelling</cite>, <cite>hunspell</cite>, and the <cite>libreoffice</cite> dictionaries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda install --channel conda-forge hunspell
$ python -m pip install pyspelling
$ wget -O en_US.aff  https://cgit.freedesktop.org/libreoffice/dictionaries/plain/en/en_US.aff?id=a4473e06b56bfe35187e302754f6baaa8d75e54f
$ wget -O en_US.dic https://cgit.freedesktop.org/libreoffice/dictionaries/plain/en/en_US.dic?id=a4473e06b56bfe35187e302754f6baaa8d75e54f
</pre></div>
</div>
</div>
</section>
</section>


                <div class='last-updated'>
                Last updated on May 25, 2023.
                Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.
                </div>
              </div>
  </div>  
  <aside class="nist-page__region nist-page__region--sidebar-second tablet-lg:grid-col-4">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

            <p class="logo"><a href="contents.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
<strong>FiPy: A Finite Volume PDE Solver Using Python</strong><br />
Version 3.4.3+141.g9c8f5a4b

  <div class="sphinxsidebarsection">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using FiPy</a><ul>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#testing-fipy">Testing FiPy</a><ul>
<li><a class="reference internal" href="#parallel-tests">Parallel Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#command-line-flags-and-environment-variables">Command-line Flags and Environment Variables</a><ul>
<li><a class="reference internal" href="#command-line-flags">Command-line Flags</a></li>
<li><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solving-in-parallel">Solving in Parallel</a><ul>
<li><a class="reference internal" href="#openmp-threads-vs-mpi-ranks">OpenMP Threads vs. MPI Ranks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#meshing-with-gmsh">Meshing with Gmsh</a></li>
<li><a class="reference internal" href="#coupled-and-vector-equations">Coupled and Vector Equations</a></li>
<li><a class="reference internal" href="#boundary-conditions">Boundary Conditions</a><ul>
<li><a class="reference internal" href="#default-boundary-conditions">Default boundary conditions</a></li>
<li><a class="reference internal" href="#applying-fixed-value-dirichlet-boundary-conditions">Applying fixed value (Dirichlet) boundary conditions</a></li>
<li><a class="reference internal" href="#applying-fixed-gradient-boundary-conditions-neumann">Applying fixed gradient boundary conditions (Neumann)</a></li>
<li><a class="reference internal" href="#applying-fixed-flux-boundary-conditions">Applying fixed flux boundary conditions</a></li>
<li><a class="reference internal" href="#applying-outlet-or-inlet-boundary-conditions">Applying outlet or inlet boundary conditions</a></li>
<li><a class="reference internal" href="#applying-spatially-varying-boundary-conditions">Applying spatially varying boundary conditions</a></li>
<li><a class="reference internal" href="#applying-robin-boundary-conditions">Applying Robin boundary conditions</a></li>
<li><a class="reference internal" href="#applying-internal-boundary-conditions">Applying internal “boundary” conditions</a><ul>
<li><a class="reference internal" href="#internal-fixed-value">Internal fixed value</a></li>
<li><a class="reference internal" href="#internal-fixed-gradient">Internal fixed gradient</a></li>
<li><a class="reference internal" href="#internal-robin-condition">Internal Robin condition</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#running-under-python-2">Running under Python 2</a></li>
<li><a class="reference internal" href="#manual">Manual</a></li>
</ul>
</li>
</ul>

  </div>
<div class="sphinxsidebarsection">
  <h4>Previous topic</h4>
  <p class="topless"><a href="VIEWERS.html"
                        title="previous chapter">Viewers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="FAQ.html"
                        title="next chapter">Frequently Asked Questions</a></p>
</div>
  <div class="sphinxsidebarsection">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/documentation/USAGE.rst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  </div>
<div class="sphinxsidebarsection">
<div id="searchbox" style="display: none" role="search">
  <div data-layout-content-preview-placeholder-label="&quot;Sphinx
  Search&quot; field" class="nist-block nist-block--search">
  <h2>Quick search</h2>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
  </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>
<div class="sphinxsidebarsection" id="contact-wrapper">
  
        <div data-layout-content-preview-placeholder-label="&quot;Related
        organization tree&quot; views block" class="nist-block nist-block--org">
          
          <h2 class="nist-block__title">Organizations</h2>
              
              <div class="views-element-container"><div
              class="js-view-dom-id-70b0923f677edbe3dda361030ef8dc373cd0ca94065c39cfd81338de767f1019">

            <div class="nist-related-orgs"><div class="term-tree-list"><ul
            class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters" hreflang="en">NIST
            Headquarters</a><ul class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs"
            hreflang="en">Laboratory Programs</a><ul class="term"><li
            class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs/material-measurement-laboratory"
            hreflang="en">Material Measurement Laboratory</a>
			<ul
			class="term"><li
			class="selected"><a href="https://www.nist.gov/mml/msed"
			hreflang="en">Materials Science and Engineering
			Division</a></li><li
			class="selected"><a href="https://www.nist.gov/mml/ctcms"
			hreflang="en">Center for Theoretical and
			              Computational Materials Science</a></li></ul>
                          </li></ul></li></ul></li></ul></div></div>
          <div class="nist-related-orgs"></div>
          <div class="nist-related-orgs"></div>



        </div>
        </div>

          </div>


          <div data-layout-content-preview-placeholder-label="&quot;NIST
          Staff&quot; field" class="nist-block nist-block--contact">

          <h2 class="nist-block__title">NIST Staff</h2>

                  <div class="nist-field nist-field--label-hidden
                  nist-field--link-list entity-reference nist-field__items
                  nist-field--no-margin">
                            <div class="nist-field__item
                            nist-field--no-margin"><a
                            href="https://www.nist.gov/people/jonathan-e-guyer"
                            hreflang="en">Jonathan E. Guyer</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/daniel-wheeler"
                                hreflang="en">Daniel Wheeler</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/james-warren"
                                hreflang="en">James A. Warren</a></div>
                  </div>


          </div>

          <div data-layout-content-preview-placeholder-label="&quot;Contact&quot; field"
          class="nist-block nist-block--contact nist-block--mail">

          <h2 class="nist-block__title">
          <a class="" href="CONTACT.html" style="">Contact</a>
          </h2>

          </div>

</div>
        </div>
      </div>
      <div class="clearer"></div>
  </aside>
        </div>
      </div>

      <div class="panel-region--postface">
      <div class="inner region-inner inside">
        
<div class="pane pane--nist-node-date-pane" >

    </div>
      </div>
    </div>

        </section>
        </div>
      </div>

      </div>  
    </div>          

    </div>

  </div>

</div>


  


  <!-- Taken from https://www.filamentgroup.com/lab/html-includes/#another-demo%3A-including-another-html-file -->
  <iframe src="../_static/ntd2d_menu.html" onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()"></iframe>
    </div>
  </body>
</html>