
<!DOCTYPE html>


<!--[if IEMobile 7]><html class="iem7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if lte IE 6]><html class="lt-ie9 lt-ie8 lt-ie7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (IE 7)&(!IEMobile)]><html class="lt-ie9 lt-ie8 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if IE 8]><html class="lt-ie9 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)]><!--><html class="no-js"  lang="en" dir="ltr" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# book: http://ogp.me/ns/book# profile: http://ogp.me/ns/profile# video: http://ogp.me/ns/video# product: http://ogp.me/ns/product# content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"><!--<![endif]-->

  <head>
<meta charset="utf-8" />
<link rel="shortcut icon" href="https://www.nist.gov/sites/all/themes/nist_style/favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/x-mathjax-config">MathJax.Hub.Config({
  extensions: ['tex2jax.js'],
  jax: ['input/TeX','output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$$','$$'], ['\\(','\\)'] ],
    processEscapes: true,
    processClass: 'tex2jax',
    ignoreClass: 'html'
  },
  showProcessingMessages: false,
  messageStyle: 'none'
});
</script>
<meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">

      <!--[if lt IE 9]>
    <script src="https://www.nist.gov/sites/all/themes/zen/js/html5-respond.js"></script>
    <![endif]-->
    <!--[if (gte IE 6)&(lte IE 8)]>
  <script type="text/javascript" src="https://www.nist.gov/sites/all/themes/nist_style/js/selectivizr-min.js"></script>
  <![endif]--><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>examples.phase.simple &#8212; FiPy 3.4.4+261.g2e82a58e7 documentation</title>
    <link rel="stylesheet" href="../_static/ntd2d.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/ntd2d.css?v=de7af573" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/widetable.css?v=32b6a719" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=012fec31"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="FiPy 3.4.4+261.g2e82a58e7 documentation" href="../contents.html" />
    <link rel="up" title="examples.phase" href="examples.phase.html" />
    <link rel="next" title="examples.phase.symmetry" href="examples.phase.symmetry.html" />
    <link rel="prev" title="examples.phase.quaternary" href="examples.phase.quaternary.html" />
  
 


  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-3.6.2.min.js" type="text/javascript" defer="defer"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


  </head>
<!--  <body role="document">-->
  <body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-414011 node-type-software hide-breadcrumb section-services-resources page-panels is-panel" role="document">
      <div id="page" class="mini-header">



    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="examples.phase.symmetry.html" title="examples.phase.symmetry"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="examples.phase.quaternary.html" title="examples.phase.quaternary"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html"><img src="../_static/fipy.png" alt="FiPy logo"
                 style="vertical-align: middle; margin-top: -1px"/>
        FiPy</a> &gt;</li>

          <li class="nav-item nav-item-1"><a href="../API.html" ><code class="xref py py-mod docutils literal notranslate"><span class="pre">fipy</span></code> Package Documentation</a> &gt;</li>
          <li class="nav-item nav-item-2"><a href="examples.html" >examples</a> &gt;</li>
          <li class="nav-item nav-item-3"><a href="examples.phase.html" accesskey="U">examples.phase</a> &gt;</li> 
      </ul>
    </div>

  <div id="main" class="clearfix" role="main" tabindex="-1">
    <div class="main__inner">
      <div class="page-info">
        <a id="main-content"></a>
      </div>

      <div class="document">
        <div class="documentwrapper">

      <div id="content" class="column">
      <div id="block-nist-www-content" class="nist-block">
        <section class="nist-page__content usa-section clearfix">

         

        <div class="grid-container margin-top-4">
        <div class="grid-row grid-gap-6">

  <div class="nist-page__region nist-page__region--content tablet-lg:grid-col-8">
              <div class="body" role="main">
		
  <section id="module-examples.phase.simple">
<span id="examples-phase-simple"></span><h1>examples.phase.simple<a class="headerlink" href="#module-examples.phase.simple" title="Permalink to this heading">¶</a></h1>
<p>Solve a phase-field (Allen-Cahn) problem in one-dimension.</p>
<p>To run this example from the base FiPy directory, type
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">examples/phase/simple/input.py</span></code> at the command line.  A viewer
object should appear and, after being prompted to step through the different
examples, the word <code class="docutils literal notranslate"><span class="pre">finished</span></code> in the terminal.</p>
<p>This example takes the user through assembling a simple problem with
FiPy.  It describes a steady 1D phase field problem with no-flux
boundary conditions such that,</p>
<div class="math notranslate nohighlight" id="equation-eq-phase-simple">
<span class="eqno">(1)<a class="headerlink" href="#equation-eq-phase-simple" title="Permalink to this equation">¶</a></span>\[\frac{1}{M_\phi}\frac{\partial \phi}{\partial t} =
\kappa_\phi \nabla^2\phi
- \frac{\partial f}{\partial \phi}\]</div>
<p>For solidification problems, the Helmholtz free energy is frequently
given by</p>
<div class="math notranslate nohighlight">
\[f(\phi,T) = \frac{W}{2}g(\phi) + L_v\frac{T-T_M}{T_M}p(\phi)\]</div>
<p>where <span class="math notranslate nohighlight">\(W\)</span> is the double-well barrier height between phases, <span class="math notranslate nohighlight">\(L_v\)</span> is the latent
heat, <span class="math notranslate nohighlight">\(T\)</span> is the temperature, and <span class="math notranslate nohighlight">\(T_M\)</span> is the melting point.</p>
<p>One possible choice for the double-well function is</p>
<div class="math notranslate nohighlight">
\[g(\phi) = \phi^2(1 - \phi)^2\]</div>
<p>and for the interpolation function is</p>
<div class="math notranslate nohighlight">
\[p(\phi) = \phi^3(6\phi^2 - 15\phi + 10).\]</div>
<p>We create a 1D solution mesh</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="n">CellVariable</span><span class="p">,</span> <span class="n">Variable</span><span class="p">,</span> <span class="n">Grid1D</span><span class="p">,</span> <span class="n">DiffusionTerm</span><span class="p">,</span> <span class="n">TransientTerm</span><span class="p">,</span> <span class="n">ImplicitSourceTerm</span><span class="p">,</span> <span class="n">DummySolver</span><span class="p">,</span> <span class="n">Viewer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy.tools</span> <span class="kn">import</span> <span class="n">numerix</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">L</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nx</span> <span class="o">=</span> <span class="mi">400</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">nx</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate" id="index-0"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Grid1D</span><span class="p">(</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span><span class="p">)</span>
</pre></div>
</div>
<p>We create the phase field variable</p>
<div class="doctest highlight-default notranslate" id="index-1"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;phase&quot;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">)</span>
</pre></div>
</div>
<p>and set a step-function initial condition</p>
<div class="math notranslate nohighlight">
\[\begin{split}\phi =
\begin{cases}
    1 &amp; \text{for $x \le L/2$} \\
    0 &amp; \text{for $x &gt; L/2$}
\end{cases}
\quad\text{at $t = 0$}\end{split}\]</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cellCenters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>If we are running interactively, we’ll want a viewer to see the results</p>
<div class="doctest highlight-default notranslate" id="index-2"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">viewer</span> <span class="o">=</span> <span class="n">Viewer</span><span class="p">(</span><span class="nb">vars</span> <span class="o">=</span> <span class="p">(</span><span class="n">phase</span><span class="p">,))</span>
<span class="gp">... </span>    <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">... </span>    <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Initial condition. Press &lt;return&gt; to proceed...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/step.png"><img alt="step-function initial condition" class="align-center" src="../_images/step.png" style="width: 50%;" /></a>
<p>We choose the parameter values,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">kappa</span> <span class="o">=</span> <span class="mf">0.0025</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">W</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Lv</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Tm</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">T</span> <span class="o">=</span> <span class="n">Tm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">enthalpy</span> <span class="o">=</span> <span class="n">Lv</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">Tm</span><span class="p">)</span> <span class="o">/</span> <span class="n">Tm</span>
</pre></div>
</div>
<p>We build the equation by assembling the appropriate terms.  Since, with
<span class="math notranslate nohighlight">\(T = T_M\)</span>
we are interested in a steady-state solution, we omit the transient term
<span class="math notranslate nohighlight">\((1/M_\phi)\frac{\partial \phi}{\partial t}\)</span>.</p>
<p>The analytical solution for this steady-state phase field problem, in an infinite domain, is</p>
<div class="math notranslate nohighlight" id="equation-eq-phase-simple-analytical">
<span class="eqno">(2)<a class="headerlink" href="#equation-eq-phase-simple-analytical" title="Permalink to this equation">¶</a></span>\[\phi = \frac{1}{2}\left[1 - \tanh\frac{x-L/2}{2\sqrt{\kappa/W}}\right]\]</div>
<p>or</p>
<div class="doctest highlight-default notranslate" id="index-3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cellCenters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">analyticalArray</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">numerix</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numerix</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kappa</span><span class="o">/</span><span class="n">W</span><span class="p">))))</span>
</pre></div>
</div>
<p>We treat the diffusion term
<span class="math notranslate nohighlight">\(\kappa_\phi \nabla^2\phi\)</span>
implicitly,</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>“Diffusion” in <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> is not limited to the movement of atoms, but
rather refers to the spontaneous spreading of any quantity (e.g.,
solute, temperature, or in this case “phase”) by flow “down” the
gradient of that quantity.</p>
</div>
<p>The source term is</p>
<div class="math notranslate nohighlight">
\[\begin{split}S =
-\frac{\partial f}{\partial \phi} &amp;= -\frac{W}{2}g'(\phi) - L\frac{T-T_M}{T_M}p'(\phi) \\
&amp;= -\left[W\phi(1-\phi)(1-2\phi) + L\frac{T-T_M}{T_M}30\phi^2(1-\phi)^2\right] \\
&amp;= m_\phi\phi(1-\phi)\end{split}\]</div>
<p>where
<span class="math notranslate nohighlight">\(m_\phi \equiv -[W(1-2\phi) + 30\phi(1-\phi)L\frac{T-T_M}{T_M}]\)</span>.</p>
<p>The simplest approach is to add this source explicitly</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mPhi</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">W</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">enthalpy</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S0</span> <span class="o">=</span> <span class="n">mPhi</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phase</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eq</span> <span class="o">=</span> <span class="n">S0</span> <span class="o">+</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">kappa</span><span class="p">)</span>
</pre></div>
</div>
<p>After solving this equation</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eq</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">var</span> <span class="o">=</span> <span class="n">phase</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">DummySolver</span><span class="p">())</span>
</pre></div>
</div>
<p>we obtain the surprising result that <span class="math notranslate nohighlight">\(\phi\)</span> is zero everywhere.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">phase</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">analyticalArray</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">))</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">... </span>    <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Fully explicit source. Press &lt;return&gt; to proceed...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/explicit.png"><img alt="steady-state phase field zero everywhere" class="align-center" src="../_images/explicit.png" style="width: 50%;" /></a>
<p>On inspection, we can see that this occurs because, for our step-function initial condition,
<span class="math notranslate nohighlight">\(m_\phi = 0\)</span> everywhere,
hence we are actually only solving the simple implicit diffusion equation
<span class="math notranslate nohighlight">\(\kappa_\phi \nabla^2\phi = 0\)</span>,
which has exactly the uninteresting solution we obtained.</p>
<p>The resolution to this problem is to apply relaxation to obtain the desired
answer, i.e., the solution is allowed to relax in time from the initial
condition to the desired equilibrium solution.  To do so, we reintroduce the
transient term from Equation <a class="reference internal" href="#equation-eq-phase-simple">(1)</a></p>
<div class="doctest highlight-default notranslate" id="index-4"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eq</span> <span class="o">=</span> <span class="n">TransientTerm</span><span class="p">()</span> <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">kappa</span><span class="p">)</span> <span class="o">+</span> <span class="n">S0</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">range</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">eq</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">var</span> <span class="o">=</span> <span class="n">phase</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>After 13 time steps, the solution has converged to the analytical solution</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">phase</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">analyticalArray</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Relaxation, explicit. Press &lt;return&gt; to proceed...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/relaxation.png"><img alt="steady-state equilibrium phase field after relaxation" class="align-center" src="../_images/relaxation.png" style="width: 50%;" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The solution is only found accurate
to <span class="math notranslate nohighlight">\(\approx 4.3\times 10^{-5}\)</span>
because the infinite-domain analytical
solution <a class="reference internal" href="#equation-eq-phase-simple-analytical">(2)</a>
is not an exact representation for the solution in a finite domain of
length <span class="math notranslate nohighlight">\(L\)</span>.</p>
</div>
<p>Setting fixed-value boundary conditions of 1 and 0 would still require the
relaxation method with the fully explicit source.</p>
<p>Solution performance can be improved if we exploit the dependence of the
source on <span class="math notranslate nohighlight">\(\phi\)</span>.  By doing so, we can make the source semi-implicit,
improving the rate of convergence over the fully explicit approach.  The
source can only be semi-implicit because we employ sparse linear algebra
routines to solve the PDEs, i.e., there is no fully implicit way to
represent a term like
<span class="math notranslate nohighlight">\(\phi^4\)</span> in the linear set of equations
<span class="math notranslate nohighlight">\(\mathsf{M} \vec{\phi} - \vec{b} = 0\)</span>.</p>
<p>By linearizing a source as
<span class="math notranslate nohighlight">\(S = S_0 - S_1 \phi\)</span>,
we make it more implicit by adding the coefficient
<span class="math notranslate nohighlight">\(S_1\)</span>
to the matrix diagonal.  For numerical stability, this linear coefficient
must never be negative.</p>
<p>There are an infinite number of choices for this linearization, but
many do not converge very well. One choice is that used by Ryo
Kobayashi:</p>
<div class="doctest highlight-default notranslate" id="index-5"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">S0</span> <span class="o">=</span> <span class="n">mPhi</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="p">(</span><span class="n">mPhi</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span> <span class="o">=</span> <span class="n">mPhi</span> <span class="o">*</span> <span class="p">((</span><span class="n">mPhi</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">phase</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eq</span> <span class="o">=</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">kappa</span><span class="p">)</span> <span class="o">+</span> <span class="n">S0</span> \
<span class="gp">... </span>  <span class="o">+</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span> <span class="o">=</span> <span class="n">S1</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because <code class="docutils literal notranslate"><span class="pre">mPhi</span></code> is a variable field, the quantities <code class="docutils literal notranslate"><span class="pre">(mPhi</span> <span class="pre">&gt;</span> <span class="pre">0)</span></code>
and <code class="docutils literal notranslate"><span class="pre">(mPhi</span> <span class="pre">&lt;</span> <span class="pre">0)</span></code> evaluate to variable <em>fields</em> of <cite>True</cite> and <cite>False</cite>,
instead of single Boolean values.</p>
</div>
<p>This expression converges to the same value given by the explicit
relaxation approach, but in only 8 sweeps (note that because there is no
transient term, these sweeps are not time steps, but rather repeated
iterations at the same time step to reach a converged solution).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We use <a class="reference internal" href="fipy.terms.term.html#fipy.terms.term.Term.solve" title="fipy.terms.term.Term.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">solve()</span></code></a> instead of
<a class="reference internal" href="fipy.terms.term.html#fipy.terms.term.Term.sweep" title="fipy.terms.term.Term.sweep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sweep()</span></code></a> because we don’t care about the residual.
Either function would work, but <a class="reference internal" href="fipy.terms.term.html#fipy.terms.term.Term.solve" title="fipy.terms.term.Term.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">solve()</span></code></a> is a bit faster.</p>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">range</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">eq</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">var</span> <span class="o">=</span> <span class="n">phase</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">phase</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">analyticalArray</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">... </span>    <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Kobayashi, semi-implicit. Press &lt;return&gt; to proceed...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In general, the best convergence is obtained when the linearization gives a
good representation of the relationship between the source and the
dependent variable.  The best practical advice is to perform a Taylor
expansion of the source about the previous value of the dependent variable
such that
<span class="math notranslate nohighlight">\(S = S_\text{old} + \left.\frac{\partial S}{\partial
\phi}\right\rvert_\text{old} (\phi - \phi_\text{old}) = (S -
\frac{\partial S}{\partial\phi} \phi)_\text{old} +
\left.\frac{\partial S}{\partial \phi}\right|_\text{old} \phi\)</span>.
Now, if our source term is represented by <span class="math notranslate nohighlight">\(S = S_0 + S_1 \phi\)</span>,
then <span class="math notranslate nohighlight">\(S_1 = \left.\frac{\partial S}{\partial
\phi}\right|_\text{old}\)</span> and <span class="math notranslate nohighlight">\(S_0 = (S - \frac{\partial
S}{\partial\phi} \phi)_\text{old} = S_\text{old} - S_1
\phi_\text{old}\)</span>.
In this way, the linearized source will be tangent to the curve of the
actual source as a function of the dependent variable.</p>
<p>For our source,
<span class="math notranslate nohighlight">\(S = m_\phi \phi (1 - \phi)\)</span>,</p>
<div class="math notranslate nohighlight">
\[\frac{\partial S}{\partial \phi}
= \frac{\partial m_\phi}{\partial \phi} \phi (1 - \phi) + m_\phi (1 - 2\phi)\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\frac{\partial m_\phi}{\partial \phi} = 2 W - 30 (1 - 2\phi) L\frac{T-T_M}{T_M},\]</div>
<p>or</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dmPhidPhi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">W</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">enthalpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span> <span class="o">=</span> <span class="n">dmPhidPhi</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phase</span><span class="p">)</span> <span class="o">+</span> <span class="n">mPhi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S0</span> <span class="o">=</span> <span class="n">mPhi</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phase</span><span class="p">)</span> <span class="o">-</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">phase</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eq</span> <span class="o">=</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">kappa</span><span class="p">)</span> <span class="o">+</span> <span class="n">S0</span> \
<span class="gp">... </span>  <span class="o">+</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span> <span class="o">=</span> <span class="n">S1</span><span class="p">)</span>
</pre></div>
</div>
<p>Using this scheme, where the coefficient of the implicit source term is
tangent to the source, we reach convergence in only 5 sweeps</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">range</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">eq</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">var</span> <span class="o">=</span> <span class="n">phase</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">phase</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">analyticalArray</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">... </span>    <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Tangent, semi-implicit. Press &lt;return&gt; to proceed...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Although, for this simple problem, there is no appreciable difference in
run-time between the fully explicit source and the optimized semi-implicit
source, the benefit of 60% fewer sweeps should be obvious for larger
systems and longer iterations.</p>
<hr class="docutils" />
<p>This example has focused on just the region of the phase field interface in
equilibrium. Problems of interest, though, usually involve the dynamics of one phase
transforming to another. To that end, let us recast the problem using
physical parameters and dimensions. We’ll need a new mesh</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nx</span> <span class="o">=</span> <span class="mi">400</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="mf">5e-6</span> <span class="c1"># cm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">L</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">dx</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Grid1D</span><span class="p">(</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span><span class="p">)</span>
</pre></div>
</div>
<p>and thus must redeclare <span class="math notranslate nohighlight">\(\phi\)</span> on the new mesh</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;phase&quot;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="n">hasOld</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cellCenters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>We choose the parameter values appropriate for nickel, given in
<span id="id1">[<a class="reference internal" href="../references.html#id19" title="J. A. Warren and W. J. Boettinger. Prediction of dendritic growth and microsegregation in a binary alloy using the phase field method. Acta Metallurgica et Materialia, 43(2):689-703, 1995.">31</a>]</span></p>
<div class="doctest highlight-default notranslate" id="index-6"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Lv</span> <span class="o">=</span> <span class="mi">2350</span> <span class="c1"># J / cm**3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Tm</span> <span class="o">=</span> <span class="mf">1728.</span> <span class="c1"># K</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">T</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">Tm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">enthalpy</span> <span class="o">=</span> <span class="n">Lv</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">Tm</span><span class="p">)</span> <span class="o">/</span> <span class="n">Tm</span> <span class="c1"># J / cm**3</span>
</pre></div>
</div>
<p>The parameters of the phase field model can be related to the surface
energy <span class="math notranslate nohighlight">\(\sigma\)</span> and the interfacial thickness <span class="math notranslate nohighlight">\(\delta\)</span> by</p>
<div class="math notranslate nohighlight">
\[\begin{split}\kappa &amp;= 6\sigma\delta \\
W &amp;= \frac{6\sigma}{\delta} \\
M_\phi &amp;= \frac{T_m\beta}{6 L \delta}.\end{split}\]</div>
<p>We take <span class="math notranslate nohighlight">\(\delta \approx \Delta x\)</span>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">delta</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">dx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigma</span> <span class="o">=</span> <span class="mf">3.7e-5</span> <span class="c1"># J / cm**2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.33</span> <span class="c1"># cm / (K s)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kappa</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">delta</span> <span class="c1"># J / cm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">W</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">/</span> <span class="n">delta</span> <span class="c1"># J / cm**3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Mphi</span> <span class="o">=</span> <span class="n">Tm</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="mf">6.</span> <span class="o">*</span> <span class="n">Lv</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span> <span class="c1"># cm**3 / (J s)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">displacement</span> <span class="o">=</span> <span class="n">L</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="gp">... </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">displacement</span> <span class="o">=</span> <span class="n">L</span> <span class="o">*</span> <span class="mf">0.025</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">analyticalArray</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;tanh&quot;</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="n">value</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">numerix</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">L</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> <span class="n">displacement</span><span class="p">))</span>
<span class="gp">... </span>                                                             <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">delta</span><span class="p">))))</span>
</pre></div>
</div>
<p>and make a new viewer</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">viewer2</span> <span class="o">=</span> <span class="n">Viewer</span><span class="p">(</span><span class="nb">vars</span> <span class="o">=</span> <span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">analyticalArray</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">viewer2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we can redefine the transient phase field equation, using the optimal
form of the source term shown above</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mPhi</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">W</span> <span class="o">+</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">enthalpy</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dmPhidPhi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">W</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span> <span class="o">*</span> <span class="n">enthalpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span> <span class="o">=</span> <span class="n">dmPhidPhi</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phase</span><span class="p">)</span> <span class="o">+</span> <span class="n">mPhi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">phase</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S0</span> <span class="o">=</span> <span class="n">mPhi</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phase</span><span class="p">)</span> <span class="o">-</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">phase</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eq</span> <span class="o">=</span> <span class="n">TransientTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">Mphi</span><span class="p">)</span> <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">kappa</span><span class="p">)</span> \
<span class="gp">... </span>                        <span class="o">+</span> <span class="n">S0</span> <span class="o">+</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span> <span class="o">=</span> <span class="n">S1</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to separate the effect of forming the phase field interface
from the kinetics of moving it, we first equilibrate at the melting
point. We now use the <a class="reference internal" href="fipy.terms.term.html#fipy.terms.term.Term.sweep" title="fipy.terms.term.Term.sweep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sweep()</span></code></a> method instead of
<a class="reference internal" href="fipy.terms.term.html#fipy.terms.term.Term.solve" title="fipy.terms.term.Term.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">solve()</span></code></a> because we require the residual.</p>
<div class="doctest highlight-default notranslate" id="index-7"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timeStep</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">range</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">phase</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">res</span> <span class="o">=</span> <span class="mf">1e+10</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mf">1e-5</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">res</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">timeStep</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">viewer2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>and then quench by 1 K</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">T</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">T</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>In order to have a stable numerical solution, the interface must not move
more than one grid point per time step,
we thus set the timestep according to the grid spacing <span class="math notranslate nohighlight">\(\Delta x\)</span>,
the linear kinetic coefficient <span class="math notranslate nohighlight">\(\beta\)</span>, and the undercooling
<span class="math notranslate nohighlight">\(\abs{T_m - T}\)</span>
Again we use the <a class="reference internal" href="fipy.terms.term.html#fipy.terms.term.Term.sweep" title="fipy.terms.term.Term.sweep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sweep()</span></code></a> method as a replacement for
<a class="reference internal" href="fipy.terms.term.html#fipy.terms.term.Term.solve" title="fipy.terms.term.Term.solve"><code class="xref py py-meth docutils literal notranslate"><span class="pre">solve()</span></code></a>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">velocity</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Tm</span> <span class="o">-</span> <span class="n">T</span><span class="p">())</span> <span class="c1"># cm / s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">timeStep</span> <span class="o">=</span> <span class="mf">.1</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">velocity</span> <span class="c1"># s</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">elapsed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="n">displacement</span> <span class="o">/</span> <span class="n">velocity</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">phase</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">res</span> <span class="o">=</span> <span class="mf">1e+10</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mf">1e-5</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">res</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">timeStep</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">elapsed</span> <span class="o">+=</span> <span class="n">timeStep</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">viewer2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>A hyperbolic tangent is not an exact steady-state solution given the
quintic polynomial we chose for the <span class="math notranslate nohighlight">\(p\)</span> function, but it gives a
reasonable approximation.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">phase</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">analyticalArray</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">2e-3</span><span class="p">))</span>
<span class="go">1</span>
</pre></div>
</div>
<p>If we had made another common choice of <span class="math notranslate nohighlight">\(p(\phi) = \phi^2(3 - 2\phi)\)</span>,
we would have found much better agreement, as that case does give an
exact <span class="math notranslate nohighlight">\(\tanh\)</span> solution in steady state.
If SciPy is available, another way to compare against the expected result
is to do a least-squared fit to determine the interface velocity and
thickness</p>
<div class="doctest highlight-default notranslate" id="index-8"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">tanhResiduals</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">V</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">p</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">numerix</span><span class="o">.</span><span class="n">tanh</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">V</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="n">L</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="p">)))</span>
<span class="gp">... </span>    <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">leastsq</span> 
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span>  <span class="n">mesh</span><span class="o">.</span><span class="n">cellCenters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">... </span>    <span class="p">(</span><span class="n">V_fit</span><span class="p">,</span> <span class="n">d_fit</span><span class="p">),</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">tanhResiduals</span><span class="p">,</span> <span class="p">[</span><span class="n">L</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">delta</span><span class="p">],</span>
<span class="gp">... </span>                                  <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">phase</span><span class="o">.</span><span class="n">globalValue</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">globalValue</span><span class="p">,</span> <span class="n">elapsed</span><span class="p">))</span> 
<span class="gp">... </span><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">V_fit</span> <span class="o">=</span> <span class="n">d_fit</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The SciPy library is unavailable to fit the interface </span><span class="se">\</span>
<span class="gp">... </span><span class="s2">thickness and velocity&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">V_fit</span> <span class="o">/</span> <span class="n">velocity</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">4.1e-2</span><span class="p">)</span> 
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d_fit</span> <span class="o">/</span> <span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">2e-2</span><span class="p">)</span> 
<span class="go">True</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span> <span class="nb">input</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Dimensional, semi-implicit. Press &lt;return&gt; to proceed...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/dimensional.png"><img alt="phase field when solved with physical parameters" class="align-center" src="../_images/dimensional.png" style="width: 90%;" /></a>
</section>


                <div class='last-updated'>
                Last updated on Nov 20, 2024.
                Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.1.2.
                </div>
              </div>
  </div>  
  <aside class="nist-page__region nist-page__region--sidebar-second tablet-lg:grid-col-4">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

<strong>FiPy: A Finite Volume PDE Solver Using Python</strong><br />
Version 3.4.4+261.g2e82a58e7

<div class="sphinxsidebarsection">
  <h4>Previous topic</h4>
  <p class="topless"><a href="examples.phase.quaternary.html"
                        title="previous chapter">examples.phase.quaternary</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="examples.phase.symmetry.html"
                        title="next chapter">examples.phase.symmetry</a></p>
</div>
  <div class="sphinxsidebarsection">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/generated/examples.phase.simple.rst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  </div>
<div class="sphinxsidebarsection">
<div id="searchbox" style="display: none" role="search">
  <div data-layout-content-preview-placeholder-label="&quot;Sphinx
  Search&quot; field" class="nist-block nist-block--search">
  <h2 id="searchlabel">Quick search</h2>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
  </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
</div>
<div class="sphinxsidebarsection" id="contact-wrapper">
  
        <div data-layout-content-preview-placeholder-label="&quot;Related
        organization tree&quot; views block" class="nist-block nist-block--org">
          
          <h2 class="nist-block__title">Organizations</h2>
              
              <div class="views-element-container"><div
              class="js-view-dom-id-70b0923f677edbe3dda361030ef8dc373cd0ca94065c39cfd81338de767f1019">

            <div class="nist-related-orgs"><div class="term-tree-list"><ul
            class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters" hreflang="en">NIST
            Headquarters</a><ul class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs"
            hreflang="en">Laboratory Programs</a><ul class="term"><li
            class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs/material-measurement-laboratory"
            hreflang="en">Material Measurement Laboratory</a>
			<ul
			class="term"><li
			class="selected"><a href="https://www.nist.gov/mml/msed"
			hreflang="en">Materials Science and Engineering
			Division</a></li><li
			class="selected"><a href="https://www.nist.gov/mml/ctcms"
			hreflang="en">Center for Theoretical and
			              Computational Materials Science</a></li></ul>
                          </li></ul></li></ul></li></ul></div></div>
          <div class="nist-related-orgs"></div>
          <div class="nist-related-orgs"></div>



        </div>
        </div>

          </div>


          <div data-layout-content-preview-placeholder-label="&quot;NIST
          Staff&quot; field" class="nist-block nist-block--contact">

          <h2 class="nist-block__title">NIST Staff</h2>

                  <div class="nist-field nist-field--label-hidden
                  nist-field--link-list entity-reference nist-field__items
                  nist-field--no-margin">
                            <div class="nist-field__item
                            nist-field--no-margin"><a
                            href="https://www.nist.gov/people/jonathan-e-guyer"
                            hreflang="en">Jonathan E. Guyer</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/daniel-wheeler"
                                hreflang="en">Daniel Wheeler</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/james-warren"
                                hreflang="en">James A. Warren</a></div>
                  </div>


          </div>

          <div data-layout-content-preview-placeholder-label="&quot;Contact&quot; field"
          class="nist-block nist-block--contact nist-block--mail">

          <h2 class="nist-block__title">
          <a class="" href="../docs/source/CONTACT.html" style="">Contact</a>
          </h2>

          </div>

</div>
        </div>
      </div>
      <div class="clearer"></div>
  </aside>
        </div>
      </div>

      <div class="panel-region--postface">
      <div class="inner region-inner inside">
        
<div class="pane pane--nist-node-date-pane" >

    </div>
      </div>
    </div>

        </section>
        </div>
      </div>

      </div>  
    </div>          

    </div>

  </div>

</div>


  


  <!-- Taken from https://www.filamentgroup.com/lab/html-includes/#another-demo%3A-including-another-html-file -->
  <iframe src="../_static/ntd2d_menu.html" onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()"></iframe>
    </div>
  </body>
</html>