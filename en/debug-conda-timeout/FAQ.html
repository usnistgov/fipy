
<!DOCTYPE html>


<!--[if IEMobile 7]><html class="iem7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if lte IE 6]><html class="lt-ie9 lt-ie8 lt-ie7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (IE 7)&(!IEMobile)]><html class="lt-ie9 lt-ie8 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if IE 8]><html class="lt-ie9 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)]><!--><html class="no-js"  lang="en" dir="ltr" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# book: http://ogp.me/ns/book# profile: http://ogp.me/ns/profile# video: http://ogp.me/ns/video# product: http://ogp.me/ns/product# content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"><!--<![endif]-->

  <head>
<meta charset="utf-8" />
<link rel="shortcut icon" href="https://www.nist.gov/sites/all/themes/nist_style/favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/x-mathjax-config">MathJax.Hub.Config({
  extensions: ['tex2jax.js'],
  jax: ['input/TeX','output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$$','$$'], ['\\(','\\)'] ],
    processEscapes: true,
    processClass: 'tex2jax',
    ignoreClass: 'html'
  },
  showProcessingMessages: false,
  messageStyle: 'none'
});
</script>
<meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">

      <!--[if lt IE 9]>
    <script src="https://www.nist.gov/sites/all/themes/zen/js/html5-respond.js"></script>
    <![endif]-->
    <!--[if (gte IE 6)&(lte IE 8)]>
  <script type="text/javascript" src="https://www.nist.gov/sites/all/themes/nist_style/js/selectivizr-min.js"></script>
  <![endif]--><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Frequently Asked Questions &#8212; FiPy 3.4.5+26.g5d720626d documentation</title>
    <link rel="stylesheet" href="_static/ntd2d.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/ntd2d.css?v=de7af573" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=5e886910"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://pages.nist.gov/fipy/en/latest/FAQ.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="FiPy 3.4.5+26.g5d720626d documentation" href="contents.html" />
    <link rel="up" title="Introduction" href="introduction.html" />
    <link rel="next" title="Efficiency" href="EFFICIENCY.html" />
    <link rel="prev" title="Using FiPy" href="USAGE.html" />
  
 


  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-3.6.2.min.js" type="text/javascript" defer="defer"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


  </head>
<!--  <body role="document">-->
  <body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-414011 node-type-software hide-breadcrumb section-services-resources page-panels is-panel" role="document">
      <div id="page" class="mini-header">



    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="EFFICIENCY.html" title="Efficiency"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="USAGE.html" title="Using FiPy"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html"><img src="_static/fipy.png" alt="FiPy logo"
                 style="vertical-align: middle; margin-top: -1px"/>
        FiPy</a> &gt;</li>

          <li class="nav-item nav-item-1"><a href="introduction.html" accesskey="U">Introduction</a> &gt;</li> 
      </ul>
    </div>

  <div id="main" class="clearfix" role="main" tabindex="-1">
    <div class="main__inner">
      <div class="page-info">
        <a id="main-content"></a>
      </div>

      <div class="document">
        <div class="documentwrapper">

      <div id="content" class="column">
      <div id="block-nist-www-content" class="nist-block">
        <section class="nist-page__content usa-section clearfix">

         

        <div class="grid-container margin-top-4">
        <div class="grid-row grid-gap-6">

  <div class="nist-page__region nist-page__region--content tablet-lg:grid-col-8">
              <div class="body" role="main">
		
  <section id="frequently-asked-questions">
<span id="faq"></span><h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this heading">¶</a></h1>
<section id="how-do-i-represent-an-equation-in-fipy">
<h2>How do I represent an equation in FiPy?<a class="headerlink" href="#how-do-i-represent-an-equation-in-fipy" title="Permalink to this heading">¶</a></h2>
<p>As explained in <a class="reference internal" href="numerical/index.html#chap-numerics"><span class="std std-ref">Theoretical and Numerical Background</span></a>, the canonical
governing equation that can be solved by <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> for the dependent
<a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable" title="fipy.variables.cellVariable.CellVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">CellVariable</span></code></a> <span class="math notranslate nohighlight">\(\phi\)</span> is</p>
<div class="math notranslate nohighlight">
\[\underbrace{
  \frac{\partial (\rho \phi)}{\partial t}
}_{\text{transient}}
+
\underbrace{
  \vphantom{\frac{\partial (\rho \phi)}{\partial t}}
  \nabla \cdot \left( \vec{u} \phi \right)
}_{\text{convection}}
=
\underbrace{
  \vphantom{\frac{\partial (\rho \phi)}{\partial t}}
  \left[ \nabla \cdot \left( \Gamma_i \nabla \right) \right]^n \phi
}_{\text{diffusion}}
+
\underbrace{
  \vphantom{\frac{\partial (\rho \phi)}{\partial t}}
  S_{\phi}
}_{\text{source}}\]</div>
<p>and the individual terms are discussed in <a class="reference internal" href="numerical/discret.html#section-discretization"><span class="std std-ref">Discretization</span></a>.</p>
<p>A physical problem can involve many different coupled
governing equations, one for each variable.  Numerous specific
examples are presented in Part <a class="reference internal" href="EXAMPLES.html#part-examples"><span class="std std-ref">Examples</span></a>.</p>
<section id="is-there-a-way-to-model-an-anisotropic-diffusion-process-or-more-generally-to-represent-the-diffusion-coefficient-as-a-tensor-so-that-the-diffusion-term-takes-the-form-partial-i-gamma-ij-partial-j-phi">
<h3>Is there a way to model an anisotropic diffusion process or more generally to represent the diffusion coefficient as a tensor so that the diffusion term takes the form <span class="math notranslate nohighlight">\(\partial_i \Gamma_{ij}\partial_j \phi\)</span>?<a class="headerlink" href="#is-there-a-way-to-model-an-anisotropic-diffusion-process-or-more-generally-to-represent-the-diffusion-coefficient-as-a-tensor-so-that-the-diffusion-term-takes-the-form-partial-i-gamma-ij-partial-j-phi" title="Permalink to this heading">¶</a></h3>
<p>Terms of the form <span class="math notranslate nohighlight">\(\partial_i \Gamma_{ij}\partial_j \phi\)</span> can be
posed in <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> by using a list, tuple rank 1
or rank 2 <a class="reference internal" href="generated/fipy.variables.faceVariable.html#fipy.variables.faceVariable.FaceVariable" title="fipy.variables.faceVariable.FaceVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code></a> to represent a
vector or tensor diffusion coefficient. For example, if we wished to
represent a diffusion term with an anisotropy ratio of 5 aligned along the
x-coordinate axis, we could write the term as,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DiffusionTerm</span><span class="p">([[[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]])</span>
</pre></div>
</div>
<p>which represents <span class="math notranslate nohighlight">\(5 \partial_x^2 + \partial_y^2\)</span>.  Notice that
the tensor, written in the form of a list, is contained within
a list. This is because the first index of the list refers to
the order of the term not the first index of the tensor (see
<a class="reference internal" href="numerical/discret.html#discret-higherorderdiffusion"><span class="std std-ref">Higher Order Diffusion</span></a>). This notation, although succinct can
sometimes be confusing so a number of cases are interpreted below.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DiffusionTerm</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
</pre></div>
</div>
<p>This represents the same term as the case examined above.
The vector notation is just a short-hand representation
for the diagonal of the tensor. Off-diagonals are assumed
to be zero.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DiffusionTerm</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>This simply represents a fourth order isotropic diffusion
term of the form <span class="math notranslate nohighlight">\(5 \left( \partial_x^2 + \partial_y^2
\right)^2\)</span>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DiffusionTerm</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
</pre></div>
</div>
<p>Nominally, this should represent a fourth order diffusion
term of the form <span class="math notranslate nohighlight">\(\partial_x^2 \partial_y^2\)</span>, but <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>
does not currently support anisotropy for higher order
diffusion terms so this may well throw an error or give
anomalous results.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cellCenters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">CellVariable</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span>
<span class="gp">... </span>                           <span class="n">value</span><span class="o">=</span><span class="p">[[</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">]])</span>
</pre></div>
</div>
<p>This represents an anisotropic diffusion coefficient that
varies spatially so that the term has the form
<span class="math notranslate nohighlight">\(\partial_x (x^2 \partial_x + x y \partial_y)
+ \partial_y (-x y \partial_x - y^2 \partial_y)
\equiv x \partial_x - y \partial_y + x^2 \partial_x^2 - y^2
\partial_y^2\)</span>.</p>
<p>Generally, anisotropy is not conveniently aligned along the coordinate
axes; in these cases, it is necessary to apply a rotation matrix in
order to calculate the correct tensor values, see
<a class="reference internal" href="generated/examples.diffusion.anisotropy.html#module-examples.diffusion.anisotropy" title="examples.diffusion.anisotropy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.anisotropy</span></code></a> for details.</p>
</section>
<section id="how-do-i-represent-a-term-that-doesn-t-involve-the-dependent-variable">
<h3>How do I represent a <cite>…</cite> term that <em>doesn’t</em> involve the dependent variable?<a class="headerlink" href="#how-do-i-represent-a-term-that-doesn-t-involve-the-dependent-variable" title="Permalink to this heading">¶</a></h3>
<p>It is important to realize that, even though an expression may
superficially resemble one of those shown in <a class="reference internal" href="numerical/discret.html#section-discretization"><span class="std std-ref">Discretization</span></a>, if the dependent variable
<em>for that PDE</em> does not appear in the appropriate place, then that
term should be treated as a source.</p>
<section id="how-do-i-represent-a-diffusive-source">
<h4>How do I represent a diffusive source?<a class="headerlink" href="#how-do-i-represent-a-diffusive-source" title="Permalink to this heading">¶</a></h4>
<p>If the governing equation for <span class="math notranslate nohighlight">\(\phi\)</span> is</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \phi}{\partial t}
= \nabla\cdot\left( D_1 \nabla \phi\right)
+ \nabla\cdot\left( D_2 \nabla \xi\right)\]</div>
<p>then the first term is a <a class="reference internal" href="generated/fipy.terms.transientTerm.html#fipy.terms.transientTerm.TransientTerm" title="fipy.terms.transientTerm.TransientTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransientTerm</span></code></a> and the second term is a
<a class="reference internal" href="generated/fipy.terms.diffusionTerm.html#fipy.terms.diffusionTerm.DiffusionTerm" title="fipy.terms.diffusionTerm.DiffusionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiffusionTerm</span></code></a>, but the third term is simply an explicit source,
which is written in Python as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">D2</span> <span class="o">*</span> <span class="n">xi</span><span class="o">.</span><span class="n">faceGrad</span><span class="p">)</span><span class="o">.</span><span class="n">divergence</span>
</pre></div>
</div>
<p>Higher order diffusive sources can be obtained by simply nesting the
references to <a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable.faceGrad" title="fipy.variables.cellVariable.CellVariable.faceGrad"><code class="xref py py-attr docutils literal notranslate"><span class="pre">faceGrad</span></code></a> and
<a class="reference internal" href="generated/fipy.variables.faceVariable.html#fipy.variables.faceVariable.FaceVariable.divergence" title="fipy.variables.faceVariable.FaceVariable.divergence"><code class="xref py py-attr docutils literal notranslate"><span class="pre">divergence</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We use <a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable.faceGrad" title="fipy.variables.cellVariable.CellVariable.faceGrad"><code class="xref py py-attr docutils literal notranslate"><span class="pre">faceGrad</span></code></a>, rather than
<a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable.grad" title="fipy.variables.cellVariable.CellVariable.grad"><code class="xref py py-attr docutils literal notranslate"><span class="pre">grad</span></code></a>, in order to obtain a second-order spatial
discretization of the diffusion term in <span class="math notranslate nohighlight">\(\xi\)</span>, consistent with the
matrix that is formed by
<a class="reference internal" href="generated/fipy.terms.diffusionTerm.html#fipy.terms.diffusionTerm.DiffusionTerm" title="fipy.terms.diffusionTerm.DiffusionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiffusionTerm</span></code></a> for <span class="math notranslate nohighlight">\(\phi\)</span>.</p>
</div>
</section>
<section id="how-do-i-represent-a-convective-source">
<h4>How do I represent a convective source?<a class="headerlink" href="#how-do-i-represent-a-convective-source" title="Permalink to this heading">¶</a></h4>
<p>The convection of an independent field <span class="math notranslate nohighlight">\(\xi\)</span> as in</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \phi}{\partial t}
= \nabla\cdot
\left(
    \vec{u} \xi
\right)\]</div>
<p>can be rendered as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">xi</span><span class="o">.</span><span class="n">arithmeticFaceValue</span><span class="p">)</span><span class="o">.</span><span class="n">divergence</span>
</pre></div>
</div>
<p>when <span class="math notranslate nohighlight">\(\vec{u}\)</span> is a rank-1 <a class="reference internal" href="generated/fipy.variables.faceVariable.html#fipy.variables.faceVariable.FaceVariable" title="fipy.variables.faceVariable.FaceVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code></a> (preferred) or as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">xi</span><span class="p">)</span><span class="o">.</span><span class="n">divergence</span>
</pre></div>
</div>
<p>if <span class="math notranslate nohighlight">\(\vec{u}\)</span> is a rank-1 <a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable" title="fipy.variables.cellVariable.CellVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">CellVariable</span></code></a>.</p>
</section>
<section id="how-do-i-represent-a-transient-source">
<h4>How do I represent a transient source?<a class="headerlink" href="#how-do-i-represent-a-transient-source" title="Permalink to this heading">¶</a></h4>
<p>The time-rate-of change of an independent variable <span class="math notranslate nohighlight">\(\xi\)</span>, such as in</p>
<div class="math notranslate nohighlight">
\[\frac{\partial (\rho_1 \phi)}{\partial t}
= \frac{\partial (\rho_2 \xi)}{\partial t}\]</div>
<p>does not have an abstract form in <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> and should be discretized
directly, in the manner of Equation <a class="reference internal" href="numerical/discret.html#equation-num-tra">(1)</a>, as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">TransientTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">rho1</span><span class="p">)</span> <span class="o">==</span> <span class="n">rho2</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi</span> <span class="o">-</span> <span class="n">xi</span><span class="o">.</span><span class="n">old</span><span class="p">)</span> <span class="o">/</span> <span class="n">timeStep</span>
</pre></div>
</div>
<p>This technique is used in <a class="reference internal" href="generated/examples.phase.anisotropy.html#module-examples.phase.anisotropy" title="examples.phase.anisotropy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.anisotropy</span></code></a>.</p>
</section>
</section>
<section id="what-if-my-term-involves-the-dependent-variable-but-not-where-fipy-puts-it">
<h3>What if my term involves the dependent variable, but not where FiPy puts it?<a class="headerlink" href="#what-if-my-term-involves-the-dependent-variable-but-not-where-fipy-puts-it" title="Permalink to this heading">¶</a></h3>
<p>Frequently, viewing the term from a different perspective will allow it to
be cast in one of the canonical forms. For example, the third term in</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \phi}{\partial t}
= \nabla\cdot\left( D_1 \nabla \phi\right)
+ \nabla\cdot\left( D_2 \phi \nabla \xi\right)\]</div>
<p>might be considered as the diffusion of the independent variable <span class="math notranslate nohighlight">\(\xi\)</span> with
a mobility <span class="math notranslate nohighlight">\(D_2\phi\)</span> that is a function of the dependent variable <span class="math notranslate nohighlight">\(\phi\)</span>.
For <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>’s purposes, however, this term represents the convection of
<span class="math notranslate nohighlight">\(\phi\)</span>, with a velocity <span class="math notranslate nohighlight">\(D_2\nabla\xi\)</span>, due to the counter-diffusion of
<span class="math notranslate nohighlight">\(\xi\)</span>, so</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eq</span> <span class="o">=</span> <span class="n">TransientTerm</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">D1</span><span class="p">)</span>
<span class="gp">... </span>                         <span class="o">+</span> <span class="o">&lt;</span><span class="n">Specific</span><span class="o">&gt;</span><span class="n">ConvectionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">D2</span> <span class="o">*</span> <span class="n">xi</span><span class="o">.</span><span class="n">faceGrad</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With the advent of <a class="reference internal" href="USAGE.html#coupledequations"><span class="std std-ref">Coupled and Vector Equations</span></a> in FiPy 3.x, it is now
possible to represent both terms with
<a class="reference internal" href="generated/fipy.terms.diffusionTerm.html#fipy.terms.diffusionTerm.DiffusionTerm" title="fipy.terms.diffusionTerm.DiffusionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiffusionTerm</span></code></a>.</p>
</div>
</section>
<section id="what-if-the-coefficient-of-a-term-depends-on-the-variable-that-i-m-solving-for">
<h3>What if the coefficient of a term depends on the variable that I’m solving for?<a class="headerlink" href="#what-if-the-coefficient-of-a-term-depends-on-the-variable-that-i-m-solving-for" title="Permalink to this heading">¶</a></h3>
<p>A non-linear coefficient, such as the diffusion coefficient in
<span class="math notranslate nohighlight">\(\nabla\cdot[\Gamma_1(\phi) \nabla \phi] = \nabla\cdot[\Gamma_0 \phi (1 -
\phi) \nabla\phi]\)</span> is not a problem for <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>. Simply write it as it
appears:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">diffTerm</span> <span class="o">=</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">Gamma0</span> <span class="o">*</span> <span class="n">phi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Due to the nonlinearity of the coefficient, it will probably be
necessary to “sweep” the solution to convergence as discussed in
<a class="reference internal" href="#faq-iterationstimestepssweeps"><span class="std std-ref">Iterations, timesteps, and sweeps? Oh, my!</span></a>.</p>
</div>
</section>
</section>
<section id="how-can-i-see-what-i-m-doing">
<h2>How can I see what I’m doing?<a class="headerlink" href="#how-can-i-see-what-i-m-doing" title="Permalink to this heading">¶</a></h2>
<section id="how-do-i-export-data">
<h3>How do I export data?<a class="headerlink" href="#how-do-i-export-data" title="Permalink to this heading">¶</a></h3>
<p>The way to save your calculations depends on how you plan to make use of
the data. If you want to save it for “restart” (so that you can continue
or redirect a calculation from some intermediate stage), then you’ll want
to “pickle” the <a class="reference internal" href="glossary.html#term-Python"><span class="xref std std-term">Python</span></a> data with the <a class="reference internal" href="generated/fipy.tools.dump.html#module-fipy.tools.dump" title="fipy.tools.dump"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dump</span></code></a> module. This is
illustrated in <a class="reference internal" href="generated/examples.phase.anisotropy.html#module-examples.phase.anisotropy" title="examples.phase.anisotropy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.anisotropy</span></code></a>,
<a class="reference internal" href="generated/examples.phase.impingement.mesh40x1.html#module-examples.phase.impingement.mesh40x1" title="examples.phase.impingement.mesh40x1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.impingement.mesh40x1</span></code></a>,
<a class="reference internal" href="generated/examples.phase.impingement.mesh20x20.html#module-examples.phase.impingement.mesh20x20" title="examples.phase.impingement.mesh20x20"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.impingement.mesh20x20</span></code></a>, and
<a class="reference internal" href="generated/examples.levelSet.electroChem.howToWriteAScript.html#module-examples.levelSet.electroChem.howToWriteAScript" title="examples.levelSet.electroChem.howToWriteAScript"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.levelSet.electroChem.howToWriteAScript</span></code></a>.</p>
<p>On the other hand, pickled <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> data is of little use to anything
besides <a class="reference internal" href="glossary.html#term-Python"><span class="xref std std-term">Python</span></a> and <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>. If you want to import your calculations into
another piece of software, whether to make publication-quality graphs or
movies, or to perform some analysis, or as input to another stage of a
multiscale model, then you can save your data as an <abbr>ASCII</abbr> text
file of tab-separated-values with a <a class="reference internal" href="generated/fipy.viewers.tsvViewer.html#fipy.viewers.tsvViewer.TSVViewer" title="fipy.viewers.tsvViewer.TSVViewer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSVViewer</span></code></a>. This is illustrated
in <a class="reference internal" href="generated/examples.diffusion.circle.html#module-examples.diffusion.circle" title="examples.diffusion.circle"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.circle</span></code></a>.</p>
</section>
<section id="how-do-i-save-a-plot-image">
<h3>How do I save a plot image?<a class="headerlink" href="#how-do-i-save-a-plot-image" title="Permalink to this heading">¶</a></h3>
<p>Some of the viewers have a button or other mechanism in the user interface
for saving an image file. Also, you can supply an optional keyword
<code class="docutils literal notranslate"><span class="pre">filename</span></code> when you tell the viewer to
<a class="reference internal" href="generated/fipy.viewers.viewer.html#fipy.viewers.viewer.AbstractViewer.plot" title="fipy.viewers.viewer.AbstractViewer.plot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot()</span></code></a>, <em>e.g.</em></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;myimage.ext&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>which will save a file named <code class="file docutils literal notranslate"><span class="pre">myimage.ext</span></code> in your current working
directory. The type of image is determined by the file extension
“<code class="file docutils literal notranslate"><span class="pre">.ext</span></code>”. Different viewers have different capabilities:</p>
<dl>
<dt><a class="reference internal" href="glossary.html#term-Matplotlib"><span class="xref std std-term">Matplotlib</span></a></dt><dd><p>accepts “<code class="file docutils literal notranslate"><span class="pre">.eps</span></code>,” “<code class="file docutils literal notranslate"><span class="pre">.jpg</span></code>”
(<a class="reference external" href="http://www.jpeg.org/">Joint Photographic Experts Group</a>),
and “<code class="file docutils literal notranslate"><span class="pre">.png</span></code>”
(<a class="reference external" href="http://www.w3.org/Graphics/PNG/">Portable Network Graphics</a>).</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Actually, <a class="reference internal" href="glossary.html#term-Matplotlib"><span class="xref std std-term">Matplotlib</span></a> supports different extensions, depending
on the chosen <a class="reference external" href="http://matplotlib.sourceforge.net/backends.html">backend</a>, but our
<a class="reference internal" href="generated/fipy.viewers.matplotlibViewer.abstractMatplotlibViewer.html#fipy.viewers.matplotlibViewer.abstractMatplotlibViewer.AbstractMatplotlibViewer" title="fipy.viewers.matplotlibViewer.abstractMatplotlibViewer.AbstractMatplotlibViewer"><code class="xref py py-class docutils literal notranslate"><span class="pre">MatplotlibViewer</span></code></a> classes
don’t properly support this yet.</p>
</div>
</dd>
</dl>
<section id="what-if-i-only-want-the-saved-file-with-no-display-on-screen">
<h4>What if I only want the saved file, with no display on screen?<a class="headerlink" href="#what-if-i-only-want-the-saved-file-with-no-display-on-screen" title="Permalink to this heading">¶</a></h4>
<p>To our knowledge, this is only supported by <a class="reference internal" href="glossary.html#term-Matplotlib"><span class="xref std std-term">Matplotlib</span></a>, as is explained
in the
<a class="reference external" href="http://matplotlib.sourceforge.net/faq/howto_faq.html#generate-images-without-having-a-window-popup">Matplotlib FAQ on image backends</a>.
Basically, you need to tell <a class="reference internal" href="glossary.html#term-Matplotlib"><span class="xref std std-term">Matplotlib</span></a> to use an “image
backend,” such as “<code class="docutils literal notranslate"><span class="pre">Agg</span></code>” or “<code class="docutils literal notranslate"><span class="pre">Cairo</span></code>.” Backends are discussed at
<a class="reference external" href="http://matplotlib.sourceforge.net/backends.html">http://matplotlib.sourceforge.net/backends.html</a>.</p>
</section>
</section>
<section id="how-do-i-make-a-movie">
<h3>How do I make a movie?<a class="headerlink" href="#how-do-i-make-a-movie" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> has no facilities for making movies. You will need to save
individual frames (see the previous question) and then stitch them together
into a movie, using one of a variety of different free, shareware, or
commercial software packages. The guidance in the
<a class="reference external" href="http://matplotlib.sourceforge.net/faq/howto_faq.html#make-a-movie">Matplotlib FAQ on movies</a>
should be adaptable to other <a class="reference internal" href="generated/fipy.viewers.viewer.html#fipy.viewers.viewer.AbstractViewer" title="fipy.viewers.viewer.AbstractViewer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Viewer</span></code></a>s.</p>
</section>
<section id="why-doesn-t-the-viewer-look-the-way-i-want">
<h3>Why doesn’t the <a class="reference internal" href="generated/fipy.viewers.viewer.html#fipy.viewers.viewer.AbstractViewer" title="fipy.viewers.viewer.AbstractViewer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Viewer</span></code></a> look the way I want?<a class="headerlink" href="#why-doesn-t-the-viewer-look-the-way-i-want" title="Permalink to this heading">¶</a></h3>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>’s viewers are utilitarian. They’re designed to let you see
<em>something</em> with a minimum of effort. Because different plotting
packages have different capabilities and some are easier to install on some
platforms than on others, we have tried to support a range of <a class="reference internal" href="glossary.html#term-Python"><span class="xref std std-term">Python</span></a>
plotters with a minimal common set of features. Many of these packages are
capable of much more, however. Often, you can invoke the
<a class="reference internal" href="generated/fipy.viewers.viewer.html#fipy.viewers.viewer.AbstractViewer" title="fipy.viewers.viewer.AbstractViewer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Viewer</span></code></a> you
want, and then issue supplemental commands for the underlying plotting
package. The better option is to make a “subclass” of the <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>
<a class="reference internal" href="generated/fipy.viewers.viewer.html#fipy.viewers.viewer.AbstractViewer" title="fipy.viewers.viewer.AbstractViewer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Viewer</span></code></a> that comes closest to producing the image you want. You can
then override just the behavior you wan to change, while letting <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> do
most of the heavy lifting. See <a class="reference internal" href="generated/examples.phase.anisotropy.html#module-examples.phase.anisotropy" title="examples.phase.anisotropy"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.anisotropy</span></code></a> and
<a class="reference internal" href="generated/examples.phase.polyxtal.html#module-examples.phase.polyxtal" title="examples.phase.polyxtal"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.polyxtal</span></code></a> for examples of creating a custom
<a class="reference internal" href="glossary.html#term-Matplotlib"><span class="xref std std-term">Matplotlib</span></a> <a class="reference internal" href="generated/fipy.viewers.viewer.html#fipy.viewers.viewer.AbstractViewer" title="fipy.viewers.viewer.AbstractViewer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Viewer</span></code></a> class; see
<a class="reference internal" href="generated/examples.cahnHilliard.sphere.html#module-examples.cahnHilliard.sphere" title="examples.cahnHilliard.sphere"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.cahnHilliard.sphere</span></code></a> for an example of creating a custom
<a class="reference internal" href="glossary.html#term-Mayavi"><span class="xref std std-term">Mayavi</span></a> <a class="reference internal" href="generated/fipy.viewers.viewer.html#fipy.viewers.viewer.AbstractViewer" title="fipy.viewers.viewer.AbstractViewer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Viewer</span></code></a> class.</p>
</section>
</section>
<section id="iterations-timesteps-and-sweeps-oh-my">
<span id="faq-iterationstimestepssweeps"></span><h2>Iterations, timesteps, and sweeps? Oh, my!<a class="headerlink" href="#iterations-timesteps-and-sweeps-oh-my" title="Permalink to this heading">¶</a></h2>
<p>Any non-linear solution of partial differential equations is an
approximation. These approximations benefit from repetitive
solution to achieve the best possible answer. In <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> (and in
many similar PDE solvers), there are three layers of repetition.</p>
<dl>
<dt>iterations</dt><dd><p>This is the lowest layer of repetition, which you’ll generally need to
spend the least time thinking about. <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> solves PDEs by
discretizing them into a set of linear equations in matrix form, as
explained in <a class="reference internal" href="numerical/discret.html#section-discretization"><span class="std std-ref">Discretization</span></a> and
<a class="reference internal" href="numerical/discret.html#section-linear-equations"><span class="std std-ref">Linear Equations</span></a>. It is not always practical, or even
possible, to exactly solve these matrix equations on a computer.
<a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> thus employs “iterative solvers”, which make successive
approximations until the linear equations have been satisfactorily
solved. <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> chooses a default number of iterations and solution
tolerance, which you will not generally need to change. If you do wish to
change these defaults, you’ll need to create a new
<a class="reference internal" href="generated/fipy.solvers.solver.html#fipy.solvers.solver.Solver" title="fipy.solvers.solver.Solver"><code class="xref py py-class docutils literal notranslate"><span class="pre">Solver</span></code></a> object with the desired number of
iterations and solution tolerance, <em>e.g.</em></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mySolver</span> <span class="o">=</span> <span class="n">LinearPCGSolver</span><span class="p">(</span><span class="n">iterations</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">5e-6</span><span class="p">)</span>
<span class="go">:</span>
<span class="go">:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eq</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="n">mySolver</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The older <a class="reference internal" href="generated/fipy.solvers.solver.html#fipy.solvers.solver.Solver" title="fipy.solvers.solver.Solver"><code class="xref py py-class docutils literal notranslate"><span class="pre">Solver</span></code></a> <code class="docutils literal notranslate"><span class="pre">steps=</span></code> keyword is now deprecated
in favor of <code class="docutils literal notranslate"><span class="pre">iterations=</span></code> to make the role clearer.</p>
</div>
<p>Solver iterations are changed from their defaults in
<a class="reference internal" href="generated/examples.flow.stokesCavity.html#module-examples.flow.stokesCavity" title="examples.flow.stokesCavity"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.flow.stokesCavity</span></code></a> and
<a class="reference internal" href="generated/examples.updating.update0_1to1_0.html#module-examples.updating.update0_1to1_0" title="examples.updating.update0_1to1_0"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.updating.update0_1to1_0</span></code></a>.</p>
</dd>
<dt>sweeps</dt><dd><p>This middle layer of repetition is important
when a PDE is non-linear (<em>e.g.</em>, a diffusivity that
depends on concentration) or when multiple PDEs are coupled
(<em>e.g.</em>, if solute diffusivity depends on temperature and
thermal conductivity depends on concentration). Even if the
<a class="reference internal" href="generated/fipy.solvers.solver.html#fipy.solvers.solver.Solver" title="fipy.solvers.solver.Solver"><code class="xref py py-class docutils literal notranslate"><span class="pre">Solver</span></code></a> solves the <em>linear</em> approximation of the
PDE to absolute perfection by performing an infinite number of
iterations, the solution may still not be a very good
representation of the actual <em>non-linear</em> PDE. If we
resolve the same equation <em>at the same point in elapsed
time</em>, but use the result of the previous solution instead of
the previous timestep, then we can get a refined solution to
the <em>non-linear</em> PDE in a process known as “sweeping.”</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Despite references to the “previous timestep,” sweeping is
not limited to time-evolving problems. Nonlinear sets of
quasi-static or steady-state PDEs can require sweeping, too.</p>
</div>
<p>We need to distinguish between the value of the variable at
the last timestep and the value of the variable at the last
sweep (the last cycle where we tried to solve the
<em>current</em> timestep). This is done by first modifying the
way the variable is created:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">myVar</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">hasOld</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>and then by explicitly moving the current value of the
variable into the “old” value only when we want to:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">myVar</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, we will need to repeatedly solve the equation until
it gives a stable result. To clearly distinguish that a
single cycle will not truly “solve” the equation, we invoke
a different method “<a class="reference internal" href="generated/fipy.terms.term.html#fipy.terms.term.Term.sweep" title="fipy.terms.term.Term.sweep"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sweep()</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sweeps</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">eq</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">myVar</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Even better than sweeping a fixed number of cycles is to do it
until the non-linear PDE has been solved satisfactorily:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="n">residual</span> <span class="o">&gt;</span> <span class="n">desiredResidual</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">residual</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">myVar</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Sweeps are used to achieve better solutions in
<a class="reference internal" href="generated/examples.diffusion.mesh1D.html#module-examples.diffusion.mesh1D" title="examples.diffusion.mesh1D"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.mesh1D</span></code></a>,
<a class="reference internal" href="generated/examples.phase.simple.html#module-examples.phase.simple" title="examples.phase.simple"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.simple</span></code></a>,
<a class="reference internal" href="generated/examples.phase.binaryCoupled.html#module-examples.phase.binaryCoupled" title="examples.phase.binaryCoupled"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.binaryCoupled</span></code></a>, and <a class="reference internal" href="generated/examples.flow.stokesCavity.html#module-examples.flow.stokesCavity" title="examples.flow.stokesCavity"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.flow.stokesCavity</span></code></a>.</p>
</dd>
<dt>timesteps</dt><dd><p>This outermost layer of repetition is of most practical interest to
the user. Understanding the time evolution of a problem is frequently
the goal of studying a particular set of PDEs. Moreover, even when
only an equilibrium or steady-state solution is desired, it may not
be possible to simply solve that directly, due to non-linear coupling
between equations or to boundary conditions or initial conditions.
Some types of PDEs have fundamental limits to how large a timestep
they can take before they become either unstable or inaccurate.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Stability and accuracy are distinctly different. An unstable
solution is often said to “blow up”, with radically
different values from point to point, often diverging to
infinity. An inaccurate solution may look perfectly
reasonable, but will disagree significantly from an
analytical solution or from a numerical solution obtained by
taking either smaller or larger timesteps.</p>
</div>
<p>For all of these reasons, you will frequently need to advance
a problem in time and to choose an appropriate interval
between solutions. This can be simple:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timeStep</span> <span class="o">=</span> <span class="mf">1.234e-5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">eq</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">myVar</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">timeStep</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>or more elaborate:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">timeStep</span> <span class="o">=</span> <span class="mf">1.234e-5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">elapsedTime</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="n">elapsedTime</span> <span class="o">&lt;</span> <span class="n">totalElapsedTime</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">eq</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">myVar</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">timeStep</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">elapsedTime</span> <span class="o">+=</span> <span class="n">timeStep</span>
<span class="gp">... </span>    <span class="n">timeStep</span> <span class="o">=</span> <span class="n">SomeFunctionOfVariablesAndTime</span><span class="p">(</span><span class="n">myVar1</span><span class="p">,</span> <span class="n">myVar2</span><span class="p">,</span> <span class="n">elapsedTime</span><span class="p">)</span>
</pre></div>
</div>
<p>A majority of the examples in this manual illustrate time evolving
behavior. Notably, boundary conditions are made a function of elapsed
time in <a class="reference internal" href="generated/examples.diffusion.mesh1D.html#module-examples.diffusion.mesh1D" title="examples.diffusion.mesh1D"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.mesh1D</span></code></a>. The timestep is
chosen based on the expected interfacial velocity in
<a class="reference internal" href="generated/examples.phase.simple.html#module-examples.phase.simple" title="examples.phase.simple"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.phase.simple</span></code></a>. The timestep is gradually
increased as the kinetics slow down in
<a class="reference internal" href="generated/examples.cahnHilliard.mesh2DCoupled.html#module-examples.cahnHilliard.mesh2DCoupled" title="examples.cahnHilliard.mesh2DCoupled"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.cahnHilliard.mesh2DCoupled</span></code></a>.</p>
</dd>
</dl>
<p>Finally, we can (and often do) combine all three layers of repetition:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">myVar</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">hasOld</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">:</span>
<span class="go">:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mySolver</span> <span class="o">=</span> <span class="n">LinearPCGSolver</span><span class="p">(</span><span class="n">iterations</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">5e-6</span><span class="p">)</span>
<span class="go">:</span>
<span class="go">:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="n">elapsedTime</span> <span class="o">&lt;</span> <span class="n">totalElapsedTime</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">myVar</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="n">residual</span> <span class="o">&gt;</span> <span class="n">desiredResidual</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">residual</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">myVar</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">timeStep</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">elapsedTime</span> <span class="o">+=</span> <span class="n">timeStep</span>
</pre></div>
</div>
</section>
<section id="why-the-distinction-between-cellvariable-and-facevariable-coefficients">
<h2>Why the distinction between <a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable" title="fipy.variables.cellVariable.CellVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">CellVariable</span></code></a> and <a class="reference internal" href="generated/fipy.variables.faceVariable.html#fipy.variables.faceVariable.FaceVariable" title="fipy.variables.faceVariable.FaceVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code></a> coefficients?<a class="headerlink" href="#why-the-distinction-between-cellvariable-and-facevariable-coefficients" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> solves field variables on the cell centers. Transient and
source terms describe the change in the value of a field at the cell
center, and so they take a
<a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable" title="fipy.variables.cellVariable.CellVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">CellVariable</span></code></a> coefficient. Diffusion
and convection terms involve fluxes <em>between</em> cell centers, and are
calculated on the face between two cells, and so they take a
<a class="reference internal" href="generated/fipy.variables.faceVariable.html#fipy.variables.faceVariable.FaceVariable" title="fipy.variables.faceVariable.FaceVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code></a> coefficient.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you supply a <a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable" title="fipy.variables.cellVariable.CellVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">CellVariable</span></code></a>
<code class="docutils literal notranslate"><span class="pre">var</span></code> when a <a class="reference internal" href="generated/fipy.variables.faceVariable.html#fipy.variables.faceVariable.FaceVariable" title="fipy.variables.faceVariable.FaceVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code></a>
is expected, <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> will automatically substitute
<code class="docutils literal notranslate"><span class="pre">var.</span></code><a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable.arithmeticFaceValue" title="fipy.variables.cellVariable.CellVariable.arithmeticFaceValue"><code class="xref py py-attr docutils literal notranslate"><span class="pre">arithmeticFaceValue</span></code></a>.
This can have undesirable consequences, however. For one thing, the
arithmetic face average of a non-linear function is not the same as the
same non-linear function of the average argument, <em>e.g.</em>, for
<span class="math notranslate nohighlight">\(f(x) = x^2\)</span>,</p>
<div class="math notranslate nohighlight">
\[f(\frac{1+2}{2}) = \frac{9}{4} \neq
\frac{f(1) + f(2)}{2} = \frac{5}{2}\]</div>
<p>This distinction is not generally important for smoothly
varying functions, but can dramatically affect the solution
when sharp changes are present.  Also, for many problems, such
as a conserved concentration field that cannot be allowed to
drop below zero, a harmonic average is more appropriate than
an arithmetic average.</p>
<p>If you experience problems (unstable or wrong results, or
excessively small timesteps), you may need to explicitly supply the
desired <a class="reference internal" href="generated/fipy.variables.faceVariable.html#fipy.variables.faceVariable.FaceVariable" title="fipy.variables.faceVariable.FaceVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code></a> rather than letting <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>
assume one.</p>
</div>
</section>
<section id="how-do-i-represent-boundary-conditions">
<h2>How do I represent boundary conditions?<a class="headerlink" href="#how-do-i-represent-boundary-conditions" title="Permalink to this heading">¶</a></h2>
<p>See the <a class="reference internal" href="USAGE.html#boundaryconditions"><span class="std std-ref">Boundary Conditions</span></a> section for more details.</p>
</section>
<section id="what-does-this-error-message-mean">
<h2>What does this error message mean?<a class="headerlink" href="#what-does-this-error-message-mean" title="Permalink to this heading">¶</a></h2>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">ValueError:</span> <span class="pre">frames</span> <span class="pre">are</span> <span class="pre">not</span> <span class="pre">aligned</span></code></dt><dd><p>This error most likely means that you have provided a
<a class="reference internal" href="generated/fipy.variables.cellVariable.html#fipy.variables.cellVariable.CellVariable" title="fipy.variables.cellVariable.CellVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">CellVariable</span></code></a> when <a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>
was expecting a <a class="reference internal" href="generated/fipy.variables.faceVariable.html#fipy.variables.faceVariable.FaceVariable" title="fipy.variables.faceVariable.FaceVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code></a>
(or vice versa).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">MA.MA.MAError:</span> <span class="pre">Cannot</span> <span class="pre">automatically</span> <span class="pre">convert</span> <span class="pre">masked</span> <span class="pre">array</span> <span class="pre">to</span> <span class="pre">Numeric</span> <span class="pre">because</span> <span class="pre">data</span> <span class="pre">is</span> <span class="pre">masked</span> <span class="pre">in</span> <span class="pre">one</span> <span class="pre">or</span> <span class="pre">more</span> <span class="pre">locations.</span></code></dt><dd><p>This not-so-helpful error message could mean a number of things, but
the most likely explanation is that the solution has become unstable
and is diverging to <span class="math notranslate nohighlight">\(\pm\infty\)</span>. This can be caused by taking
too large a timestep or by using explicit terms instead of implicit
ones.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repairing</span> <span class="pre">catalog</span> <span class="pre">by</span> <span class="pre">removing</span> <span class="pre">key</span></code></dt><dd><p>This message (not really an error, but may cause test failures) can
result when using the <code class="xref py py-mod docutils literal notranslate"><span class="pre">weave</span></code> package via the
<a class="reference internal" href="USAGE.html#cmdoption-inline"><code class="xref std std-option docutils literal notranslate"><span class="pre">--inline</span></code></a> flag. It is due to a bug in <a class="reference internal" href="glossary.html#term-SciPy"><span class="xref std std-term">SciPy</span></a> that has been
patched in their source repository:
<a class="reference external" href="http://www.scipy.org/mailinglists/mailman?fn=scipy-dev/2005-June/003010.html">http://www.scipy.org/mailinglists/mailman?fn=scipy-dev/2005-June/003010.html</a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">numerix</span> <span class="pre">Numeric</span> <span class="pre">23.6</span></code></dt><dd><p>This is neither an error nor a warning. It’s just a sloppy
message left in <a class="reference internal" href="glossary.html#term-SciPy"><span class="xref std std-term">SciPy</span></a>:
<a class="reference external" href="http://thread.gmane.org/gmane.comp.python.scientific.user/4349">http://thread.gmane.org/gmane.comp.python.scientific.user/4349</a>.</p>
</dd>
</dl>
</section>
<section id="how-do-i-change-fipy-s-default-behavior">
<span id="faq-flagsandenvironmentvariables"></span><h2>How do I change FiPy’s default behavior?<a class="headerlink" href="#how-do-i-change-fipy-s-default-behavior" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> tries to make reasonable choices, based on what packages
it finds installed, but there may be times that you wish to override
these behaviors.  See the <a class="reference internal" href="USAGE.html#flagsandenvironmentvariables"><span class="std std-ref">Command-line Flags and Environment Variables</span></a> section
for more details.</p>
</section>
<section id="how-can-i-tell-if-i-m-running-in-parallel">
<h2>How can I tell if I’m running in parallel?<a class="headerlink" href="#how-can-i-tell-if-i-m-running-in-parallel" title="Permalink to this heading">¶</a></h2>
<p>See <a class="reference internal" href="USAGE.html#parallel"><span class="std std-ref">Solving in Parallel</span></a>.</p>
</section>
<section id="why-don-t-my-scripts-work-anymore">
<h2>Why don’t my scripts work anymore?<a class="headerlink" href="#why-don-t-my-scripts-work-anymore" title="Permalink to this heading">¶</a></h2>
<p><a class="reference internal" href="glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> has experienced three major API changes. The steps
necessary to upgrade older scripts are discussed in
<a class="reference internal" href="EXAMPLES.html#sec-updatefipy"><span class="std std-ref">Updating FiPy</span></a>.</p>
</section>
<section id="what-if-my-question-isn-t-answered-here">
<h2>What if my question isn’t answered here?<a class="headerlink" href="#what-if-my-question-isn-t-answered-here" title="Permalink to this heading">¶</a></h2>
<p>Please post your question to the
mailing list &lt;<a class="reference external" href="http://www.ctcms.nist.gov/fipy/mail.html">http://www.ctcms.nist.gov/fipy/mail.html</a>&gt;
or file an issue at &lt;<a class="reference external" href="https://github.com/usnistgov/fipy/issues/new">https://github.com/usnistgov/fipy/issues/new</a>&gt;.</p>
</section>
</section>


                <div class='last-updated'>
                Last updated on May 22, 2025.
                Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.1.2.
                </div>
              </div>
  </div>  
  <aside class="nist-page__region nist-page__region--sidebar-second tablet-lg:grid-col-4">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

<strong>FiPy: A Finite Volume PDE Solver Using Python</strong><br />
Version 3.4.5+26.g5d720626d

  <div class="sphinxsidebarsection">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Frequently Asked Questions</a><ul>
<li><a class="reference internal" href="#how-do-i-represent-an-equation-in-fipy">How do I represent an equation in FiPy?</a><ul>
<li><a class="reference internal" href="#is-there-a-way-to-model-an-anisotropic-diffusion-process-or-more-generally-to-represent-the-diffusion-coefficient-as-a-tensor-so-that-the-diffusion-term-takes-the-form-partial-i-gamma-ij-partial-j-phi">Is there a way to model an anisotropic diffusion process or more generally to represent the diffusion coefficient as a tensor so that the diffusion term takes the form <span class="math notranslate nohighlight">\(\partial_i \Gamma_{ij}\partial_j \phi\)</span>?</a></li>
<li><a class="reference internal" href="#how-do-i-represent-a-term-that-doesn-t-involve-the-dependent-variable">How do I represent a <cite>…</cite> term that <em>doesn’t</em> involve the dependent variable?</a><ul>
<li><a class="reference internal" href="#how-do-i-represent-a-diffusive-source">How do I represent a diffusive source?</a></li>
<li><a class="reference internal" href="#how-do-i-represent-a-convective-source">How do I represent a convective source?</a></li>
<li><a class="reference internal" href="#how-do-i-represent-a-transient-source">How do I represent a transient source?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-if-my-term-involves-the-dependent-variable-but-not-where-fipy-puts-it">What if my term involves the dependent variable, but not where FiPy puts it?</a></li>
<li><a class="reference internal" href="#what-if-the-coefficient-of-a-term-depends-on-the-variable-that-i-m-solving-for">What if the coefficient of a term depends on the variable that I’m solving for?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-can-i-see-what-i-m-doing">How can I see what I’m doing?</a><ul>
<li><a class="reference internal" href="#how-do-i-export-data">How do I export data?</a></li>
<li><a class="reference internal" href="#how-do-i-save-a-plot-image">How do I save a plot image?</a><ul>
<li><a class="reference internal" href="#what-if-i-only-want-the-saved-file-with-no-display-on-screen">What if I only want the saved file, with no display on screen?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-do-i-make-a-movie">How do I make a movie?</a></li>
<li><a class="reference internal" href="#why-doesn-t-the-viewer-look-the-way-i-want">Why doesn’t the <code class="xref py py-class docutils literal notranslate"><span class="pre">Viewer</span></code> look the way I want?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iterations-timesteps-and-sweeps-oh-my">Iterations, timesteps, and sweeps? Oh, my!</a></li>
<li><a class="reference internal" href="#why-the-distinction-between-cellvariable-and-facevariable-coefficients">Why the distinction between <code class="xref py py-class docutils literal notranslate"><span class="pre">CellVariable</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code> coefficients?</a></li>
<li><a class="reference internal" href="#how-do-i-represent-boundary-conditions">How do I represent boundary conditions?</a></li>
<li><a class="reference internal" href="#what-does-this-error-message-mean">What does this error message mean?</a></li>
<li><a class="reference internal" href="#how-do-i-change-fipy-s-default-behavior">How do I change FiPy’s default behavior?</a></li>
<li><a class="reference internal" href="#how-can-i-tell-if-i-m-running-in-parallel">How can I tell if I’m running in parallel?</a></li>
<li><a class="reference internal" href="#why-don-t-my-scripts-work-anymore">Why don’t my scripts work anymore?</a></li>
<li><a class="reference internal" href="#what-if-my-question-isn-t-answered-here">What if my question isn’t answered here?</a></li>
</ul>
</li>
</ul>

  </div>
<div class="sphinxsidebarsection">
  <h4>Previous topic</h4>
  <p class="topless"><a href="USAGE.html"
                        title="previous chapter">Using FiPy</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="EFFICIENCY.html"
                        title="next chapter">Efficiency</a></p>
</div>
  <div class="sphinxsidebarsection">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/FAQ.rst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  </div>
<div class="sphinxsidebarsection">
<div id="searchbox" style="display: none" role="search">
  <div data-layout-content-preview-placeholder-label="&quot;Sphinx
  Search&quot; field" class="nist-block nist-block--search">
  <h2 id="searchlabel">Quick search</h2>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
  </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
</div>
<div class="sphinxsidebarsection" id="contact-wrapper">
  
        <div data-layout-content-preview-placeholder-label="&quot;Related
        organization tree&quot; views block" class="nist-block nist-block--org">
          
          <h2 class="nist-block__title">Organizations</h2>
              
              <div class="views-element-container"><div
              class="js-view-dom-id-70b0923f677edbe3dda361030ef8dc373cd0ca94065c39cfd81338de767f1019">

            <div class="nist-related-orgs"><div class="term-tree-list"><ul
            class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters" hreflang="en">NIST
            Headquarters</a><ul class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs"
            hreflang="en">Laboratory Programs</a><ul class="term"><li
            class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs/material-measurement-laboratory"
            hreflang="en">Material Measurement Laboratory</a>
			<ul
			class="term"><li
			class="selected"><a href="https://www.nist.gov/mml/msed"
			hreflang="en">Materials Science and Engineering
			Division</a></li><li
			class="selected"><a href="https://www.nist.gov/mml/ctcms"
			hreflang="en">Center for Theoretical and
			              Computational Materials Science</a></li></ul>
                          </li></ul></li></ul></li></ul></div></div>
          <div class="nist-related-orgs"></div>
          <div class="nist-related-orgs"></div>



        </div>
        </div>

          </div>


          <div data-layout-content-preview-placeholder-label="&quot;NIST
          Staff&quot; field" class="nist-block nist-block--contact">

          <h2 class="nist-block__title">NIST Staff</h2>

                  <div class="nist-field nist-field--label-hidden
                  nist-field--link-list entity-reference nist-field__items
                  nist-field--no-margin">
                            <div class="nist-field__item
                            nist-field--no-margin"><a
                            href="https://www.nist.gov/people/jonathan-e-guyer"
                            hreflang="en">Jonathan E. Guyer</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/daniel-wheeler"
                                hreflang="en">Daniel Wheeler</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/james-warren"
                                hreflang="en">James A. Warren</a></div>
                  </div>


          </div>

          <div data-layout-content-preview-placeholder-label="&quot;Contact&quot; field"
          class="nist-block nist-block--contact nist-block--mail">

          <h2 class="nist-block__title">
          <a class="" href="docs/source/CONTACT.html" style="">Contact</a>
          </h2>

          </div>

</div>
        </div>
      </div>
      <div class="clearer"></div>
  </aside>
        </div>
      </div>

      <div class="panel-region--postface">
      <div class="inner region-inner inside">
        
<div class="pane pane--nist-node-date-pane" >

    </div>
      </div>
    </div>

        </section>
        </div>
      </div>

      </div>  
    </div>          

    </div>

  </div>

</div>


  


  <!-- Taken from https://www.filamentgroup.com/lab/html-includes/#another-demo%3A-including-another-html-file -->
  <iframe src="_static/ntd2d_menu.html" onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()"></iframe>
    </div>
  </body>
</html>