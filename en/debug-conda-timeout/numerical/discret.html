
<!DOCTYPE html>


<!--[if IEMobile 7]><html class="iem7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if lte IE 6]><html class="lt-ie9 lt-ie8 lt-ie7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (IE 7)&(!IEMobile)]><html class="lt-ie9 lt-ie8 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if IE 8]><html class="lt-ie9 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)]><!--><html class="no-js"  lang="en" dir="ltr" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# book: http://ogp.me/ns/book# profile: http://ogp.me/ns/profile# video: http://ogp.me/ns/video# product: http://ogp.me/ns/product# content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"><!--<![endif]-->

  <head>
<meta charset="utf-8" />
<link rel="shortcut icon" href="https://www.nist.gov/sites/all/themes/nist_style/favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/x-mathjax-config">MathJax.Hub.Config({
  extensions: ['tex2jax.js'],
  jax: ['input/TeX','output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$$','$$'], ['\\(','\\)'] ],
    processEscapes: true,
    processClass: 'tex2jax',
    ignoreClass: 'html'
  },
  showProcessingMessages: false,
  messageStyle: 'none'
});
</script>
<meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">

      <!--[if lt IE 9]>
    <script src="https://www.nist.gov/sites/all/themes/zen/js/html5-respond.js"></script>
    <![endif]-->
    <!--[if (gte IE 6)&(lte IE 8)]>
  <script type="text/javascript" src="https://www.nist.gov/sites/all/themes/nist_style/js/selectivizr-min.js"></script>
  <![endif]--><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Finite Volume Method &#8212; FiPy 3.4.5+28.g44ba2a228 documentation</title>
    <link rel="stylesheet" href="../_static/ntd2d.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/ntd2d.css?v=de7af573" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=9f3ae26b"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://pages.nist.gov/fipy/en/latest/numerical/discret.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="FiPy 3.4.5+28.g44ba2a228 documentation" href="../contents.html" />
    <link rel="up" title="Theoretical and Numerical Background" href="index.html" />
    <link rel="next" title="Numerical Schemes" href="scheme.html" />
    <link rel="prev" title="General Conservation Equation" href="equation.html" />
  
 


  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-3.6.2.min.js" type="text/javascript" defer="defer"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


  </head>
<!--  <body role="document">-->
  <body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-414011 node-type-software hide-breadcrumb section-services-resources page-panels is-panel" role="document">
      <div id="page" class="mini-header">



    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="scheme.html" title="Numerical Schemes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="equation.html" title="General Conservation Equation"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html"><img src="../_static/fipy.png" alt="FiPy logo"
                 style="vertical-align: middle; margin-top: -1px"/>
        FiPy</a> &gt;</li>

          <li class="nav-item nav-item-1"><a href="../introduction.html" >Introduction</a> &gt;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Theoretical and Numerical Background</a> &gt;</li> 
      </ul>
    </div>

  <div id="main" class="clearfix" role="main" tabindex="-1">
    <div class="main__inner">
      <div class="page-info">
        <a id="main-content"></a>
      </div>

      <div class="document">
        <div class="documentwrapper">

      <div id="content" class="column">
      <div id="block-nist-www-content" class="nist-block">
        <section class="nist-page__content usa-section clearfix">

         

        <div class="grid-container margin-top-4">
        <div class="grid-row grid-gap-6">

  <div class="nist-page__region nist-page__region--content tablet-lg:grid-col-8">
              <div class="body" role="main">
		
  <section id="finite-volume-method">
<h1>Finite Volume Method<a class="headerlink" href="#finite-volume-method" title="Permalink to this heading">¶</a></h1>
<p>To use the FVM, the solution domain must first be divided into
non-overlapping polyhedral elements or cells.  A solution domain
divided in such a way is generally known as a mesh (as we will see, a
<a class="reference internal" href="../generated/fipy.meshes.mesh.html#fipy.meshes.mesh.Mesh" title="fipy.meshes.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> is also a <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> object).  A mesh consists of vertices,
faces and cells (see Figure <a class="reference internal" href="#fig-meshcartoon"><span class="std std-ref">Mesh</span></a>).  In the FVM the
variables of interest are averaged over control volumes (CVs).  The
CVs are either defined by the cells or are centered on the vertices.</p>
<figure class="align-center" id="id2">
<span id="fig-meshcartoon"></span><a class="reference internal image-reference" href="../_images/meshcartoon.png"><img alt="../_images/meshcartoon.png" src="../_images/meshcartoon.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">Mesh</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
<div class="legend">
<p>A mesh consists of cells, faces and vertices. For the purposes of
<a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a>, the divider between two cells is known as a face for all
dimensions.</p>
</div>
</figcaption>
</figure>
<section id="cell-centered-fvm-cc-fvm">
<h2>Cell Centered FVM (CC-FVM)<a class="headerlink" href="#cell-centered-fvm-cc-fvm" title="Permalink to this heading">¶</a></h2>
<p>In the CC-FVM the CVs are formed by the mesh cells with the cell
center “storing” the average variable value in the CV, (see
Figure <a class="reference internal" href="#fig-vc-cc-fv"><span class="std std-ref">CV structure for an unstructured mesh</span></a>). The face fluxes are approximated using the
variable values in the two adjacent cells surrounding the face. This
low order approximation has the advantage of being efficient and
requiring matrices of low band width (the band width is equal to the
number of cell neighbors plus one) and thus low storage
requirement. However, the mesh topology is restricted due to
orthogonality and conjunctionality requirements. The value at a face is
assumed to be the average value over the face. On an unstructured mesh
the face center may not lie on the line joining the CV centers, which
will lead to an error in the face interpolation. <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> currently
only uses the CC-FVM.</p>
<section id="boundary-conditions">
<h3>Boundary Conditions<a class="headerlink" href="#boundary-conditions" title="Permalink to this heading">¶</a></h3>
<p>The natural boundary condition for CC-FVM is no-flux.  For <a class="reference internal" href="equation.html#equation-num-gen">(2)</a>,
the boundary condition is</p>
<div class="math notranslate nohighlight">
\[\hat{n}\cdot[\vec{u}\phi - (\Gamma_i\nabla)^n] = 0\]</div>
</section>
</section>
<section id="vertex-centered-fvm-vc-fvm">
<h2>Vertex Centered FVM (VC-FVM)<a class="headerlink" href="#vertex-centered-fvm-vc-fvm" title="Permalink to this heading">¶</a></h2>
<p>In the VC-FVM, the CV is centered around the vertices and the cells
are divided into sub-control volumes that make up the main CVs (see
Figure <a class="reference internal" href="#fig-vc-cc-fv"><span class="std std-ref">CV structure for an unstructured mesh</span></a>). The vertices “store” the average
variable values over the CVs. The CV faces are constructed within the
cells rather than using the cell faces as in the CC-FVM. The face
fluxes use all the vertex values from the cell where the face is
located to calculate interpolations. For this reason, the VC-FVM is
less efficient and requires more storage (a larger matrix band width)
than the CC-FVM. However, the mesh topology does not have the same
restrictions as the CC-FVM. <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> does not have a VC-FVM capability.</p>
<figure class="align-center" id="id3">
<span id="fig-vc-cc-fv"></span><a class="reference internal image-reference" href="../_images/vc-cc-fv.png"><img alt="../_images/vc-cc-fv.png" src="../_images/vc-cc-fv.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-text">CV structure for an unstructured mesh</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
<div class="legend">
<p>(a) <span class="math notranslate nohighlight">\(\Omega_a\)</span> represents a vertex-based CV and (b)
<span class="math notranslate nohighlight">\(\Omega_1\)</span>, <span class="math notranslate nohighlight">\(\Omega_2\)</span>, <span class="math notranslate nohighlight">\(\Omega_3\)</span> and
<span class="math notranslate nohighlight">\(\Omega_4\)</span> represent cell centered CVs.</p>
</div>
</figcaption>
</figure>
</section>
</section>
<section id="discretization">
<span id="section-discretization"></span><h1>Discretization<a class="headerlink" href="#discretization" title="Permalink to this heading">¶</a></h1>
<p>The first step in the discretization of Equation <a class="reference internal" href="equation.html#equation-num-gen">(2)</a>
using the CC-FVM is to integrate over a CV and then make appropriate
approximations for fluxes across the boundary of each CV.  In this
section, each term in Equation <a class="reference internal" href="equation.html#equation-num-gen">(2)</a> will be examined
separately.</p>
<section id="transient-term-partial-rho-phi-partial-t">
<h2>Transient Term <span class="math notranslate nohighlight">\(\partial (\rho \phi) / \partial t\)</span><a class="headerlink" href="#transient-term-partial-rho-phi-partial-t" title="Permalink to this heading">¶</a></h2>
<p>For the transient term, the discretization of the integral <span class="math notranslate nohighlight">\(\int_V\)</span> over the volume of a CV is given by</p>
<div class="math notranslate nohighlight" id="equation-num-tra">
<span class="eqno">(1)<a class="headerlink" href="#equation-num-tra" title="Permalink to this equation">¶</a></span>\[\int_V \frac{\partial (\rho \phi)}{\partial t} dV
\simeq
\frac{(\rho_{P} \phi_{P} - \rho_{P}^\text{old} \phi_{P}^\text{old}) V_P}{\Delta t}\]</div>
<p>where <span class="math notranslate nohighlight">\(\phi_P\)</span> represents the average value of <span class="math notranslate nohighlight">\(\phi\)</span> in a CV
centered on a point <span class="math notranslate nohighlight">\(P\)</span> and the superscript “<span class="math notranslate nohighlight">\(\text{old}\)</span>”
represents the previous time-step value.  The value <span class="math notranslate nohighlight">\(V_P\)</span> is the
volume of the CV and <span class="math notranslate nohighlight">\(\Delta t\)</span> is the time step size.</p>
<p>This term is represented in <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">TransientTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">rho</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="convection-term-nabla-cdot-left-vec-u-phi-right">
<h2>Convection Term <span class="math notranslate nohighlight">\(\nabla \cdot \left( \vec{u} \phi \right)\)</span><a class="headerlink" href="#convection-term-nabla-cdot-left-vec-u-phi-right" title="Permalink to this heading">¶</a></h2>
<p>The discretization for the convection term is given by</p>
<div class="math notranslate nohighlight" id="equation-num-con">
<span class="eqno">(2)<a class="headerlink" href="#equation-num-con" title="Permalink to this equation">¶</a></span>\[\begin{split}\int_V \nabla \cdot (\vec{u} \phi)\,dV &amp;=
\int_S (\vec{n} \cdot \vec{u})\phi\,dS \\
&amp;\simeq \sum_{f} (\vec{n} \cdot \vec{u})_f \phi_f A_f\end{split}\]</div>
<p>where we have used the divergence theorem to transform the integral
over the CV volume <span class="math notranslate nohighlight">\(\int_V\)</span> into an integral over the CV surface
<span class="math notranslate nohighlight">\(\int_S\)</span>.  The summation over the faces of a CV is denoted by
<span class="math notranslate nohighlight">\(\sum_{f}\)</span> and <span class="math notranslate nohighlight">\(A_f\)</span> is the area of each face.  The vector <span class="math notranslate nohighlight">\(\vec{n}\)</span>
is the normal to the face pointing out of the CV into an adjacent CV
centered on point <span class="math notranslate nohighlight">\(A\)</span>.  When using a first order approximation,
the value of <span class="math notranslate nohighlight">\(\phi_f\)</span> must depend on the average value in adjacent
cell <span class="math notranslate nohighlight">\(\phi_A\)</span> and the average value in the cell of interest <span class="math notranslate nohighlight">\(\phi_P\)</span>,
such that</p>
<div class="math notranslate nohighlight">
\[\phi_f=\alpha_f \phi_P +(1-\alpha_f)\phi_A.\]</div>
<p>The weighting factor <span class="math notranslate nohighlight">\(\alpha_f\)</span> is determined by the convection
scheme, described in <a class="reference internal" href="scheme.html#sec-numericalschemes"><span class="std std-ref">Numerical Schemes</span></a>.</p>
<p>This term is represented in <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">&lt;</span><span class="n">SpecificConvectionTerm</span><span class="o">&gt;</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">u</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="samp docutils literal notranslate"><em><span class="pre">&lt;SpecificConvectionTerm&gt;</span></em></code> can be any of
<a class="reference internal" href="../generated/fipy.terms.centralDiffConvectionTerm.html#fipy.terms.centralDiffConvectionTerm.CentralDifferenceConvectionTerm" title="fipy.terms.centralDiffConvectionTerm.CentralDifferenceConvectionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">CentralDifferenceConvectionTerm</span></code></a>,
<a class="reference internal" href="../generated/fipy.terms.exponentialConvectionTerm.html#fipy.terms.exponentialConvectionTerm.ExponentialConvectionTerm" title="fipy.terms.exponentialConvectionTerm.ExponentialConvectionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExponentialConvectionTerm</span></code></a>,
<a class="reference internal" href="../generated/fipy.terms.hybridConvectionTerm.html#fipy.terms.hybridConvectionTerm.HybridConvectionTerm" title="fipy.terms.hybridConvectionTerm.HybridConvectionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">HybridConvectionTerm</span></code></a>,
<a class="reference internal" href="../generated/fipy.terms.powerLawConvectionTerm.html#fipy.terms.powerLawConvectionTerm.PowerLawConvectionTerm" title="fipy.terms.powerLawConvectionTerm.PowerLawConvectionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">PowerLawConvectionTerm</span></code></a>,
<a class="reference internal" href="../generated/fipy.terms.upwindConvectionTerm.html#fipy.terms.upwindConvectionTerm.UpwindConvectionTerm" title="fipy.terms.upwindConvectionTerm.UpwindConvectionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">UpwindConvectionTerm</span></code></a>,
<a class="reference internal" href="../generated/fipy.terms.explicitUpwindConvectionTerm.html#fipy.terms.explicitUpwindConvectionTerm.ExplicitUpwindConvectionTerm" title="fipy.terms.explicitUpwindConvectionTerm.ExplicitUpwindConvectionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExplicitUpwindConvectionTerm</span></code></a>, or
<a class="reference internal" href="../generated/fipy.terms.vanLeerConvectionTerm.html#fipy.terms.vanLeerConvectionTerm.VanLeerConvectionTerm" title="fipy.terms.vanLeerConvectionTerm.VanLeerConvectionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">VanLeerConvectionTerm</span></code></a>.
The differences between these convection schemes are described
in Section <a class="reference internal" href="scheme.html#sec-numericalschemes"><span class="std std-ref">Numerical Schemes</span></a>. The velocity coefficient
<code class="docutils literal notranslate"><span class="pre">u</span></code> must be a rank-1 <a class="reference internal" href="../generated/fipy.variables.faceVariable.html#fipy.variables.faceVariable.FaceVariable" title="fipy.variables.faceVariable.FaceVariable"><code class="xref py py-class docutils literal notranslate"><span class="pre">FaceVariable</span></code></a>, or a
constant vector in the form of a <a class="reference internal" href="../glossary.html#term-Python"><span class="xref std std-term">Python</span></a> list or
tuple, <em>e.g.</em> <code class="docutils literal notranslate"><span class="pre">((1,),</span> <span class="pre">(2,))</span></code> for a vector in 2D.</p>
</section>
<section id="diffusion-term-nabla-cdot-left-gamma-1-nabla-phi-right">
<h2>Diffusion Term <span class="math notranslate nohighlight">\(\nabla \cdot \left( \Gamma_1 \nabla \phi \right)\)</span><a class="headerlink" href="#diffusion-term-nabla-cdot-left-gamma-1-nabla-phi-right" title="Permalink to this heading">¶</a></h2>
<p>The discretization for the diffusion term is given by</p>
<div class="math notranslate nohighlight" id="equation-num-dif">
<span class="eqno">(3)<a class="headerlink" href="#equation-num-dif" title="Permalink to this equation">¶</a></span>\[\begin{split}\int_V \nabla \cdot (\Gamma\nabla\{\ldots\}) dV
&amp;= \int_S \Gamma (\vec{n} \cdot \nabla\{\ldots\}) dS \\
&amp;\simeq \sum_f \Gamma_f (\vec{n} \cdot \nabla\{\ldots\})_f A_f\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(\{\ldots\}\)</span> indicates recursive application of the specified
operation on <span class="math notranslate nohighlight">\(\phi\)</span>, depending on
the order of the diffusion term.
The estimation for the flux, <span class="math notranslate nohighlight">\((\vec{n} \cdot \nabla\{\ldots\})_f\)</span>, is
obtained via</p>
<div class="math notranslate nohighlight">
\[(\vec{n} \cdot \nabla\{\ldots\})_f \simeq \frac{\{\ldots\}_A-\{\ldots\}_P}{d_{AP}}\]</div>
<p>where the value of <span class="math notranslate nohighlight">\(d_{AP}\)</span> is the distance between neighboring cell
centers.  This estimate relies on the orthogonality of the mesh, and
becomes increasingly inaccurate as the non-orthogonality increases.
Correction terms have been derived to improve this error but are not
currently included in <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> <span id="id1">[<a class="reference internal" href="../references.html#id5" title="T. N. Croft. Unstructured Mesh - Finite Volume Algorithms for Swirling, Turbulent Reacting Flows. PhD thesis, University of Greenwich, 1998. URL: http://gala.gre.ac.uk/id/eprint/6371/.">14</a>]</span>.</p>
<p>This term is represented in <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">Gamma1</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ExplicitDiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">Gamma1</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="../generated/fipy.terms.explicitDiffusionTerm.html#fipy.terms.explicitDiffusionTerm.ExplicitDiffusionTerm" title="fipy.terms.explicitDiffusionTerm.ExplicitDiffusionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExplicitDiffusionTerm</span></code></a> is provided primarily for
illustrative purposes, although <a class="reference internal" href="../generated/examples.diffusion.mesh1D.html#module-examples.diffusion.mesh1D" title="examples.diffusion.mesh1D"><code class="xref py py-mod docutils literal notranslate"><span class="pre">examples.diffusion.mesh1D</span></code></a>
demonstrates its use in Crank-Nicolson time stepping.
<a class="reference internal" href="../generated/fipy.terms.implicitDiffusionTerm.html#fipy.terms.implicitDiffusionTerm.ImplicitDiffusionTerm" title="fipy.terms.implicitDiffusionTerm.ImplicitDiffusionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImplicitDiffusionTerm</span></code></a> is almost always
preferred (<a class="reference internal" href="../generated/fipy.terms.diffusionTerm.html#fipy.terms.diffusionTerm.DiffusionTerm" title="fipy.terms.diffusionTerm.DiffusionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiffusionTerm</span></code></a> is a synonym for
<a class="reference internal" href="../generated/fipy.terms.implicitDiffusionTerm.html#fipy.terms.implicitDiffusionTerm.ImplicitDiffusionTerm" title="fipy.terms.implicitDiffusionTerm.ImplicitDiffusionTerm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ImplicitDiffusionTerm</span></code></a> to reinforce this
preference). One can also create an explicit diffusion term with</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">Gamma1</span> <span class="o">*</span> <span class="n">phi</span><span class="o">.</span><span class="n">faceGrad</span><span class="p">)</span><span class="o">.</span><span class="n">divergence</span>
</pre></div>
</div>
<section id="higher-order-diffusion">
<span id="discret-higherorderdiffusion"></span><h3>Higher Order Diffusion<a class="headerlink" href="#higher-order-diffusion" title="Permalink to this heading">¶</a></h3>
<p>Higher order diffusion expressions, such as <span class="math notranslate nohighlight">\(\nabla^4 \phi\)</span> or
<span class="math notranslate nohighlight">\(\nabla \cdot \left( \Gamma_1 \nabla \left( \nabla\cdot\left(
\Gamma_2 \nabla \phi\right) \right) \right)\)</span> for  Cahn-Hilliard are
represented as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="p">(</span><span class="n">Gamma1</span><span class="p">,</span> <span class="n">Gamma2</span><span class="p">))</span>
</pre></div>
</div>
<p>The number of elements supplied for <code class="docutils literal notranslate"><span class="pre">coeff</span></code> determines the
order of the term.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While this multiple-coefficient form is still supported,
<a class="reference internal" href="../USAGE.html#coupledequations"><span class="std std-ref">Coupled and Vector Equations</span></a> are the recommended approach for higher order
expressions.</p>
</div>
</section>
</section>
<section id="source-term">
<h2>Source Term<a class="headerlink" href="#source-term" title="Permalink to this heading">¶</a></h2>
<p>Any term that cannot be written in one of the previous forms is considered
a source <span class="math notranslate nohighlight">\(S_{\phi}\)</span>. The discretization for the source term is given
by,</p>
<div class="math notranslate nohighlight" id="equation-num-sou">
<span class="eqno">(4)<a class="headerlink" href="#equation-num-sou" title="Permalink to this equation">¶</a></span>\[\int_V S_{\phi}\,dV \simeq S_\phi V_P.\]</div>
<p>Including any negative dependence of <span class="math notranslate nohighlight">\(S_\phi\)</span> on <span class="math notranslate nohighlight">\(\phi\)</span> increases
solution stability. The dependence can only be included in a linear
manner so Equation <a class="reference internal" href="#equation-num-sou">(4)</a> becomes</p>
<div class="math notranslate nohighlight">
\[V_P (S_0 + S_1 \phi_P),\]</div>
<p>where <span class="math notranslate nohighlight">\(S_0\)</span> is the source which is independent of <span class="math notranslate nohighlight">\(\phi\)</span> and
<span class="math notranslate nohighlight">\(S_1\)</span> is the coefficient of the source which is linearly dependent
on <span class="math notranslate nohighlight">\(\phi\)</span>.</p>
<p>A source term is represented in <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> essentially as it appears in
mathematical form, <em>e.g.</em>, <span class="math notranslate nohighlight">\(3\kappa^2 + b \sin
\theta\)</span> would be written</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="mi">3</span> <span class="o">*</span> <span class="n">kappa</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">numerix</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functions like <code class="xref py py-func docutils literal notranslate"><span class="pre">sin()</span></code> can be obtained from the
<a class="reference internal" href="../generated/fipy.tools.numerix.html#module-fipy.tools.numerix" title="fipy.tools.numerix"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fipy.tools.numerix</span></code></a> module.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Generally, things will not work as expected if the equivalent
function is used from the <a class="reference internal" href="../glossary.html#term-NumPy"><span class="xref std std-term">NumPy</span></a> or <a class="reference internal" href="../glossary.html#term-SciPy"><span class="xref std std-term">SciPy</span></a> library.</p>
</div>
</div>
<p>If, however, the source depends on the variable that is being solved for,
it can be advantageous to linearize the source and cast part of it as an
implicit source term, <em>e.g.</em>, <span class="math notranslate nohighlight">\(3\kappa^2 + \phi \sin \theta\)</span>
might be written as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="mi">3</span> <span class="o">*</span> <span class="n">kappa</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="linear-equations">
<span id="section-linear-equations"></span><h1>Linear Equations<a class="headerlink" href="#linear-equations" title="Permalink to this heading">¶</a></h1>
<p>The aim of the discretization is to reduce the continuous general
equation to a set of discrete linear equations that can then be solved
to obtain the value of the dependent variable at each CV center. This
results in a sparse linear system that requires an efficient iterative
scheme to solve. The iterative schemes available to <a class="reference internal" href="../glossary.html#term-FiPy"><span class="xref std std-term">FiPy</span></a> are
currently encapsulated in the <a class="reference internal" href="../glossary.html#term-Pysparse"><span class="xref std std-term">Pysparse</span></a> and <a class="reference internal" href="../glossary.html#term-PyTrilinos"><span class="xref std std-term">PyTrilinos</span></a>
suites of solvers and include most common solvers such as the conjugate
gradient method and LU decomposition.</p>
<p>Combining Equations <a class="reference internal" href="#equation-num-tra">(1)</a>, <a class="reference internal" href="#equation-num-con">(2)</a>,
<a class="reference internal" href="#equation-num-dif">(3)</a> and <a class="reference internal" href="#equation-num-sou">(4)</a>, the complete
discretization for equation <a class="reference internal" href="equation.html#equation-num-gen">(2)</a> can now be written for
each CV as</p>
<div class="math notranslate nohighlight" id="equation-num-dis">
<span class="eqno">(5)<a class="headerlink" href="#equation-num-dis" title="Permalink to this equation">¶</a></span>\[\begin{split}\frac{\rho_{P}(\phi_{P} - \phi_P^\text{old}) V_P}{\Delta t}
+ &amp;
\sum_{f} (\vec{n} \cdot \vec{u})_f A_f
\left[\alpha_f \phi_P +\left(1-\alpha_f\right)\phi_A\right]
\nonumber \\
= &amp;
\sum_f \Gamma_f A_f \frac{(\phi_A-\phi_P)}{d_{AP}}
+
V_P ( S_0 + S_1 \phi_P ).\end{split}\]</div>
<p>Equation <a class="reference internal" href="#equation-num-dis">(5)</a> is now in the form of a set of linear
combinations between each CV value and its neighboring values and can be
written in the form</p>
<div class="math notranslate nohighlight" id="equation-num-dap">
<span class="eqno">(6)<a class="headerlink" href="#equation-num-dap" title="Permalink to this equation">¶</a></span>\[a_P \phi_P = \sum_f a_{A} \phi_{A} + b_P,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}a_P &amp;=  \frac{\rho_P V_P}{\Delta t} + \sum_f (a_{A} +
F_f) - V_P S_1, \\
a_{A} &amp;=  D_f - ( 1 - \alpha_f ) F_f, \\
b_P &amp;= V_P S_0 + \frac{\rho_P V_P \phi_P^\text{old}}{\Delta t}.\end{split}\]</div>
<p>The face coefficients, <span class="math notranslate nohighlight">\(F_f\)</span> and <span class="math notranslate nohighlight">\(D_f\)</span>, represent the convective strength
and diffusive conductance respectively, and are given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}F_f &amp;= A_f ( \vec{u} \cdot \vec{n} )_f, \\
D_f &amp;= \frac{A_f \Gamma_f}{d_{AP}}.\end{split}\]</div>
</section>


                <div class='last-updated'>
                Last updated on May 23, 2025.
                Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.1.2.
                </div>
              </div>
  </div>  
  <aside class="nist-page__region nist-page__region--sidebar-second tablet-lg:grid-col-4">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

<strong>FiPy: A Finite Volume PDE Solver Using Python</strong><br />
Version 3.4.5+28.g44ba2a228

  <div class="sphinxsidebarsection">
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Finite Volume Method</a><ul>
<li><a class="reference internal" href="#cell-centered-fvm-cc-fvm">Cell Centered FVM (CC-FVM)</a><ul>
<li><a class="reference internal" href="#boundary-conditions">Boundary Conditions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vertex-centered-fvm-vc-fvm">Vertex Centered FVM (VC-FVM)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#discretization">Discretization</a><ul>
<li><a class="reference internal" href="#transient-term-partial-rho-phi-partial-t">Transient Term <span class="math notranslate nohighlight">\(\partial (\rho \phi) / \partial t\)</span></a></li>
<li><a class="reference internal" href="#convection-term-nabla-cdot-left-vec-u-phi-right">Convection Term <span class="math notranslate nohighlight">\(\nabla \cdot \left( \vec{u} \phi \right)\)</span></a></li>
<li><a class="reference internal" href="#diffusion-term-nabla-cdot-left-gamma-1-nabla-phi-right">Diffusion Term <span class="math notranslate nohighlight">\(\nabla \cdot \left( \Gamma_1 \nabla \phi \right)\)</span></a><ul>
<li><a class="reference internal" href="#higher-order-diffusion">Higher Order Diffusion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source-term">Source Term</a></li>
</ul>
</li>
<li><a class="reference internal" href="#linear-equations">Linear Equations</a></li>
</ul>

  </div>
<div class="sphinxsidebarsection">
  <h4>Previous topic</h4>
  <p class="topless"><a href="equation.html"
                        title="previous chapter">General Conservation Equation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="scheme.html"
                        title="next chapter">Numerical Schemes</a></p>
</div>
  <div class="sphinxsidebarsection">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/numerical/discret.rst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  </div>
<div class="sphinxsidebarsection">
<div id="searchbox" style="display: none" role="search">
  <div data-layout-content-preview-placeholder-label="&quot;Sphinx
  Search&quot; field" class="nist-block nist-block--search">
  <h2 id="searchlabel">Quick search</h2>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
  </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
</div>
<div class="sphinxsidebarsection" id="contact-wrapper">
  
        <div data-layout-content-preview-placeholder-label="&quot;Related
        organization tree&quot; views block" class="nist-block nist-block--org">
          
          <h2 class="nist-block__title">Organizations</h2>
              
              <div class="views-element-container"><div
              class="js-view-dom-id-70b0923f677edbe3dda361030ef8dc373cd0ca94065c39cfd81338de767f1019">

            <div class="nist-related-orgs"><div class="term-tree-list"><ul
            class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters" hreflang="en">NIST
            Headquarters</a><ul class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs"
            hreflang="en">Laboratory Programs</a><ul class="term"><li
            class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs/material-measurement-laboratory"
            hreflang="en">Material Measurement Laboratory</a>
			<ul
			class="term"><li
			class="selected"><a href="https://www.nist.gov/mml/msed"
			hreflang="en">Materials Science and Engineering
			Division</a></li><li
			class="selected"><a href="https://www.nist.gov/mml/ctcms"
			hreflang="en">Center for Theoretical and
			              Computational Materials Science</a></li></ul>
                          </li></ul></li></ul></li></ul></div></div>
          <div class="nist-related-orgs"></div>
          <div class="nist-related-orgs"></div>



        </div>
        </div>

          </div>


          <div data-layout-content-preview-placeholder-label="&quot;NIST
          Staff&quot; field" class="nist-block nist-block--contact">

          <h2 class="nist-block__title">NIST Staff</h2>

                  <div class="nist-field nist-field--label-hidden
                  nist-field--link-list entity-reference nist-field__items
                  nist-field--no-margin">
                            <div class="nist-field__item
                            nist-field--no-margin"><a
                            href="https://www.nist.gov/people/jonathan-e-guyer"
                            hreflang="en">Jonathan E. Guyer</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/daniel-wheeler"
                                hreflang="en">Daniel Wheeler</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/james-warren"
                                hreflang="en">James A. Warren</a></div>
                  </div>


          </div>

          <div data-layout-content-preview-placeholder-label="&quot;Contact&quot; field"
          class="nist-block nist-block--contact nist-block--mail">

          <h2 class="nist-block__title">
          <a class="" href="../docs/source/CONTACT.html" style="">Contact</a>
          </h2>

          </div>

</div>
        </div>
      </div>
      <div class="clearer"></div>
  </aside>
        </div>
      </div>

      <div class="panel-region--postface">
      <div class="inner region-inner inside">
        
<div class="pane pane--nist-node-date-pane" >

    </div>
      </div>
    </div>

        </section>
        </div>
      </div>

      </div>  
    </div>          

    </div>

  </div>

</div>


  


  <!-- Taken from https://www.filamentgroup.com/lab/html-includes/#another-demo%3A-including-another-html-file -->
  <iframe src="../_static/ntd2d_menu.html" onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()"></iframe>
    </div>
  </body>
</html>