
<!DOCTYPE html>


<!--[if IEMobile 7]><html class="iem7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if lte IE 6]><html class="lt-ie9 lt-ie8 lt-ie7 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (IE 7)&(!IEMobile)]><html class="lt-ie9 lt-ie8 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if IE 8]><html class="lt-ie9 no-js"  lang="en" dir="ltr"><![endif]-->
<!--[if (gte IE 9)|(gt IEMobile 7)]><!--><html class="no-js"  lang="en" dir="ltr" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# book: http://ogp.me/ns/book# profile: http://ogp.me/ns/profile# video: http://ogp.me/ns/video# product: http://ogp.me/ns/product# content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#"><!--<![endif]-->

  <head>
<meta charset="utf-8" />
<link rel="shortcut icon" href="https://www.nist.gov/sites/all/themes/nist_style/favicon.ico" type="image/vnd.microsoft.icon" />
<script type="text/x-mathjax-config">MathJax.Hub.Config({
  extensions: ['tex2jax.js'],
  jax: ['input/TeX','output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$$','$$'], ['\\(','\\)'] ],
    processEscapes: true,
    processClass: 'tex2jax',
    ignoreClass: 'html'
  },
  showProcessingMessages: false,
  messageStyle: 'none'
});
</script>
<meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">

      <!--[if lt IE 9]>
    <script src="https://www.nist.gov/sites/all/themes/zen/js/html5-respond.js"></script>
    <![endif]-->
    <!--[if (gte IE 6)&(lte IE 8)]>
  <script type="text/javascript" src="https://www.nist.gov/sites/all/themes/nist_style/js/selectivizr-min.js"></script>
  <![endif]--><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>examples.phase.polyxtalCoupled &#8212; FiPy 3.4.5+341.g28ce64369 documentation</title>
    <link rel="stylesheet" href="../_static/ntd2d.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/ntd2d.css?v=de7af573" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/widetable.css?v=32b6a719" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=de8d2c7c"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://pages.nist.gov/fipy/en/latest/generated/examples.phase.polyxtalCoupled.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="FiPy 3.4.5+341.g28ce64369 documentation" href="../contents.html" />
    <link rel="up" title="examples.phase" href="examples.phase.html" />
    <link rel="next" title="examples.phase.quaternary" href="examples.phase.quaternary.html" />
    <link rel="prev" title="examples.phase.polyxtal" href="examples.phase.polyxtal.html" />
  
 


  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-3.6.2.min.js" type="text/javascript" defer="defer"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


  </head>
<!--  <body role="document">-->
  <body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-414011 node-type-software hide-breadcrumb section-services-resources page-panels is-panel" role="document">
      <div id="page" class="mini-header">



    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="examples.phase.quaternary.html" title="examples.phase.quaternary"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="examples.phase.polyxtal.html" title="examples.phase.polyxtal"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html"><img src="../_static/fipy.png" alt="FiPy logo"
                 style="vertical-align: middle; margin-top: -1px"/>
        FiPy</a> &gt;</li>

          <li class="nav-item nav-item-1"><a href="../API.html" ><code class="xref py py-mod docutils literal notranslate"><span class="pre">fipy</span></code> Package Documentation</a> &gt;</li>
          <li class="nav-item nav-item-2"><a href="examples.html" >examples</a> &gt;</li>
          <li class="nav-item nav-item-3"><a href="examples.phase.html" accesskey="U">examples.phase</a> &gt;</li> 
      </ul>
    </div>

  <div id="main" class="clearfix" role="main" tabindex="-1">
    <div class="main__inner">
      <div class="page-info">
        <a id="main-content"></a>
      </div>

      <div class="document">
        <div class="documentwrapper">

      <div id="content" class="column">
      <div id="block-nist-www-content" class="nist-block">
        <section class="nist-page__content usa-section clearfix">

         

        <div class="grid-container margin-top-4">
        <div class="grid-row grid-gap-6">

  <div class="nist-page__region nist-page__region--content tablet-lg:grid-col-8">
              <div class="body" role="main">
		
  <section id="module-examples.phase.polyxtalCoupled">
<span id="examples-phase-polyxtalcoupled"></span><h1>examples.phase.polyxtalCoupled<a class="headerlink" href="#module-examples.phase.polyxtalCoupled" title="Permalink to this heading">¶</a></h1>
<p>Simultaneously solve the dendritic growth of nuclei and subsequent grain impingement.</p>
<p>To convert a liquid material to a solid,  it must be cooled to a
temperature below its melting point (known as “undercooling” or “supercooling”). The rate of
solidification is often assumed (and experimentally found) to be proportional to the
undercooling. Under the right circumstances, the
solidification front can become unstable, leading to dendritic
patterns.
Warren, Kobayashi, Lobkovsky and Carter <span id="id1">[<a class="reference internal" href="../references.html#id20" title="James A. Warren, Ryo Kobayashi, Alexander E. Lobkovsky, and W. Craig Carter. Extending phase field models of solidification to polycrystalline materials. Acta Materialia, 51(20):6035-6058, 2003. doi:10.1016/S1359-6454(03)00388-4.">13</a>]</span>
have described a phase field model (“Allen-Cahn”, “non-conserved
Ginsberg-Landau”, or “model A” of Hohenberg &amp; Halperin) of such a system,
including the effects of discrete crystalline orientations (anisotropy).</p>
<p>We start with a regular 2D Cartesian mesh</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy</span> <span class="kn">import</span>  <span class="n">CellVariable</span><span class="p">,</span> <span class="n">Variable</span><span class="p">,</span> <span class="n">ModularVariable</span><span class="p">,</span> <span class="n">Grid2D</span><span class="p">,</span> <span class="n">TransientTerm</span><span class="p">,</span> <span class="n">DiffusionTerm</span><span class="p">,</span> <span class="n">ImplicitSourceTerm</span><span class="p">,</span> <span class="n">PowerLawConvectionTerm</span><span class="p">,</span> <span class="n">MatplotlibViewer</span><span class="p">,</span> <span class="n">Matplotlib2DGridViewer</span><span class="p">,</span> <span class="n">MultiViewer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">fipy.tools</span> <span class="kn">import</span> <span class="n">numerix</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dx</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">=</span> <span class="mf">0.025</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">nx</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">200</span>
<span class="gp">... </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">nx</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="n">Grid2D</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="n">dy</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="n">ny</span><span class="p">)</span>
</pre></div>
</div>
<p>and we’ll take fixed timesteps</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="mf">5e-4</span>
</pre></div>
</div>
<p>We consider the simultaneous evolution of a “phase field” variable
<span class="math notranslate nohighlight">\(\phi\)</span> (taken to be 0 in the liquid phase and 1 in the solid)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">phase</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\phi$&#39;</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">hasOld</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>a dimensionless undercooling
<span class="math notranslate nohighlight">\(\Delta T\)</span> (<span class="math notranslate nohighlight">\(\Delta T = 0\)</span> at the melting point)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dT</span> <span class="o">=</span> <span class="n">CellVariable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Delta T$&#39;</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">hasOld</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>and an orientation <span class="math notranslate nohighlight">\(-\pi &lt; \theta \le \pi\)</span></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span> <span class="o">=</span> <span class="n">ModularVariable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\theta$&#39;</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">hasOld</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">theta</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="n">numerix</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="mf">0.0001</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">hasOld</span></code> flag causes the storage of the value of variable from the
previous timestep. This is necessary for solving equations with
non-linear coefficients or for coupling between PDEs.</p>
<p>The governing equation for the temperature field is the heat flux
equation, with a source due to the latent heat of solidification</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \Delta T}{\partial t}
= D_T \nabla^2 \Delta T
+ \frac{\partial \phi}{\partial t}
+ c\left(T_0 - T\right)\]</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">DT</span> <span class="o">=</span> <span class="mf">2.25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">T_0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">heatEq</span> <span class="o">=</span> <span class="p">(</span><span class="n">TransientTerm</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">dT</span><span class="p">)</span>
<span class="gp">... </span>          <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">DT</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">dT</span><span class="p">)</span>
<span class="gp">... </span>          <span class="o">+</span> <span class="n">TransientTerm</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="n">phase</span><span class="p">)</span>
<span class="gp">... </span>          <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">T_0</span> <span class="o">-</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">dT</span><span class="p">))</span>
</pre></div>
</div>
<p>The governing equation for the phase field is</p>
<div class="math notranslate nohighlight">
\[\tau_{\phi} \frac{\partial \phi}{\partial t}
= \nabla \cdot \mathsf{D} \nabla \phi
+   \phi ( 1 - \phi ) m ( \phi , \Delta T)
- 2 s \phi | \nabla \theta | - \epsilon^2 \phi | \nabla \theta |^2\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[m(\phi, \Delta T)
= \phi - \frac{1}{2}
- \frac{ \kappa_1 }{ \pi } \arctan \left( \kappa_2 \Delta T \right)\]</div>
<p>represents a source of anisotropy. The coefficient
<span class="math notranslate nohighlight">\(\mathsf{D}\)</span>
is an anisotropic diffusion tensor in two dimensions</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathsf{D} = \alpha^2 \left( 1 + c \beta \right)
\left[
\begin{matrix}
    1 + c \beta &amp; -c \frac{\partial \beta}{\partial \psi} \\
    c \frac{\partial \beta}{\partial \psi} &amp; 1 + c \beta
\end{matrix}
\right]\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\beta = \frac{ 1 - \Phi^2 } { 1 + \Phi^2}\)</span>,
<span class="math notranslate nohighlight">\(\Phi = \tan \left( \frac{ N } { 2 } \psi \right)\)</span>,
<span class="math notranslate nohighlight">\(\psi = \theta
+ \arctan \frac{\partial \phi / \partial y}{\partial \phi / \partial x}\)</span>,
<span class="math notranslate nohighlight">\(\theta\)</span> is the orientation, and <span class="math notranslate nohighlight">\(N\)</span> is the symmetry.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.015</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mf">4.</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">psi</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">arithmeticFaceValue</span> <span class="o">+</span> <span class="n">numerix</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">phase</span><span class="o">.</span><span class="n">faceGrad</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="gp">... </span>                                                  <span class="n">phase</span><span class="o">.</span><span class="n">faceGrad</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Phi</span> <span class="o">=</span> <span class="n">numerix</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">psi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">PhiSq</span> <span class="o">=</span> <span class="n">Phi</span><span class="o">**</span><span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">beta</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">PhiSq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">PhiSq</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">DbetaDpsi</span> <span class="o">=</span> <span class="o">-</span><span class="n">N</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Phi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">PhiSq</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Ddia</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Doff</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">DbetaDpsi</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I0</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I1</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">D</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Ddia</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ddia</span> <span class="o">*</span> <span class="n">I0</span> <span class="o">+</span> <span class="n">Doff</span> <span class="o">*</span> <span class="n">I1</span><span class="p">)</span>
</pre></div>
</div>
<p>With these expressions defined, we can construct the phase field equation
as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tau_phase</span> <span class="o">=</span> <span class="mf">3e-4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kappa1</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kappa2</span> <span class="o">=</span> <span class="mf">20.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.008</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thetaMag</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">mag</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phaseEq</span> <span class="o">=</span> <span class="p">(</span><span class="n">TransientTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">tau_phase</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">phase</span><span class="p">)</span>
<span class="gp">... </span>           <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">D</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">phase</span><span class="p">)</span>
<span class="gp">... </span>           <span class="o">+</span> <span class="n">ImplicitSourceTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="p">((</span><span class="n">phase</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">kappa1</span> <span class="o">/</span> <span class="n">numerix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">numerix</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">kappa2</span> <span class="o">*</span> <span class="n">dT</span><span class="p">))</span>
<span class="gp">... </span>                                       <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phase</span><span class="p">)</span>
<span class="gp">... </span>                                       <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">epsilon</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">thetaMag</span><span class="p">)</span> <span class="o">*</span> <span class="n">thetaMag</span><span class="p">),</span>
<span class="gp">... </span>                                <span class="n">var</span><span class="o">=</span><span class="n">phase</span><span class="p">))</span>
</pre></div>
</div>
<p>The governing equation for orientation is given by</p>
<div class="math notranslate nohighlight">
\[P(\epsilon | \nabla \theta |) \tau_{\theta} \phi^2
\frac{\partial \theta}{\partial t}
= \nabla \cdot \left[ \phi^2 \left( \frac{s}{| \nabla \theta |}
+ \epsilon^2 \right) \nabla \theta \right]\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[P(w) = 1 - \exp{(-\beta w)} + \frac{\mu}{\epsilon} \exp{(-\beta w)}\]</div>
<p>The <code class="docutils literal notranslate"><span class="pre">theta</span></code> equation is built in the following way. The details for
this equation are fairly involved, see J. A. Warren <em>et al.</em>. The main
detail is that a source must be added to correct for the
discretization of <code class="docutils literal notranslate"><span class="pre">theta</span></code> on the circle.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tau_theta</span> <span class="o">=</span> <span class="mf">3e-3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mu</span> <span class="o">=</span> <span class="mf">1e3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">1e3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thetaSmallValue</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">phaseMod</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">+</span> <span class="p">(</span> <span class="n">phase</span> <span class="o">&lt;</span> <span class="n">thetaSmallValue</span> <span class="p">)</span> <span class="o">*</span> <span class="n">thetaSmallValue</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">beta_theta</span> <span class="o">=</span> <span class="mf">1e5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expo</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">beta_theta</span> <span class="o">*</span> <span class="n">theta</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">mag</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expo</span> <span class="o">=</span> <span class="p">(</span><span class="n">expo</span> <span class="o">&lt;</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">expo</span> <span class="o">-</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">100.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Pfunc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">+</span> <span class="n">numerix</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">expo</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span> <span class="o">/</span> <span class="n">epsilon</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gradMagTheta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">faceGrad</span><span class="o">.</span><span class="n">mag</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eps</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">gamma</span> <span class="o">/</span> <span class="mf">10.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gradMagTheta</span> <span class="o">+=</span> <span class="p">(</span><span class="n">gradMagTheta</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">eps</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">IGamma</span> <span class="o">=</span> <span class="p">(</span><span class="n">gradMagTheta</span> <span class="o">&gt;</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">gradMagTheta</span> <span class="o">-</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">+</span> <span class="n">gamma</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v_theta</span> <span class="o">=</span> <span class="n">phase</span><span class="o">.</span><span class="n">arithmeticFaceValue</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">IGamma</span> <span class="o">+</span> <span class="n">epsilon</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">D_theta</span> <span class="o">=</span> <span class="n">phase</span><span class="o">.</span><span class="n">arithmeticFaceValue</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">IGamma</span> <span class="o">+</span> <span class="n">epsilon</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>The source term requires the evaluation of the face gradient without
the modular operator. <code class="docutils literal notranslate"><span class="pre">theta</span></code><a class="reference internal" href="fipy.variables.modularVariable.html#fipy.variables.modularVariable.ModularVariable.faceGradNoMod" title="fipy.variables.modularVariable.ModularVariable.faceGradNoMod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">faceGradNoMod</span></code></a>
evaluates the gradient without modular arithmetic.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">thetaEq</span> <span class="o">=</span> <span class="p">(</span><span class="n">TransientTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">tau_theta</span> <span class="o">*</span> <span class="n">phaseMod</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Pfunc</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>
<span class="gp">... </span>           <span class="o">==</span> <span class="n">DiffusionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">D_theta</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>
<span class="gp">... </span>           <span class="o">+</span> <span class="n">PowerLawConvectionTerm</span><span class="p">(</span><span class="n">coeff</span><span class="o">=</span><span class="n">v_theta</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">faceGrad</span> <span class="o">-</span> <span class="n">theta</span><span class="o">.</span><span class="n">faceGradNoMod</span><span class="p">),</span> <span class="n">var</span><span class="o">=</span><span class="n">phase</span><span class="p">))</span>
</pre></div>
</div>
<p>We seed a circular solidified region in the center</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cellCenters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numSeeds</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numerix</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">Cx</span><span class="p">,</span> <span class="n">Cy</span><span class="p">,</span> <span class="n">orientation</span> <span class="ow">in</span> <span class="n">numerix</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">([</span><span class="n">numSeeds</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span>
<span class="gp">... </span>    <span class="n">radius</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="mf">5.</span>
<span class="gp">... </span>    <span class="n">seed</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">Cx</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">Cy</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">*</span> <span class="n">dy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span>
<span class="gp">... </span>    <span class="n">phase</span><span class="p">[</span><span class="n">seed</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="gp">... </span>    <span class="n">theta</span><span class="p">[</span><span class="n">seed</span><span class="p">]</span> <span class="o">=</span> <span class="n">numerix</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">orientation</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>and quench the entire simulation domain below the melting point</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dT</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>In a real solidification process, dendritic branching is induced by small thermal
fluctuations along an otherwise smooth surface, but the granularity of the
<a class="reference internal" href="fipy.meshes.mesh.html#fipy.meshes.mesh.Mesh" title="fipy.meshes.mesh.Mesh"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mesh</span></code></a> is enough “noise” in this case, so we don’t need to explicitly
introduce randomness, the way we did in the Cahn-Hilliard problem.</p>
<p>FiPy’s viewers are utilitarian, striving to let the user see <em>something</em>,
regardless of their operating system or installed packages, so you the default
color scheme of grain orientation won’t be very informative “out of the box”.
Because all of Python is accessible and FiPy is object oriented, it is not hard
to adapt one of the existing viewers to create a specialized display:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">zip</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">class</span> <span class="nc">OrientationViewer</span><span class="p">(</span><span class="n">Matplotlib2DGridViewer</span><span class="p">):</span>
<span class="gp">... </span>            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwlimits</span><span class="p">):</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
<span class="gp">... </span>                <span class="n">Matplotlib2DGridViewer</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="p">(</span><span class="n">orientation</span><span class="p">,),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<span class="gp">... </span>                                                <span class="n">limits</span><span class="o">=</span><span class="n">limits</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwlimits</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>                <span class="c1"># make room for non-existent colorbar</span>
<span class="gp">... </span>                <span class="c1"># stolen from matplotlib.colorbar.make_axes</span>
<span class="gp">... </span>                <span class="c1"># https://github.com/matplotlib/matplotlib/blob</span>
<span class="gp">... </span>                <span class="c1">#   /ec1cd2567521c105a451ce15e06de10715f8b54d/lib</span>
<span class="gp">... </span>                <span class="c1">#   /matplotlib/colorbar.py#L838</span>
<span class="gp">... </span>                <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="gp">... </span>                <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_position</span><span class="p">(</span><span class="n">original</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span>
<span class="gp">... </span>                <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="gp">... </span>                <span class="n">x1</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">fraction</span>
<span class="gp">... </span>                <span class="n">pb1</span><span class="p">,</span> <span class="n">pbx</span><span class="p">,</span> <span class="n">pbcb</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">splitx</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">pad</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
<span class="gp">... </span>                <span class="n">panchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span><span class="n">pb1</span><span class="p">)</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_anchor</span><span class="p">(</span><span class="n">panchor</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>                <span class="c1"># make the gnomon</span>
<span class="gp">... </span>                <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">gnomon</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.425</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">gnomon</span><span class="o">.</span><span class="n">set_thetagrids</span><span class="p">([</span><span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
<span class="gp">... </span>                                           <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;$\pm\pi$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$-\frac{\pi}</span><span class="si">{2}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="s2">&quot;$0$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$+\frac{\pi}</span><span class="si">{2}</span><span class="s2">$&quot;</span><span class="p">],</span>
<span class="gp">... </span>                                           <span class="n">frac</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">gnomon</span><span class="o">.</span><span class="n">set_theta_zero_location</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">gnomon</span><span class="o">.</span><span class="n">set_theta_direction</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">gnomon</span><span class="o">.</span><span class="n">set_rgrids</span><span class="p">([</span><span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
<span class="gp">... </span>                <span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">... </span>                <span class="n">theta</span> <span class="o">=</span> <span class="n">numerix</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">numerix</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">numerix</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">numerix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>
<span class="gp">... </span>                <span class="n">radii</span> <span class="o">=</span> <span class="n">numerix</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="p">,))</span>
<span class="gp">... </span>                <span class="n">bars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gnomon</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">radii</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numerix</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">N</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="gp">... </span>                <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_and_phase_to_rgb</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="n">numerix</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">theta</span><span class="p">]),</span> <span class="n">phase</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">... </span>                <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">bar</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">theta</span><span class="p">,</span> <span class="n">bars</span><span class="p">):</span>
<span class="gp">... </span>                    <span class="n">bar</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="gp">... </span>                    <span class="n">bar</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="k">def</span> <span class="nf">_reshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
<span class="gp">... </span><span class="w">                </span><span class="sd">&#39;&#39;&#39;return values of var in an 2D array&#39;&#39;&#39;</span>
<span class="gp">... </span>                <span class="k">return</span> <span class="n">numerix</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">numerix</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">var</span><span class="p">),</span>
<span class="gp">... </span>                                       <span class="n">var</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="nd">@staticmethod</span>
<span class="gp">... </span>            <span class="k">def</span> <span class="nf">_orientation_and_phase_to_rgb</span><span class="p">(</span><span class="n">orientation</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
<span class="gp">... </span>                <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="gp">...</span>
<span class="gp">... </span>                <span class="n">hsv</span> <span class="o">=</span> <span class="n">numerix</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">orientation</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="gp">... </span>                <span class="n">hsv</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">orientation</span> <span class="o">/</span> <span class="n">numerix</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
<span class="gp">... </span>                <span class="n">hsv</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="gp">... </span>                <span class="n">hsv</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
<span class="gp">...</span>
<span class="gp">... </span>                <span class="k">return</span> <span class="n">colors</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">hsv</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="nd">@property</span>
<span class="gp">... </span>            <span class="k">def</span> <span class="nf">_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span><span class="w">                </span><span class="sd">&#39;&#39;&#39;convert phase and orientation to rgb image array</span>
<span class="gp">...</span>
<span class="gp">... </span><span class="sd">                orientation (-pi, pi) -&gt; hue (0, 1)</span>
<span class="gp">... </span><span class="sd">                phase (0, 1) -&gt; value (0, 1)</span>
<span class="gp">... </span><span class="sd">                &#39;&#39;&#39;</span>
<span class="gp">... </span>                <span class="n">orientation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">... </span>                <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_and_phase_to_rgb</span><span class="p">(</span><span class="n">orientation</span><span class="p">,</span> <span class="n">phase</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>            <span class="k">def</span> <span class="nf">_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="gp">... </span>        <span class="n">pyplot</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="gp">... </span>        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figaspect</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
<span class="gp">... </span>        <span class="n">timer</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s2">&quot;t = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="n">viewer</span> <span class="o">=</span> <span class="n">MultiViewer</span><span class="p">(</span><span class="n">viewers</span><span class="o">=</span><span class="p">(</span><span class="n">MatplotlibViewer</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="n">dT</span><span class="p">,</span>
<span class="gp">... </span>                                                       <span class="n">cmap</span><span class="o">=</span><span class="n">pyplot</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span>
<span class="gp">... </span>                                                       <span class="n">datamin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span>
<span class="gp">... </span>                                                       <span class="n">datamax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="gp">... </span>                                                       <span class="n">axes</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)),</span>
<span class="gp">... </span>                                      <span class="n">OrientationViewer</span><span class="p">(</span><span class="n">phase</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span>
<span class="gp">... </span>                                                        <span class="n">orientation</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span>
<span class="gp">... </span>                                                        <span class="n">title</span><span class="o">=</span><span class="n">theta</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<span class="gp">... </span>                                                        <span class="n">axes</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">))))</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">viewer</span> <span class="o">=</span> <span class="n">MultiViewer</span><span class="p">(</span><span class="n">viewers</span><span class="o">=</span><span class="p">(</span><span class="n">Viewer</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="n">dT</span><span class="p">,</span>
<span class="gp">... </span>                                             <span class="n">datamin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span>
<span class="gp">... </span>                                             <span class="n">datamax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
<span class="gp">... </span>                                      <span class="n">Viewer</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span>
<span class="gp">... </span>                                             <span class="n">datamin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
<span class="gp">... </span>                                             <span class="n">datamax</span><span class="o">=</span><span class="mf">1.</span><span class="p">),</span>
<span class="gp">... </span>                                      <span class="n">Viewer</span><span class="p">(</span><span class="nb">vars</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span>
<span class="gp">... </span>                                             <span class="n">datamin</span><span class="o">=-</span><span class="n">numerix</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
<span class="gp">... </span>                                             <span class="n">datamax</span><span class="o">=</span><span class="n">numerix</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>
<span class="gp">... </span>    <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<p>and iterate the solution in time, plotting as we go,</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eq</span> <span class="o">=</span> <span class="n">thetaEq</span> <span class="o">&amp;</span> <span class="n">phaseEq</span> <span class="o">&amp;</span> <span class="n">heatEq</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">total_time</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="gp">... </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">total_time</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">elapsed</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">save_interval</span> <span class="o">=</span> <span class="mf">0.002</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">save_at</span> <span class="o">=</span> <span class="n">save_interval</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="n">total_time</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">elapsed</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">q</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">... </span>    <span class="n">phase</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">dT</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">theta</span><span class="o">.</span><span class="n">updateOld</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">eq</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">elapsed</span> <span class="o">+=</span> <span class="n">dt</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span> <span class="ow">and</span> <span class="n">elapsed</span> <span class="o">&gt;=</span> <span class="n">save_at</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">timer</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s2">&quot;t = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">elapsed</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">viewer</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="gp">... </span>        <span class="n">save_at</span> <span class="o">+=</span> <span class="n">save_interval</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/polyxtal.png"><img alt="undercooling and grain orientation during solidification of a collection of anisotropic seeds" class="align-center" src="../_images/polyxtal.png" style="width: 90%;" /></a>
<p>The non-uniform temperature results from the release of latent
heat at the solidifying interface. The dendrite arms grow fastest
where the temperature gradient is steepest.</p>
</section>


                <div class='last-updated'>
                Last updated on Jun 23, 2025.
                Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.1.2.
                </div>
              </div>
  </div>  
  <aside class="nist-page__region nist-page__region--sidebar-second tablet-lg:grid-col-4">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

<strong>FiPy: A Finite Volume PDE Solver Using Python</strong><br />
Version 3.4.5+341.g28ce64369

<div class="sphinxsidebarsection">
  <h4>Previous topic</h4>
  <p class="topless"><a href="examples.phase.polyxtal.html"
                        title="previous chapter">examples.phase.polyxtal</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="examples.phase.quaternary.html"
                        title="next chapter">examples.phase.quaternary</a></p>
</div>
  <div class="sphinxsidebarsection">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/generated/examples.phase.polyxtalCoupled.rst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
  </div>
<div class="sphinxsidebarsection">
<div id="searchbox" style="display: none" role="search">
  <div data-layout-content-preview-placeholder-label="&quot;Sphinx
  Search&quot; field" class="nist-block nist-block--search">
  <h2 id="searchlabel">Quick search</h2>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
  </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
</div>
<div class="sphinxsidebarsection" id="contact-wrapper">
  
        <div data-layout-content-preview-placeholder-label="&quot;Related
        organization tree&quot; views block" class="nist-block nist-block--org">
          
          <h2 class="nist-block__title">Organizations</h2>
              
              <div class="views-element-container"><div
              class="js-view-dom-id-70b0923f677edbe3dda361030ef8dc373cd0ca94065c39cfd81338de767f1019">

            <div class="nist-related-orgs"><div class="term-tree-list"><ul
            class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters" hreflang="en">NIST
            Headquarters</a><ul class="term"><li class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs"
            hreflang="en">Laboratory Programs</a><ul class="term"><li
            class="selected"><a
            href="https://www.nist.gov/nist-organizations/nist-headquarters/laboratory-programs/material-measurement-laboratory"
            hreflang="en">Material Measurement Laboratory</a>
			<ul
			class="term"><li
			class="selected"><a href="https://www.nist.gov/mml/msed"
			hreflang="en">Materials Science and Engineering
			Division</a></li><li
			class="selected"><a href="https://www.nist.gov/mml/ctcms"
			hreflang="en">Center for Theoretical and
			              Computational Materials Science</a></li></ul>
                          </li></ul></li></ul></li></ul></div></div>
          <div class="nist-related-orgs"></div>
          <div class="nist-related-orgs"></div>



        </div>
        </div>

          </div>


          <div data-layout-content-preview-placeholder-label="&quot;NIST
          Staff&quot; field" class="nist-block nist-block--contact">

          <h2 class="nist-block__title">NIST Staff</h2>

                  <div class="nist-field nist-field--label-hidden
                  nist-field--link-list entity-reference nist-field__items
                  nist-field--no-margin">
                            <div class="nist-field__item
                            nist-field--no-margin"><a
                            href="https://www.nist.gov/people/jonathan-e-guyer"
                            hreflang="en">Jonathan E. Guyer</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/daniel-wheeler"
                                hreflang="en">Daniel Wheeler</a></div>
                                <div class="nist-field__item
                                nist-field--no-margin"><a
                                href="https://www.nist.gov/people/james-warren"
                                hreflang="en">James A. Warren</a></div>
                  </div>


          </div>

          <div data-layout-content-preview-placeholder-label="&quot;Contact&quot; field"
          class="nist-block nist-block--contact nist-block--mail">

          <h2 class="nist-block__title">
          <a class="" href="../docs/source/CONTACT.html" style="">Contact</a>
          </h2>

          </div>

</div>
        </div>
      </div>
      <div class="clearer"></div>
  </aside>
        </div>
      </div>

      <div class="panel-region--postface">
      <div class="inner region-inner inside">
        
<div class="pane pane--nist-node-date-pane" >

    </div>
      </div>
    </div>

        </section>
        </div>
      </div>

      </div>  
    </div>          

    </div>

  </div>

</div>


  


  <!-- Taken from https://www.filamentgroup.com/lab/html-includes/#another-demo%3A-including-another-html-file -->
  <iframe src="../_static/ntd2d_menu.html" onload="this.before((this.contentDocument.body||this.contentDocument).children[0]);this.remove()"></iframe>
    </div>
  </body>
</html>